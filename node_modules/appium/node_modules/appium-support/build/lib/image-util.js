"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.cropBase64Image = cropBase64Image;
exports.base64ToImage = base64ToImage;
exports.imageToBase64 = imageToBase64;
exports.cropImage = cropImage;
exports.getImagesMatches = getImagesMatches;
exports.getImagesSimilarity = getImagesSimilarity;
exports.getImageOccurrence = getImageOccurrence;
exports.getJimpImage = getJimpImage;
exports.MIME_BMP = exports.MIME_PNG = exports.MIME_JPEG = void 0;

require("source-map-support/register");

var _lodash = _interopRequireDefault(require("lodash"));

var _jimp = _interopRequireDefault(require("jimp"));

var _buffer = require("buffer");

var _pngjs = require("pngjs");

var _bluebird = _interopRequireDefault(require("bluebird"));

var _util = require("./util");

var _logger = _interopRequireDefault(require("./logger"));

var _node = require("./node");

const {
  MIME_JPEG,
  MIME_PNG,
  MIME_BMP
} = _jimp.default;
exports.MIME_BMP = MIME_BMP;
exports.MIME_PNG = MIME_PNG;
exports.MIME_JPEG = MIME_JPEG;
let cv = null;
const BYTES_IN_PIXEL_BLOCK = 4;
const SCANLINE_FILTER_METHOD = 4;
const DEFAULT_MATCH_THRESHOLD = 0.5;
const MATCH_NEIGHBOUR_THRESHOLD = 10;
const AVAILABLE_DETECTORS = ['AKAZE', 'AGAST', 'BRISK', 'FAST', 'GFTT', 'KAZE', 'MSER', 'SIFT', 'ORB'];
const AVAILABLE_MATCHING_FUNCTIONS = ['FlannBased', 'BruteForce', 'BruteForceL1', 'BruteForceHamming', 'BruteForceHammingLut', 'BruteForceSL2'];

async function getJimpImage(data) {
  return await new _bluebird.default((resolve, reject) => {
    if (!_lodash.default.isString(data) && !_lodash.default.isBuffer(data)) {
      return reject(new Error('Must initialize jimp object with string or buffer'));
    }

    if (_lodash.default.isString(data)) {
      data = _buffer.Buffer.from(data, 'base64');
    }

    new _jimp.default(data, (err, imgObj) => {
      if (err) {
        return reject(err);
      }

      if (!imgObj) {
        return reject(new Error('Could not create jimp image from that data'));
      }

      imgObj._getBuffer = imgObj.getBuffer.bind(imgObj);
      imgObj.getBuffer = _bluebird.default.promisify(imgObj._getBuffer, {
        context: imgObj
      });
      resolve(imgObj);
    });
  });
}

async function initOpenCV() {
  if (cv) {
    return;
  }

  _logger.default.debug(`Initializing opencv`);

  try {
    cv = await (0, _node.requirePackage)('opencv4nodejs');
  } catch (err) {
    _logger.default.warn(`Unable to load 'opencv4nodejs': ${err.message}`);
  }

  if (!cv) {
    throw new Error(`'opencv4nodejs' module is required to use OpenCV features. ` + `Please install it first ('npm i -g opencv4nodejs') and restart Appium. ` + 'Read https://github.com/justadudewhohacks/opencv4nodejs#how-to-install for more details on this topic.');
  }
}

async function detectAndCompute(img, detector) {
  const keyPoints = await detector.detectAsync(img);
  const descriptor = await detector.computeAsync(img, keyPoints);
  return {
    keyPoints,
    descriptor
  };
}

function calculateMatchedRect(matchedPoints) {
  if (matchedPoints.length < 2) {
    return {
      x: 0,
      y: 0,
      width: 0,
      height: 0
    };
  }

  const pointsSortedByDistance = matchedPoints.map(point => [Math.sqrt(point.x * point.x + point.y * point.y), point]).sort((pair1, pair2) => pair1[0] >= pair2[0]).map(pair => pair[1]);

  const firstPoint = _lodash.default.head(pointsSortedByDistance);

  const lastPoint = _lodash.default.last(pointsSortedByDistance);

  const topLeftPoint = {
    x: firstPoint.x <= lastPoint.x ? firstPoint.x : lastPoint.x,
    y: firstPoint.y <= lastPoint.y ? firstPoint.y : lastPoint.y
  };
  const bottomRightPoint = {
    x: firstPoint.x >= lastPoint.x ? firstPoint.x : lastPoint.x,
    y: firstPoint.y >= lastPoint.y ? firstPoint.y : lastPoint.y
  };
  return {
    x: topLeftPoint.x,
    y: topLeftPoint.y,
    width: bottomRightPoint.x - topLeftPoint.x,
    height: bottomRightPoint.y - topLeftPoint.y
  };
}

function highlightRegion(mat, region) {
  if (region.width <= 0 || region.height <= 0) {
    return;
  }

  const color = new cv.Vec(0, 0, 255);
  const thickness = 2;
  mat.drawRectangle(new cv.Rect(region.x, region.y, region.width, region.height), color, thickness, cv.LINE_8);
  return mat;
}

async function getImagesMatches(img1Data, img2Data, options = {}) {
  await initOpenCV();
  const {
    detectorName = 'ORB',
    visualize = false,
    goodMatchesFactor,
    matchFunc = 'BruteForce'
  } = options;

  if (!_lodash.default.includes(AVAILABLE_DETECTORS, detectorName)) {
    throw new Error(`'${detectorName}' detector is unknown. ` + `Only ${JSON.stringify(AVAILABLE_DETECTORS)} detectors are supported.`);
  }

  if (!_lodash.default.includes(AVAILABLE_MATCHING_FUNCTIONS, matchFunc)) {
    throw new Error(`'${matchFunc}' matching function is unknown. ` + `Only ${JSON.stringify(AVAILABLE_MATCHING_FUNCTIONS)} matching functions are supported.`);
  }

  const detector = new cv[`${detectorName}Detector`]();
  const [img1, img2] = await _bluebird.default.all([cv.imdecodeAsync(img1Data), cv.imdecodeAsync(img2Data)]);
  const [result1, result2] = await _bluebird.default.all([detectAndCompute(img1, detector), detectAndCompute(img2, detector)]);
  let matches = [];

  try {
    matches = await cv[`match${matchFunc}Async`](result1.descriptor, result2.descriptor);
  } catch (e) {
    throw new Error(`Cannot find any matches between the given images. Try another detection algorithm. ` + ` Original error: ${e}`);
  }

  const totalCount = matches.length;

  if ((0, _util.hasValue)(goodMatchesFactor)) {
    if (_lodash.default.isFunction(goodMatchesFactor)) {
      const distances = matches.map(match => match.distance);

      const minDistance = _lodash.default.min(distances);

      const maxDistance = _lodash.default.max(distances);

      matches = matches.filter(match => goodMatchesFactor(match.distance, minDistance, maxDistance));
    } else {
      if (matches.length > goodMatchesFactor) {
        matches = matches.sort((match1, match2) => match1.distance - match2.distance).slice(0, goodMatchesFactor);
      }
    }
  }

  const extractPoint = (keyPoints, indexPropertyName) => match => {
    const {
      pt,
      point
    } = keyPoints[match[indexPropertyName]];
    return pt || point;
  };

  const points1 = matches.map(extractPoint(result1.keyPoints, 'queryIdx'));
  const rect1 = calculateMatchedRect(points1);
  const points2 = matches.map(extractPoint(result2.keyPoints, 'trainIdx'));
  const rect2 = calculateMatchedRect(points2);
  const result = {
    points1,
    rect1,
    points2,
    rect2,
    totalCount,
    count: matches.length
  };

  if (visualize) {
    const visualization = cv.drawMatches(img1, img2, result1.keyPoints, result2.keyPoints, matches);
    highlightRegion(visualization, rect1);
    highlightRegion(visualization, {
      x: img1.cols + rect2.x,
      y: rect2.y,
      width: rect2.width,
      height: rect2.height
    });
    result.visualization = await cv.imencodeAsync('.png', visualization);
  }

  return result;
}

async function getImagesSimilarity(img1Data, img2Data, options = {}) {
  await initOpenCV();
  const {
    visualize = false
  } = options;
  let [template, reference] = await _bluebird.default.all([cv.imdecodeAsync(img1Data), cv.imdecodeAsync(img2Data)]);

  if (template.rows !== reference.rows || template.cols !== reference.cols) {
    throw new Error('Both images are expected to have the same size in order to ' + 'calculate the similarity score.');
  }

  [template, reference] = await _bluebird.default.all([template.convertToAsync(cv.CV_8UC3), reference.convertToAsync(cv.CV_8UC3)]);
  let matched;

  try {
    matched = await reference.matchTemplateAsync(template, cv.TM_CCOEFF_NORMED);
  } catch (e) {
    throw new Error(`The reference image did not match to the template one. Original error: ${e.message}`);
  }

  const minMax = await matched.minMaxLocAsync();
  const result = {
    score: minMax.maxVal
  };

  if (visualize) {
    const resultMat = new cv.Mat(template.rows, template.cols * 2, cv.CV_8UC3);
    await _bluebird.default.all([reference.copyToAsync(resultMat.getRegion(new cv.Rect(0, 0, reference.cols, reference.rows))), template.copyToAsync(resultMat.getRegion(new cv.Rect(reference.cols, 0, template.cols, template.rows)))]);
    let mask = reference.absdiff(template);
    mask = await mask.cvtColorAsync(cv.COLOR_BGR2GRAY);
    let contours = [];

    try {
      mask = await mask.thresholdAsync(128, 255, cv.THRESH_BINARY | cv.THRESH_OTSU);
      contours = await mask.findContoursAsync(cv.RETR_EXTERNAL, cv.CHAIN_APPROX_SIMPLE);
    } catch (ign) {}

    for (const contour of contours) {
      const boundingRect = contour.boundingRect();
      highlightRegion(resultMat, boundingRect);
      highlightRegion(resultMat, {
        x: reference.cols + boundingRect.x,
        y: boundingRect.y,
        width: boundingRect.width,
        height: boundingRect.height
      });
    }

    result.visualization = await cv.imencodeAsync('.png', resultMat);
  }

  return result;
}

async function getImageOccurrence(fullImgData, partialImgData, options = {}) {
  await initOpenCV();
  const {
    visualize = false,
    threshold = DEFAULT_MATCH_THRESHOLD,
    multiple = false,
    matchNeighbourThreshold = MATCH_NEIGHBOUR_THRESHOLD
  } = options;
  const [fullImg, partialImg] = await _bluebird.default.all([cv.imdecodeAsync(fullImgData), cv.imdecodeAsync(partialImgData)]);
  const results = [];
  let visualization = null;

  try {
    const matched = await fullImg.matchTemplateAsync(partialImg, cv.TM_CCOEFF_NORMED);
    const minMax = await matched.minMaxLocAsync();

    if (multiple) {
      const nonZeroMatchResults = matched.threshold(threshold, 1, cv.THRESH_BINARY).convertTo(cv.CV_8U).findNonZero();
      const matches = filterNearMatches(nonZeroMatchResults, matchNeighbourThreshold);

      for (const element of matches) {
        results.push({
          score: matched.at(element.y, element.x),
          rect: {
            x: element.x,
            y: element.y,
            width: partialImg.cols,
            height: partialImg.rows
          }
        });
      }
    } else if (minMax.maxVal >= threshold) {
      results.push({
        score: minMax.maxVal,
        rect: {
          x: minMax.maxLoc.x,
          y: minMax.maxLoc.y,
          width: partialImg.cols,
          height: partialImg.rows
        }
      });
    }

    if (_lodash.default.isEmpty(results)) {
      throw new Error(`Match threshold: ${threshold}. Highest match value ` + `found was ${minMax.maxVal}`);
    }
  } catch (e) {
    throw new Error(`Cannot find any occurrences of the partial image in the full image. ` + `Original error: ${e.message}`);
  }

  if (visualize) {
    const fullHighlightedImage = fullImg.copy();

    for (const result of results) {
      const singleHighlightedImage = fullImg.copy();
      highlightRegion(singleHighlightedImage, result.rect);
      highlightRegion(fullHighlightedImage, result.rect);
      result.visualization = await cv.imencodeAsync('.png', singleHighlightedImage);
    }

    visualization = await cv.imencodeAsync('.png', fullHighlightedImage);
  }

  return {
    rect: results[0].rect,
    score: results[0].score,
    visualization,
    multiple: results
  };
}

function filterNearMatches(nonZeroMatchResults, matchNeighbourThreshold) {
  return nonZeroMatchResults.reduce((acc, element) => {
    if (!acc.some(match => distance(match, element) <= matchNeighbourThreshold)) {
      acc.push(element);
    }

    return acc;
  }, []);
}

function distance(point1, point2) {
  const a2 = Math.pow(point1.x - point2.x, 2);
  const b2 = Math.pow(point1.y - point2.y, 2);
  return Math.sqrt(a2 + b2);
}

async function cropBase64Image(base64Image, rect) {
  const image = await base64ToImage(base64Image);
  cropImage(image, rect);
  return await imageToBase64(image);
}

async function base64ToImage(base64Image) {
  const imageBuffer = _buffer.Buffer.from(base64Image, 'base64');

  return await new _bluebird.default((resolve, reject) => {
    const image = new _pngjs.PNG({
      filterType: SCANLINE_FILTER_METHOD
    });
    image.parse(imageBuffer, (err, image) => {
      if (err) {
        return reject(err);
      }

      resolve(image);
    });
  });
}

async function imageToBase64(image) {
  return await new _bluebird.default((resolve, reject) => {
    const chunks = [];
    image.pack().on('data', chunk => chunks.push(chunk)).on('end', () => {
      resolve(_buffer.Buffer.concat(chunks).toString('base64'));
    }).on('error', err => {
      reject(err);
    });
  });
}

function cropImage(image, rect) {
  const imageRect = {
    width: image.width,
    height: image.height
  };
  const interRect = getRectIntersection(rect, imageRect);

  if (interRect.width < rect.width || interRect.height < rect.height) {
    throw new Error(`Cannot crop ${JSON.stringify(rect)} from ${JSON.stringify(imageRect)} because the intersection between them was not the size of the rect`);
  }

  const firstVerticalPixel = interRect.top;
  const lastVerticalPixel = interRect.top + interRect.height;
  const firstHorizontalPixel = interRect.left;
  const lastHorizontalPixel = interRect.left + interRect.width;
  const croppedArray = [];

  for (let y = firstVerticalPixel; y < lastVerticalPixel; y++) {
    for (let x = firstHorizontalPixel; x < lastHorizontalPixel; x++) {
      const firstByteIdxInPixelBlock = imageRect.width * y + x << 2;

      for (let byteIdx = 0; byteIdx < BYTES_IN_PIXEL_BLOCK; byteIdx++) {
        croppedArray.push(image.data[firstByteIdxInPixelBlock + byteIdx]);
      }
    }
  }

  image.data = _buffer.Buffer.from(croppedArray);
  image.width = interRect.width;
  image.height = interRect.height;
  return image;
}

function getRectIntersection(rect, imageSize) {
  const left = rect.left >= imageSize.width ? imageSize.width : rect.left;
  const top = rect.top >= imageSize.height ? imageSize.height : rect.top;
  const width = imageSize.width >= left + rect.width ? rect.width : imageSize.width - left;
  const height = imageSize.height >= top + rect.height ? rect.height : imageSize.height - top;
  return {
    left,
    top,
    width,
    height
  };
}require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9pbWFnZS11dGlsLmpzIl0sIm5hbWVzIjpbIk1JTUVfSlBFRyIsIk1JTUVfUE5HIiwiTUlNRV9CTVAiLCJKaW1wIiwiY3YiLCJCWVRFU19JTl9QSVhFTF9CTE9DSyIsIlNDQU5MSU5FX0ZJTFRFUl9NRVRIT0QiLCJERUZBVUxUX01BVENIX1RIUkVTSE9MRCIsIk1BVENIX05FSUdIQk9VUl9USFJFU0hPTEQiLCJBVkFJTEFCTEVfREVURUNUT1JTIiwiQVZBSUxBQkxFX01BVENISU5HX0ZVTkNUSU9OUyIsImdldEppbXBJbWFnZSIsImRhdGEiLCJCIiwicmVzb2x2ZSIsInJlamVjdCIsIl8iLCJpc1N0cmluZyIsImlzQnVmZmVyIiwiRXJyb3IiLCJCdWZmZXIiLCJmcm9tIiwiZXJyIiwiaW1nT2JqIiwiX2dldEJ1ZmZlciIsImdldEJ1ZmZlciIsImJpbmQiLCJwcm9taXNpZnkiLCJjb250ZXh0IiwiaW5pdE9wZW5DViIsImxvZyIsImRlYnVnIiwid2FybiIsIm1lc3NhZ2UiLCJkZXRlY3RBbmRDb21wdXRlIiwiaW1nIiwiZGV0ZWN0b3IiLCJrZXlQb2ludHMiLCJkZXRlY3RBc3luYyIsImRlc2NyaXB0b3IiLCJjb21wdXRlQXN5bmMiLCJjYWxjdWxhdGVNYXRjaGVkUmVjdCIsIm1hdGNoZWRQb2ludHMiLCJsZW5ndGgiLCJ4IiwieSIsIndpZHRoIiwiaGVpZ2h0IiwicG9pbnRzU29ydGVkQnlEaXN0YW5jZSIsIm1hcCIsInBvaW50IiwiTWF0aCIsInNxcnQiLCJzb3J0IiwicGFpcjEiLCJwYWlyMiIsInBhaXIiLCJmaXJzdFBvaW50IiwiaGVhZCIsImxhc3RQb2ludCIsImxhc3QiLCJ0b3BMZWZ0UG9pbnQiLCJib3R0b21SaWdodFBvaW50IiwiaGlnaGxpZ2h0UmVnaW9uIiwibWF0IiwicmVnaW9uIiwiY29sb3IiLCJWZWMiLCJ0aGlja25lc3MiLCJkcmF3UmVjdGFuZ2xlIiwiUmVjdCIsIkxJTkVfOCIsImdldEltYWdlc01hdGNoZXMiLCJpbWcxRGF0YSIsImltZzJEYXRhIiwib3B0aW9ucyIsImRldGVjdG9yTmFtZSIsInZpc3VhbGl6ZSIsImdvb2RNYXRjaGVzRmFjdG9yIiwibWF0Y2hGdW5jIiwiaW5jbHVkZXMiLCJKU09OIiwic3RyaW5naWZ5IiwiaW1nMSIsImltZzIiLCJhbGwiLCJpbWRlY29kZUFzeW5jIiwicmVzdWx0MSIsInJlc3VsdDIiLCJtYXRjaGVzIiwiZSIsInRvdGFsQ291bnQiLCJpc0Z1bmN0aW9uIiwiZGlzdGFuY2VzIiwibWF0Y2giLCJkaXN0YW5jZSIsIm1pbkRpc3RhbmNlIiwibWluIiwibWF4RGlzdGFuY2UiLCJtYXgiLCJmaWx0ZXIiLCJtYXRjaDEiLCJtYXRjaDIiLCJzbGljZSIsImV4dHJhY3RQb2ludCIsImluZGV4UHJvcGVydHlOYW1lIiwicHQiLCJwb2ludHMxIiwicmVjdDEiLCJwb2ludHMyIiwicmVjdDIiLCJyZXN1bHQiLCJjb3VudCIsInZpc3VhbGl6YXRpb24iLCJkcmF3TWF0Y2hlcyIsImNvbHMiLCJpbWVuY29kZUFzeW5jIiwiZ2V0SW1hZ2VzU2ltaWxhcml0eSIsInRlbXBsYXRlIiwicmVmZXJlbmNlIiwicm93cyIsImNvbnZlcnRUb0FzeW5jIiwiQ1ZfOFVDMyIsIm1hdGNoZWQiLCJtYXRjaFRlbXBsYXRlQXN5bmMiLCJUTV9DQ09FRkZfTk9STUVEIiwibWluTWF4IiwibWluTWF4TG9jQXN5bmMiLCJzY29yZSIsIm1heFZhbCIsInJlc3VsdE1hdCIsIk1hdCIsImNvcHlUb0FzeW5jIiwiZ2V0UmVnaW9uIiwibWFzayIsImFic2RpZmYiLCJjdnRDb2xvckFzeW5jIiwiQ09MT1JfQkdSMkdSQVkiLCJjb250b3VycyIsInRocmVzaG9sZEFzeW5jIiwiVEhSRVNIX0JJTkFSWSIsIlRIUkVTSF9PVFNVIiwiZmluZENvbnRvdXJzQXN5bmMiLCJSRVRSX0VYVEVSTkFMIiwiQ0hBSU5fQVBQUk9YX1NJTVBMRSIsImlnbiIsImNvbnRvdXIiLCJib3VuZGluZ1JlY3QiLCJnZXRJbWFnZU9jY3VycmVuY2UiLCJmdWxsSW1nRGF0YSIsInBhcnRpYWxJbWdEYXRhIiwidGhyZXNob2xkIiwibXVsdGlwbGUiLCJtYXRjaE5laWdoYm91clRocmVzaG9sZCIsImZ1bGxJbWciLCJwYXJ0aWFsSW1nIiwicmVzdWx0cyIsIm5vblplcm9NYXRjaFJlc3VsdHMiLCJjb252ZXJ0VG8iLCJDVl84VSIsImZpbmROb25aZXJvIiwiZmlsdGVyTmVhck1hdGNoZXMiLCJlbGVtZW50IiwicHVzaCIsImF0IiwicmVjdCIsIm1heExvYyIsImlzRW1wdHkiLCJmdWxsSGlnaGxpZ2h0ZWRJbWFnZSIsImNvcHkiLCJzaW5nbGVIaWdobGlnaHRlZEltYWdlIiwicmVkdWNlIiwiYWNjIiwic29tZSIsInBvaW50MSIsInBvaW50MiIsImEyIiwicG93IiwiYjIiLCJjcm9wQmFzZTY0SW1hZ2UiLCJiYXNlNjRJbWFnZSIsImltYWdlIiwiYmFzZTY0VG9JbWFnZSIsImNyb3BJbWFnZSIsImltYWdlVG9CYXNlNjQiLCJpbWFnZUJ1ZmZlciIsIlBORyIsImZpbHRlclR5cGUiLCJwYXJzZSIsImNodW5rcyIsInBhY2siLCJvbiIsImNodW5rIiwiY29uY2F0IiwidG9TdHJpbmciLCJpbWFnZVJlY3QiLCJpbnRlclJlY3QiLCJnZXRSZWN0SW50ZXJzZWN0aW9uIiwiZmlyc3RWZXJ0aWNhbFBpeGVsIiwidG9wIiwibGFzdFZlcnRpY2FsUGl4ZWwiLCJmaXJzdEhvcml6b250YWxQaXhlbCIsImxlZnQiLCJsYXN0SG9yaXpvbnRhbFBpeGVsIiwiY3JvcHBlZEFycmF5IiwiZmlyc3RCeXRlSWR4SW5QaXhlbEJsb2NrIiwiYnl0ZUlkeCIsImltYWdlU2l6ZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUdBLE1BQU07QUFBRUEsRUFBQUEsU0FBRjtBQUFhQyxFQUFBQSxRQUFiO0FBQXVCQyxFQUFBQTtBQUF2QixJQUFvQ0MsYUFBMUM7Ozs7QUFDQSxJQUFJQyxFQUFFLEdBQUcsSUFBVDtBQXdCQSxNQUFNQyxvQkFBb0IsR0FBRyxDQUE3QjtBQUNBLE1BQU1DLHNCQUFzQixHQUFHLENBQS9CO0FBQ0EsTUFBTUMsdUJBQXVCLEdBQUcsR0FBaEM7QUFDQSxNQUFNQyx5QkFBeUIsR0FBRyxFQUFsQztBQUVBLE1BQU1DLG1CQUFtQixHQUFHLENBQzFCLE9BRDBCLEVBRTFCLE9BRjBCLEVBRzFCLE9BSDBCLEVBSTFCLE1BSjBCLEVBSzFCLE1BTDBCLEVBTTFCLE1BTjBCLEVBTzFCLE1BUDBCLEVBUTFCLE1BUjBCLEVBUzFCLEtBVDBCLENBQTVCO0FBWUEsTUFBTUMsNEJBQTRCLEdBQUcsQ0FDbkMsWUFEbUMsRUFFbkMsWUFGbUMsRUFHbkMsY0FIbUMsRUFJbkMsbUJBSm1DLEVBS25DLHNCQUxtQyxFQU1uQyxlQU5tQyxDQUFyQzs7QUFrQkEsZUFBZUMsWUFBZixDQUE2QkMsSUFBN0IsRUFBbUM7QUFDakMsU0FBTyxNQUFNLElBQUlDLGlCQUFKLENBQU0sQ0FBQ0MsT0FBRCxFQUFVQyxNQUFWLEtBQXFCO0FBQ3RDLFFBQUksQ0FBQ0MsZ0JBQUVDLFFBQUYsQ0FBV0wsSUFBWCxDQUFELElBQXFCLENBQUNJLGdCQUFFRSxRQUFGLENBQVdOLElBQVgsQ0FBMUIsRUFBNEM7QUFDMUMsYUFBT0csTUFBTSxDQUFDLElBQUlJLEtBQUosQ0FBVSxtREFBVixDQUFELENBQWI7QUFDRDs7QUFFRCxRQUFJSCxnQkFBRUMsUUFBRixDQUFXTCxJQUFYLENBQUosRUFBc0I7QUFDcEJBLE1BQUFBLElBQUksR0FBR1EsZUFBT0MsSUFBUCxDQUFZVCxJQUFaLEVBQWtCLFFBQWxCLENBQVA7QUFDRDs7QUFDRCxRQUFJVCxhQUFKLENBQVNTLElBQVQsRUFBZSxDQUFDVSxHQUFELEVBQU1DLE1BQU4sS0FBaUI7QUFDOUIsVUFBSUQsR0FBSixFQUFTO0FBQ1AsZUFBT1AsTUFBTSxDQUFDTyxHQUFELENBQWI7QUFDRDs7QUFDRCxVQUFJLENBQUNDLE1BQUwsRUFBYTtBQUNYLGVBQU9SLE1BQU0sQ0FBQyxJQUFJSSxLQUFKLENBQVUsNENBQVYsQ0FBRCxDQUFiO0FBQ0Q7O0FBQ0RJLE1BQUFBLE1BQU0sQ0FBQ0MsVUFBUCxHQUFvQkQsTUFBTSxDQUFDRSxTQUFQLENBQWlCQyxJQUFqQixDQUFzQkgsTUFBdEIsQ0FBcEI7QUFDQUEsTUFBQUEsTUFBTSxDQUFDRSxTQUFQLEdBQW1CWixrQkFBRWMsU0FBRixDQUFZSixNQUFNLENBQUNDLFVBQW5CLEVBQStCO0FBQUNJLFFBQUFBLE9BQU8sRUFBRUw7QUFBVixPQUEvQixDQUFuQjtBQUNBVCxNQUFBQSxPQUFPLENBQUNTLE1BQUQsQ0FBUDtBQUNELEtBVkQ7QUFXRCxHQW5CWSxDQUFiO0FBb0JEOztBQUtELGVBQWVNLFVBQWYsR0FBNkI7QUFDM0IsTUFBSXpCLEVBQUosRUFBUTtBQUNOO0FBQ0Q7O0FBRUQwQixrQkFBSUMsS0FBSixDQUFXLHFCQUFYOztBQUNBLE1BQUk7QUFDRjNCLElBQUFBLEVBQUUsR0FBRyxNQUFNLDBCQUFlLGVBQWYsQ0FBWDtBQUNELEdBRkQsQ0FFRSxPQUFPa0IsR0FBUCxFQUFZO0FBQ1pRLG9CQUFJRSxJQUFKLENBQVUsbUNBQWtDVixHQUFHLENBQUNXLE9BQVEsRUFBeEQ7QUFDRDs7QUFFRCxNQUFJLENBQUM3QixFQUFMLEVBQVM7QUFDUCxVQUFNLElBQUllLEtBQUosQ0FBVyw2REFBRCxHQUNDLHlFQURELEdBRUEsd0dBRlYsQ0FBTjtBQUdEO0FBQ0Y7O0FBbUJELGVBQWVlLGdCQUFmLENBQWlDQyxHQUFqQyxFQUFzQ0MsUUFBdEMsRUFBZ0Q7QUFDOUMsUUFBTUMsU0FBUyxHQUFHLE1BQU1ELFFBQVEsQ0FBQ0UsV0FBVCxDQUFxQkgsR0FBckIsQ0FBeEI7QUFDQSxRQUFNSSxVQUFVLEdBQUcsTUFBTUgsUUFBUSxDQUFDSSxZQUFULENBQXNCTCxHQUF0QixFQUEyQkUsU0FBM0IsQ0FBekI7QUFDQSxTQUFPO0FBQ0xBLElBQUFBLFNBREs7QUFFTEUsSUFBQUE7QUFGSyxHQUFQO0FBSUQ7O0FBU0QsU0FBU0Usb0JBQVQsQ0FBK0JDLGFBQS9CLEVBQThDO0FBQzVDLE1BQUlBLGFBQWEsQ0FBQ0MsTUFBZCxHQUF1QixDQUEzQixFQUE4QjtBQUM1QixXQUFPO0FBQ0xDLE1BQUFBLENBQUMsRUFBRSxDQURFO0FBRUxDLE1BQUFBLENBQUMsRUFBRSxDQUZFO0FBR0xDLE1BQUFBLEtBQUssRUFBRSxDQUhGO0FBSUxDLE1BQUFBLE1BQU0sRUFBRTtBQUpILEtBQVA7QUFNRDs7QUFFRCxRQUFNQyxzQkFBc0IsR0FBR04sYUFBYSxDQUN6Q08sR0FENEIsQ0FDdkJDLEtBQUQsSUFBVyxDQUFDQyxJQUFJLENBQUNDLElBQUwsQ0FBVUYsS0FBSyxDQUFDTixDQUFOLEdBQVVNLEtBQUssQ0FBQ04sQ0FBaEIsR0FBb0JNLEtBQUssQ0FBQ0wsQ0FBTixHQUFVSyxLQUFLLENBQUNMLENBQTlDLENBQUQsRUFBbURLLEtBQW5ELENBRGEsRUFFNUJHLElBRjRCLENBRXZCLENBQUNDLEtBQUQsRUFBUUMsS0FBUixLQUFrQkQsS0FBSyxDQUFDLENBQUQsQ0FBTCxJQUFZQyxLQUFLLENBQUMsQ0FBRCxDQUZaLEVBRzVCTixHQUg0QixDQUd2Qk8sSUFBRCxJQUFVQSxJQUFJLENBQUMsQ0FBRCxDQUhVLENBQS9COztBQUlBLFFBQU1DLFVBQVUsR0FBR3pDLGdCQUFFMEMsSUFBRixDQUFPVixzQkFBUCxDQUFuQjs7QUFDQSxRQUFNVyxTQUFTLEdBQUczQyxnQkFBRTRDLElBQUYsQ0FBT1osc0JBQVAsQ0FBbEI7O0FBQ0EsUUFBTWEsWUFBWSxHQUFHO0FBQ25CakIsSUFBQUEsQ0FBQyxFQUFFYSxVQUFVLENBQUNiLENBQVgsSUFBZ0JlLFNBQVMsQ0FBQ2YsQ0FBMUIsR0FBOEJhLFVBQVUsQ0FBQ2IsQ0FBekMsR0FBNkNlLFNBQVMsQ0FBQ2YsQ0FEdkM7QUFFbkJDLElBQUFBLENBQUMsRUFBRVksVUFBVSxDQUFDWixDQUFYLElBQWdCYyxTQUFTLENBQUNkLENBQTFCLEdBQThCWSxVQUFVLENBQUNaLENBQXpDLEdBQTZDYyxTQUFTLENBQUNkO0FBRnZDLEdBQXJCO0FBSUEsUUFBTWlCLGdCQUFnQixHQUFHO0FBQ3ZCbEIsSUFBQUEsQ0FBQyxFQUFFYSxVQUFVLENBQUNiLENBQVgsSUFBZ0JlLFNBQVMsQ0FBQ2YsQ0FBMUIsR0FBOEJhLFVBQVUsQ0FBQ2IsQ0FBekMsR0FBNkNlLFNBQVMsQ0FBQ2YsQ0FEbkM7QUFFdkJDLElBQUFBLENBQUMsRUFBRVksVUFBVSxDQUFDWixDQUFYLElBQWdCYyxTQUFTLENBQUNkLENBQTFCLEdBQThCWSxVQUFVLENBQUNaLENBQXpDLEdBQTZDYyxTQUFTLENBQUNkO0FBRm5DLEdBQXpCO0FBSUEsU0FBTztBQUNMRCxJQUFBQSxDQUFDLEVBQUVpQixZQUFZLENBQUNqQixDQURYO0FBRUxDLElBQUFBLENBQUMsRUFBRWdCLFlBQVksQ0FBQ2hCLENBRlg7QUFHTEMsSUFBQUEsS0FBSyxFQUFFZ0IsZ0JBQWdCLENBQUNsQixDQUFqQixHQUFxQmlCLFlBQVksQ0FBQ2pCLENBSHBDO0FBSUxHLElBQUFBLE1BQU0sRUFBRWUsZ0JBQWdCLENBQUNqQixDQUFqQixHQUFxQmdCLFlBQVksQ0FBQ2hCO0FBSnJDLEdBQVA7QUFNRDs7QUFVRCxTQUFTa0IsZUFBVCxDQUEwQkMsR0FBMUIsRUFBK0JDLE1BQS9CLEVBQXVDO0FBQ3JDLE1BQUlBLE1BQU0sQ0FBQ25CLEtBQVAsSUFBZ0IsQ0FBaEIsSUFBcUJtQixNQUFNLENBQUNsQixNQUFQLElBQWlCLENBQTFDLEVBQTZDO0FBQzNDO0FBQ0Q7O0FBR0QsUUFBTW1CLEtBQUssR0FBRyxJQUFJOUQsRUFBRSxDQUFDK0QsR0FBUCxDQUFXLENBQVgsRUFBYyxDQUFkLEVBQWlCLEdBQWpCLENBQWQ7QUFDQSxRQUFNQyxTQUFTLEdBQUcsQ0FBbEI7QUFDQUosRUFBQUEsR0FBRyxDQUFDSyxhQUFKLENBQWtCLElBQUlqRSxFQUFFLENBQUNrRSxJQUFQLENBQVlMLE1BQU0sQ0FBQ3JCLENBQW5CLEVBQXNCcUIsTUFBTSxDQUFDcEIsQ0FBN0IsRUFBZ0NvQixNQUFNLENBQUNuQixLQUF2QyxFQUE4Q21CLE1BQU0sQ0FBQ2xCLE1BQXJELENBQWxCLEVBQWdGbUIsS0FBaEYsRUFBdUZFLFNBQXZGLEVBQWtHaEUsRUFBRSxDQUFDbUUsTUFBckc7QUFDQSxTQUFPUCxHQUFQO0FBQ0Q7O0FBZ0RELGVBQWVRLGdCQUFmLENBQWlDQyxRQUFqQyxFQUEyQ0MsUUFBM0MsRUFBcURDLE9BQU8sR0FBRyxFQUEvRCxFQUFtRTtBQUNqRSxRQUFNOUMsVUFBVSxFQUFoQjtBQUVBLFFBQU07QUFBQytDLElBQUFBLFlBQVksR0FBRyxLQUFoQjtBQUF1QkMsSUFBQUEsU0FBUyxHQUFHLEtBQW5DO0FBQ0NDLElBQUFBLGlCQUREO0FBQ29CQyxJQUFBQSxTQUFTLEdBQUc7QUFEaEMsTUFDZ0RKLE9BRHREOztBQUVBLE1BQUksQ0FBQzNELGdCQUFFZ0UsUUFBRixDQUFXdkUsbUJBQVgsRUFBZ0NtRSxZQUFoQyxDQUFMLEVBQW9EO0FBQ2xELFVBQU0sSUFBSXpELEtBQUosQ0FBVyxJQUFHeUQsWUFBYSx5QkFBakIsR0FDQyxRQUFPSyxJQUFJLENBQUNDLFNBQUwsQ0FBZXpFLG1CQUFmLENBQW9DLDJCQUR0RCxDQUFOO0FBRUQ7O0FBQ0QsTUFBSSxDQUFDTyxnQkFBRWdFLFFBQUYsQ0FBV3RFLDRCQUFYLEVBQXlDcUUsU0FBekMsQ0FBTCxFQUEwRDtBQUN4RCxVQUFNLElBQUk1RCxLQUFKLENBQVcsSUFBRzRELFNBQVUsa0NBQWQsR0FDQyxRQUFPRSxJQUFJLENBQUNDLFNBQUwsQ0FBZXhFLDRCQUFmLENBQTZDLG9DQUQvRCxDQUFOO0FBRUQ7O0FBRUQsUUFBTTBCLFFBQVEsR0FBRyxJQUFJaEMsRUFBRSxDQUFFLEdBQUV3RSxZQUFhLFVBQWpCLENBQU4sRUFBakI7QUFDQSxRQUFNLENBQUNPLElBQUQsRUFBT0MsSUFBUCxJQUFlLE1BQU12RSxrQkFBRXdFLEdBQUYsQ0FBTSxDQUMvQmpGLEVBQUUsQ0FBQ2tGLGFBQUgsQ0FBaUJiLFFBQWpCLENBRCtCLEVBRS9CckUsRUFBRSxDQUFDa0YsYUFBSCxDQUFpQlosUUFBakIsQ0FGK0IsQ0FBTixDQUEzQjtBQUlBLFFBQU0sQ0FBQ2EsT0FBRCxFQUFVQyxPQUFWLElBQXFCLE1BQU0zRSxrQkFBRXdFLEdBQUYsQ0FBTSxDQUNyQ25ELGdCQUFnQixDQUFDaUQsSUFBRCxFQUFPL0MsUUFBUCxDQURxQixFQUVyQ0YsZ0JBQWdCLENBQUNrRCxJQUFELEVBQU9oRCxRQUFQLENBRnFCLENBQU4sQ0FBakM7QUFJQSxNQUFJcUQsT0FBTyxHQUFHLEVBQWQ7O0FBQ0EsTUFBSTtBQUNGQSxJQUFBQSxPQUFPLEdBQUcsTUFBTXJGLEVBQUUsQ0FBRSxRQUFPMkUsU0FBVSxPQUFuQixDQUFGLENBQTZCUSxPQUFPLENBQUNoRCxVQUFyQyxFQUFpRGlELE9BQU8sQ0FBQ2pELFVBQXpELENBQWhCO0FBQ0QsR0FGRCxDQUVFLE9BQU9tRCxDQUFQLEVBQVU7QUFDVixVQUFNLElBQUl2RSxLQUFKLENBQVcscUZBQUQsR0FDQyxvQkFBbUJ1RSxDQUFFLEVBRGhDLENBQU47QUFFRDs7QUFDRCxRQUFNQyxVQUFVLEdBQUdGLE9BQU8sQ0FBQzlDLE1BQTNCOztBQUNBLE1BQUksb0JBQVNtQyxpQkFBVCxDQUFKLEVBQWlDO0FBQy9CLFFBQUk5RCxnQkFBRTRFLFVBQUYsQ0FBYWQsaUJBQWIsQ0FBSixFQUFxQztBQUNuQyxZQUFNZSxTQUFTLEdBQUdKLE9BQU8sQ0FBQ3hDLEdBQVIsQ0FBYTZDLEtBQUQsSUFBV0EsS0FBSyxDQUFDQyxRQUE3QixDQUFsQjs7QUFDQSxZQUFNQyxXQUFXLEdBQUdoRixnQkFBRWlGLEdBQUYsQ0FBTUosU0FBTixDQUFwQjs7QUFDQSxZQUFNSyxXQUFXLEdBQUdsRixnQkFBRW1GLEdBQUYsQ0FBTU4sU0FBTixDQUFwQjs7QUFDQUosTUFBQUEsT0FBTyxHQUFHQSxPQUFPLENBQ2RXLE1BRE8sQ0FDQ04sS0FBRCxJQUFXaEIsaUJBQWlCLENBQUNnQixLQUFLLENBQUNDLFFBQVAsRUFBaUJDLFdBQWpCLEVBQThCRSxXQUE5QixDQUQ1QixDQUFWO0FBRUQsS0FORCxNQU1PO0FBQ0wsVUFBSVQsT0FBTyxDQUFDOUMsTUFBUixHQUFpQm1DLGlCQUFyQixFQUF3QztBQUN0Q1csUUFBQUEsT0FBTyxHQUFHQSxPQUFPLENBQ2RwQyxJQURPLENBQ0YsQ0FBQ2dELE1BQUQsRUFBU0MsTUFBVCxLQUFvQkQsTUFBTSxDQUFDTixRQUFQLEdBQWtCTyxNQUFNLENBQUNQLFFBRDNDLEVBRVBRLEtBRk8sQ0FFRCxDQUZDLEVBRUV6QixpQkFGRixDQUFWO0FBR0Q7QUFDRjtBQUNGOztBQUVELFFBQU0wQixZQUFZLEdBQUcsQ0FBQ25FLFNBQUQsRUFBWW9FLGlCQUFaLEtBQW1DWCxLQUFELElBQVc7QUFDaEUsVUFBTTtBQUFDWSxNQUFBQSxFQUFEO0FBQUt4RCxNQUFBQTtBQUFMLFFBQWNiLFNBQVMsQ0FBQ3lELEtBQUssQ0FBQ1csaUJBQUQsQ0FBTixDQUE3QjtBQUVBLFdBQVFDLEVBQUUsSUFBSXhELEtBQWQ7QUFDRCxHQUpEOztBQUtBLFFBQU15RCxPQUFPLEdBQUdsQixPQUFPLENBQUN4QyxHQUFSLENBQVl1RCxZQUFZLENBQUNqQixPQUFPLENBQUNsRCxTQUFULEVBQW9CLFVBQXBCLENBQXhCLENBQWhCO0FBQ0EsUUFBTXVFLEtBQUssR0FBR25FLG9CQUFvQixDQUFDa0UsT0FBRCxDQUFsQztBQUNBLFFBQU1FLE9BQU8sR0FBR3BCLE9BQU8sQ0FBQ3hDLEdBQVIsQ0FBWXVELFlBQVksQ0FBQ2hCLE9BQU8sQ0FBQ25ELFNBQVQsRUFBb0IsVUFBcEIsQ0FBeEIsQ0FBaEI7QUFDQSxRQUFNeUUsS0FBSyxHQUFHckUsb0JBQW9CLENBQUNvRSxPQUFELENBQWxDO0FBRUEsUUFBTUUsTUFBTSxHQUFHO0FBQ2JKLElBQUFBLE9BRGE7QUFFYkMsSUFBQUEsS0FGYTtBQUdiQyxJQUFBQSxPQUhhO0FBSWJDLElBQUFBLEtBSmE7QUFLYm5CLElBQUFBLFVBTGE7QUFNYnFCLElBQUFBLEtBQUssRUFBRXZCLE9BQU8sQ0FBQzlDO0FBTkYsR0FBZjs7QUFRQSxNQUFJa0MsU0FBSixFQUFlO0FBQ2IsVUFBTW9DLGFBQWEsR0FBRzdHLEVBQUUsQ0FBQzhHLFdBQUgsQ0FBZS9CLElBQWYsRUFBcUJDLElBQXJCLEVBQTJCRyxPQUFPLENBQUNsRCxTQUFuQyxFQUE4Q21ELE9BQU8sQ0FBQ25ELFNBQXRELEVBQWlFb0QsT0FBakUsQ0FBdEI7QUFDQTFCLElBQUFBLGVBQWUsQ0FBQ2tELGFBQUQsRUFBZ0JMLEtBQWhCLENBQWY7QUFDQTdDLElBQUFBLGVBQWUsQ0FBQ2tELGFBQUQsRUFBZ0I7QUFDN0JyRSxNQUFBQSxDQUFDLEVBQUV1QyxJQUFJLENBQUNnQyxJQUFMLEdBQVlMLEtBQUssQ0FBQ2xFLENBRFE7QUFFN0JDLE1BQUFBLENBQUMsRUFBRWlFLEtBQUssQ0FBQ2pFLENBRm9CO0FBRzdCQyxNQUFBQSxLQUFLLEVBQUVnRSxLQUFLLENBQUNoRSxLQUhnQjtBQUk3QkMsTUFBQUEsTUFBTSxFQUFFK0QsS0FBSyxDQUFDL0Q7QUFKZSxLQUFoQixDQUFmO0FBTUFnRSxJQUFBQSxNQUFNLENBQUNFLGFBQVAsR0FBdUIsTUFBTTdHLEVBQUUsQ0FBQ2dILGFBQUgsQ0FBaUIsTUFBakIsRUFBeUJILGFBQXpCLENBQTdCO0FBQ0Q7O0FBQ0QsU0FBT0YsTUFBUDtBQUNEOztBQTRCRCxlQUFlTSxtQkFBZixDQUFvQzVDLFFBQXBDLEVBQThDQyxRQUE5QyxFQUF3REMsT0FBTyxHQUFHLEVBQWxFLEVBQXNFO0FBQ3BFLFFBQU05QyxVQUFVLEVBQWhCO0FBRUEsUUFBTTtBQUFDZ0QsSUFBQUEsU0FBUyxHQUFHO0FBQWIsTUFBc0JGLE9BQTVCO0FBQ0EsTUFBSSxDQUFDMkMsUUFBRCxFQUFXQyxTQUFYLElBQXdCLE1BQU0xRyxrQkFBRXdFLEdBQUYsQ0FBTSxDQUN0Q2pGLEVBQUUsQ0FBQ2tGLGFBQUgsQ0FBaUJiLFFBQWpCLENBRHNDLEVBRXRDckUsRUFBRSxDQUFDa0YsYUFBSCxDQUFpQlosUUFBakIsQ0FGc0MsQ0FBTixDQUFsQzs7QUFJQSxNQUFJNEMsUUFBUSxDQUFDRSxJQUFULEtBQWtCRCxTQUFTLENBQUNDLElBQTVCLElBQW9DRixRQUFRLENBQUNILElBQVQsS0FBa0JJLFNBQVMsQ0FBQ0osSUFBcEUsRUFBMEU7QUFDeEUsVUFBTSxJQUFJaEcsS0FBSixDQUFVLGdFQUNBLGlDQURWLENBQU47QUFFRDs7QUFDRCxHQUFDbUcsUUFBRCxFQUFXQyxTQUFYLElBQXdCLE1BQU0xRyxrQkFBRXdFLEdBQUYsQ0FBTSxDQUNsQ2lDLFFBQVEsQ0FBQ0csY0FBVCxDQUF3QnJILEVBQUUsQ0FBQ3NILE9BQTNCLENBRGtDLEVBRWxDSCxTQUFTLENBQUNFLGNBQVYsQ0FBeUJySCxFQUFFLENBQUNzSCxPQUE1QixDQUZrQyxDQUFOLENBQTlCO0FBS0EsTUFBSUMsT0FBSjs7QUFDQSxNQUFJO0FBQ0ZBLElBQUFBLE9BQU8sR0FBRyxNQUFNSixTQUFTLENBQUNLLGtCQUFWLENBQTZCTixRQUE3QixFQUF1Q2xILEVBQUUsQ0FBQ3lILGdCQUExQyxDQUFoQjtBQUNELEdBRkQsQ0FFRSxPQUFPbkMsQ0FBUCxFQUFVO0FBQ1YsVUFBTSxJQUFJdkUsS0FBSixDQUFXLDBFQUF5RXVFLENBQUMsQ0FBQ3pELE9BQVEsRUFBOUYsQ0FBTjtBQUNEOztBQUNELFFBQU02RixNQUFNLEdBQUcsTUFBTUgsT0FBTyxDQUFDSSxjQUFSLEVBQXJCO0FBQ0EsUUFBTWhCLE1BQU0sR0FBRztBQUNiaUIsSUFBQUEsS0FBSyxFQUFFRixNQUFNLENBQUNHO0FBREQsR0FBZjs7QUFHQSxNQUFJcEQsU0FBSixFQUFlO0FBQ2IsVUFBTXFELFNBQVMsR0FBRyxJQUFJOUgsRUFBRSxDQUFDK0gsR0FBUCxDQUFXYixRQUFRLENBQUNFLElBQXBCLEVBQTBCRixRQUFRLENBQUNILElBQVQsR0FBZ0IsQ0FBMUMsRUFBNkMvRyxFQUFFLENBQUNzSCxPQUFoRCxDQUFsQjtBQUNBLFVBQU03RyxrQkFBRXdFLEdBQUYsQ0FBTSxDQUNWa0MsU0FBUyxDQUFDYSxXQUFWLENBQ0VGLFNBQVMsQ0FBQ0csU0FBVixDQUFvQixJQUFJakksRUFBRSxDQUFDa0UsSUFBUCxDQUFZLENBQVosRUFBZSxDQUFmLEVBQWtCaUQsU0FBUyxDQUFDSixJQUE1QixFQUFrQ0ksU0FBUyxDQUFDQyxJQUE1QyxDQUFwQixDQURGLENBRFUsRUFHVkYsUUFBUSxDQUFDYyxXQUFULENBQ0VGLFNBQVMsQ0FBQ0csU0FBVixDQUFvQixJQUFJakksRUFBRSxDQUFDa0UsSUFBUCxDQUFZaUQsU0FBUyxDQUFDSixJQUF0QixFQUE0QixDQUE1QixFQUErQkcsUUFBUSxDQUFDSCxJQUF4QyxFQUE4Q0csUUFBUSxDQUFDRSxJQUF2RCxDQUFwQixDQURGLENBSFUsQ0FBTixDQUFOO0FBTUEsUUFBSWMsSUFBSSxHQUFHZixTQUFTLENBQUNnQixPQUFWLENBQWtCakIsUUFBbEIsQ0FBWDtBQUNBZ0IsSUFBQUEsSUFBSSxHQUFHLE1BQU1BLElBQUksQ0FBQ0UsYUFBTCxDQUFtQnBJLEVBQUUsQ0FBQ3FJLGNBQXRCLENBQWI7QUFDQSxRQUFJQyxRQUFRLEdBQUcsRUFBZjs7QUFDQSxRQUFJO0FBQ0ZKLE1BQUFBLElBQUksR0FBRyxNQUFNQSxJQUFJLENBQUNLLGNBQUwsQ0FBb0IsR0FBcEIsRUFBeUIsR0FBekIsRUFBOEJ2SSxFQUFFLENBQUN3SSxhQUFILEdBQW1CeEksRUFBRSxDQUFDeUksV0FBcEQsQ0FBYjtBQUNBSCxNQUFBQSxRQUFRLEdBQUcsTUFBTUosSUFBSSxDQUFDUSxpQkFBTCxDQUF1QjFJLEVBQUUsQ0FBQzJJLGFBQTFCLEVBQXlDM0ksRUFBRSxDQUFDNEksbUJBQTVDLENBQWpCO0FBQ0QsS0FIRCxDQUdFLE9BQU9DLEdBQVAsRUFBWSxDQUViOztBQUNELFNBQUssTUFBTUMsT0FBWCxJQUFzQlIsUUFBdEIsRUFBZ0M7QUFDOUIsWUFBTVMsWUFBWSxHQUFHRCxPQUFPLENBQUNDLFlBQVIsRUFBckI7QUFDQXBGLE1BQUFBLGVBQWUsQ0FBQ21FLFNBQUQsRUFBWWlCLFlBQVosQ0FBZjtBQUNBcEYsTUFBQUEsZUFBZSxDQUFDbUUsU0FBRCxFQUFZO0FBQ3pCdEYsUUFBQUEsQ0FBQyxFQUFFMkUsU0FBUyxDQUFDSixJQUFWLEdBQWlCZ0MsWUFBWSxDQUFDdkcsQ0FEUjtBQUV6QkMsUUFBQUEsQ0FBQyxFQUFFc0csWUFBWSxDQUFDdEcsQ0FGUztBQUd6QkMsUUFBQUEsS0FBSyxFQUFFcUcsWUFBWSxDQUFDckcsS0FISztBQUl6QkMsUUFBQUEsTUFBTSxFQUFFb0csWUFBWSxDQUFDcEc7QUFKSSxPQUFaLENBQWY7QUFNRDs7QUFDRGdFLElBQUFBLE1BQU0sQ0FBQ0UsYUFBUCxHQUF1QixNQUFNN0csRUFBRSxDQUFDZ0gsYUFBSCxDQUFpQixNQUFqQixFQUF5QmMsU0FBekIsQ0FBN0I7QUFDRDs7QUFDRCxTQUFPbkIsTUFBUDtBQUNEOztBQXNDRCxlQUFlcUMsa0JBQWYsQ0FBbUNDLFdBQW5DLEVBQWdEQyxjQUFoRCxFQUFnRTNFLE9BQU8sR0FBRyxFQUExRSxFQUE4RTtBQUM1RSxRQUFNOUMsVUFBVSxFQUFoQjtBQUVBLFFBQU07QUFBRWdELElBQUFBLFNBQVMsR0FBRyxLQUFkO0FBQ0UwRSxJQUFBQSxTQUFTLEdBQUdoSix1QkFEZDtBQUVFaUosSUFBQUEsUUFBUSxHQUFHLEtBRmI7QUFHRUMsSUFBQUEsdUJBQXVCLEdBQUdqSjtBQUg1QixNQUcwRG1FLE9BSGhFO0FBS0EsUUFBTSxDQUFDK0UsT0FBRCxFQUFVQyxVQUFWLElBQXdCLE1BQU05SSxrQkFBRXdFLEdBQUYsQ0FBTSxDQUN4Q2pGLEVBQUUsQ0FBQ2tGLGFBQUgsQ0FBaUIrRCxXQUFqQixDQUR3QyxFQUV4Q2pKLEVBQUUsQ0FBQ2tGLGFBQUgsQ0FBaUJnRSxjQUFqQixDQUZ3QyxDQUFOLENBQXBDO0FBSUEsUUFBTU0sT0FBTyxHQUFHLEVBQWhCO0FBQ0EsTUFBSTNDLGFBQWEsR0FBRyxJQUFwQjs7QUFFQSxNQUFJO0FBQ0YsVUFBTVUsT0FBTyxHQUFHLE1BQU0rQixPQUFPLENBQUM5QixrQkFBUixDQUEyQitCLFVBQTNCLEVBQXVDdkosRUFBRSxDQUFDeUgsZ0JBQTFDLENBQXRCO0FBQ0EsVUFBTUMsTUFBTSxHQUFHLE1BQU1ILE9BQU8sQ0FBQ0ksY0FBUixFQUFyQjs7QUFFQSxRQUFJeUIsUUFBSixFQUFjO0FBQ1osWUFBTUssbUJBQW1CLEdBQUdsQyxPQUFPLENBQUM0QixTQUFSLENBQWtCQSxTQUFsQixFQUE2QixDQUE3QixFQUFnQ25KLEVBQUUsQ0FBQ3dJLGFBQW5DLEVBQWtEa0IsU0FBbEQsQ0FBNEQxSixFQUFFLENBQUMySixLQUEvRCxFQUFzRUMsV0FBdEUsRUFBNUI7QUFDQSxZQUFNdkUsT0FBTyxHQUFHd0UsaUJBQWlCLENBQUNKLG1CQUFELEVBQXNCSix1QkFBdEIsQ0FBakM7O0FBRUEsV0FBSyxNQUFNUyxPQUFYLElBQXNCekUsT0FBdEIsRUFBK0I7QUFDN0JtRSxRQUFBQSxPQUFPLENBQUNPLElBQVIsQ0FBYTtBQUNYbkMsVUFBQUEsS0FBSyxFQUFFTCxPQUFPLENBQUN5QyxFQUFSLENBQVdGLE9BQU8sQ0FBQ3JILENBQW5CLEVBQXNCcUgsT0FBTyxDQUFDdEgsQ0FBOUIsQ0FESTtBQUVYeUgsVUFBQUEsSUFBSSxFQUFFO0FBQ0p6SCxZQUFBQSxDQUFDLEVBQUVzSCxPQUFPLENBQUN0SCxDQURQO0FBRUpDLFlBQUFBLENBQUMsRUFBRXFILE9BQU8sQ0FBQ3JILENBRlA7QUFHSkMsWUFBQUEsS0FBSyxFQUFFNkcsVUFBVSxDQUFDeEMsSUFIZDtBQUlKcEUsWUFBQUEsTUFBTSxFQUFFNEcsVUFBVSxDQUFDbkM7QUFKZjtBQUZLLFNBQWI7QUFTRDtBQUNGLEtBZkQsTUFlTyxJQUFJTSxNQUFNLENBQUNHLE1BQVAsSUFBaUJzQixTQUFyQixFQUFnQztBQUNyQ0ssTUFBQUEsT0FBTyxDQUFDTyxJQUFSLENBQWE7QUFDWG5DLFFBQUFBLEtBQUssRUFBRUYsTUFBTSxDQUFDRyxNQURIO0FBRVhvQyxRQUFBQSxJQUFJLEVBQUU7QUFDSnpILFVBQUFBLENBQUMsRUFBRWtGLE1BQU0sQ0FBQ3dDLE1BQVAsQ0FBYzFILENBRGI7QUFFSkMsVUFBQUEsQ0FBQyxFQUFFaUYsTUFBTSxDQUFDd0MsTUFBUCxDQUFjekgsQ0FGYjtBQUdKQyxVQUFBQSxLQUFLLEVBQUU2RyxVQUFVLENBQUN4QyxJQUhkO0FBSUpwRSxVQUFBQSxNQUFNLEVBQUU0RyxVQUFVLENBQUNuQztBQUpmO0FBRkssT0FBYjtBQVNEOztBQUVELFFBQUl4RyxnQkFBRXVKLE9BQUYsQ0FBVVgsT0FBVixDQUFKLEVBQXdCO0FBRXRCLFlBQU0sSUFBSXpJLEtBQUosQ0FBVyxvQkFBbUJvSSxTQUFVLHdCQUE5QixHQUNDLGFBQVl6QixNQUFNLENBQUNHLE1BQU8sRUFEckMsQ0FBTjtBQUVEO0FBQ0YsR0FwQ0QsQ0FvQ0UsT0FBT3ZDLENBQVAsRUFBVTtBQUVWLFVBQU0sSUFBSXZFLEtBQUosQ0FBVyxzRUFBRCxHQUNiLG1CQUFrQnVFLENBQUMsQ0FBQ3pELE9BQVEsRUFEekIsQ0FBTjtBQUVEOztBQUVELE1BQUk0QyxTQUFKLEVBQWU7QUFDYixVQUFNMkYsb0JBQW9CLEdBQUdkLE9BQU8sQ0FBQ2UsSUFBUixFQUE3Qjs7QUFFQSxTQUFLLE1BQU0xRCxNQUFYLElBQXFCNkMsT0FBckIsRUFBOEI7QUFDNUIsWUFBTWMsc0JBQXNCLEdBQUdoQixPQUFPLENBQUNlLElBQVIsRUFBL0I7QUFFQTFHLE1BQUFBLGVBQWUsQ0FBQzJHLHNCQUFELEVBQXlCM0QsTUFBTSxDQUFDc0QsSUFBaEMsQ0FBZjtBQUNBdEcsTUFBQUEsZUFBZSxDQUFDeUcsb0JBQUQsRUFBdUJ6RCxNQUFNLENBQUNzRCxJQUE5QixDQUFmO0FBQ0F0RCxNQUFBQSxNQUFNLENBQUNFLGFBQVAsR0FBdUIsTUFBTTdHLEVBQUUsQ0FBQ2dILGFBQUgsQ0FBaUIsTUFBakIsRUFBeUJzRCxzQkFBekIsQ0FBN0I7QUFDRDs7QUFDRHpELElBQUFBLGFBQWEsR0FBRyxNQUFNN0csRUFBRSxDQUFDZ0gsYUFBSCxDQUFpQixNQUFqQixFQUF5Qm9ELG9CQUF6QixDQUF0QjtBQUNEOztBQUVELFNBQU87QUFDTEgsSUFBQUEsSUFBSSxFQUFFVCxPQUFPLENBQUMsQ0FBRCxDQUFQLENBQVdTLElBRFo7QUFFTHJDLElBQUFBLEtBQUssRUFBRTRCLE9BQU8sQ0FBQyxDQUFELENBQVAsQ0FBVzVCLEtBRmI7QUFHTGYsSUFBQUEsYUFISztBQUlMdUMsSUFBQUEsUUFBUSxFQUFFSTtBQUpMLEdBQVA7QUFNRDs7QUFVRCxTQUFTSyxpQkFBVCxDQUE0QkosbUJBQTVCLEVBQWlESix1QkFBakQsRUFBMEU7QUFDeEUsU0FBT0ksbUJBQW1CLENBQUNjLE1BQXBCLENBQTJCLENBQUNDLEdBQUQsRUFBTVYsT0FBTixLQUFrQjtBQUNsRCxRQUFJLENBQUNVLEdBQUcsQ0FBQ0MsSUFBSixDQUFVL0UsS0FBRCxJQUFXQyxRQUFRLENBQUNELEtBQUQsRUFBUW9FLE9BQVIsQ0FBUixJQUE0QlQsdUJBQWhELENBQUwsRUFBK0U7QUFDN0VtQixNQUFBQSxHQUFHLENBQUNULElBQUosQ0FBU0QsT0FBVDtBQUNEOztBQUNELFdBQU9VLEdBQVA7QUFDRCxHQUxNLEVBS0osRUFMSSxDQUFQO0FBTUQ7O0FBU0QsU0FBUzdFLFFBQVQsQ0FBbUIrRSxNQUFuQixFQUEyQkMsTUFBM0IsRUFBbUM7QUFDakMsUUFBTUMsRUFBRSxHQUFHN0gsSUFBSSxDQUFDOEgsR0FBTCxDQUFVSCxNQUFNLENBQUNsSSxDQUFQLEdBQVdtSSxNQUFNLENBQUNuSSxDQUE1QixFQUFnQyxDQUFoQyxDQUFYO0FBQ0EsUUFBTXNJLEVBQUUsR0FBRy9ILElBQUksQ0FBQzhILEdBQUwsQ0FBVUgsTUFBTSxDQUFDakksQ0FBUCxHQUFXa0ksTUFBTSxDQUFDbEksQ0FBNUIsRUFBZ0MsQ0FBaEMsQ0FBWDtBQUNBLFNBQU9NLElBQUksQ0FBQ0MsSUFBTCxDQUFVNEgsRUFBRSxHQUFHRSxFQUFmLENBQVA7QUFDRDs7QUFTRCxlQUFlQyxlQUFmLENBQWdDQyxXQUFoQyxFQUE2Q2YsSUFBN0MsRUFBbUQ7QUFDakQsUUFBTWdCLEtBQUssR0FBRyxNQUFNQyxhQUFhLENBQUNGLFdBQUQsQ0FBakM7QUFDQUcsRUFBQUEsU0FBUyxDQUFDRixLQUFELEVBQVFoQixJQUFSLENBQVQ7QUFDQSxTQUFPLE1BQU1tQixhQUFhLENBQUNILEtBQUQsQ0FBMUI7QUFDRDs7QUFRRCxlQUFlQyxhQUFmLENBQThCRixXQUE5QixFQUEyQztBQUN6QyxRQUFNSyxXQUFXLEdBQUdySyxlQUFPQyxJQUFQLENBQVkrSixXQUFaLEVBQXlCLFFBQXpCLENBQXBCOztBQUNBLFNBQU8sTUFBTSxJQUFJdkssaUJBQUosQ0FBTSxDQUFDQyxPQUFELEVBQVVDLE1BQVYsS0FBcUI7QUFDdEMsVUFBTXNLLEtBQUssR0FBRyxJQUFJSyxVQUFKLENBQVE7QUFBQ0MsTUFBQUEsVUFBVSxFQUFFckw7QUFBYixLQUFSLENBQWQ7QUFDQStLLElBQUFBLEtBQUssQ0FBQ08sS0FBTixDQUFZSCxXQUFaLEVBQXlCLENBQUNuSyxHQUFELEVBQU0rSixLQUFOLEtBQWdCO0FBQ3ZDLFVBQUkvSixHQUFKLEVBQVM7QUFDUCxlQUFPUCxNQUFNLENBQUNPLEdBQUQsQ0FBYjtBQUNEOztBQUNEUixNQUFBQSxPQUFPLENBQUN1SyxLQUFELENBQVA7QUFDRCxLQUxEO0FBTUQsR0FSWSxDQUFiO0FBU0Q7O0FBUUQsZUFBZUcsYUFBZixDQUE4QkgsS0FBOUIsRUFBcUM7QUFDbkMsU0FBTyxNQUFNLElBQUl4SyxpQkFBSixDQUFNLENBQUNDLE9BQUQsRUFBVUMsTUFBVixLQUFxQjtBQUN0QyxVQUFNOEssTUFBTSxHQUFHLEVBQWY7QUFDQVIsSUFBQUEsS0FBSyxDQUFDUyxJQUFOLEdBQ0NDLEVBREQsQ0FDSSxNQURKLEVBQ2FDLEtBQUQsSUFBV0gsTUFBTSxDQUFDMUIsSUFBUCxDQUFZNkIsS0FBWixDQUR2QixFQUMyQ0QsRUFEM0MsQ0FDOEMsS0FEOUMsRUFDcUQsTUFBTTtBQUN6RGpMLE1BQUFBLE9BQU8sQ0FBQ00sZUFBTzZLLE1BQVAsQ0FBY0osTUFBZCxFQUFzQkssUUFBdEIsQ0FBK0IsUUFBL0IsQ0FBRCxDQUFQO0FBQ0QsS0FIRCxFQUlDSCxFQUpELENBSUksT0FKSixFQUljekssR0FBRCxJQUFTO0FBQ3BCUCxNQUFBQSxNQUFNLENBQUNPLEdBQUQsQ0FBTjtBQUNELEtBTkQ7QUFPRCxHQVRZLENBQWI7QUFVRDs7QUFRRCxTQUFTaUssU0FBVCxDQUFvQkYsS0FBcEIsRUFBMkJoQixJQUEzQixFQUFpQztBQUMvQixRQUFNOEIsU0FBUyxHQUFHO0FBQUNySixJQUFBQSxLQUFLLEVBQUV1SSxLQUFLLENBQUN2SSxLQUFkO0FBQXFCQyxJQUFBQSxNQUFNLEVBQUVzSSxLQUFLLENBQUN0STtBQUFuQyxHQUFsQjtBQUNBLFFBQU1xSixTQUFTLEdBQUdDLG1CQUFtQixDQUFDaEMsSUFBRCxFQUFPOEIsU0FBUCxDQUFyQzs7QUFDQSxNQUFJQyxTQUFTLENBQUN0SixLQUFWLEdBQWtCdUgsSUFBSSxDQUFDdkgsS0FBdkIsSUFBZ0NzSixTQUFTLENBQUNySixNQUFWLEdBQW1Cc0gsSUFBSSxDQUFDdEgsTUFBNUQsRUFBb0U7QUFDbEUsVUFBTSxJQUFJNUIsS0FBSixDQUFXLGVBQWM4RCxJQUFJLENBQUNDLFNBQUwsQ0FBZW1GLElBQWYsQ0FBcUIsU0FBUXBGLElBQUksQ0FBQ0MsU0FBTCxDQUFlaUgsU0FBZixDQUEwQixxRUFBaEYsQ0FBTjtBQUNEOztBQUVELFFBQU1HLGtCQUFrQixHQUFHRixTQUFTLENBQUNHLEdBQXJDO0FBQ0EsUUFBTUMsaUJBQWlCLEdBQUdKLFNBQVMsQ0FBQ0csR0FBVixHQUFnQkgsU0FBUyxDQUFDckosTUFBcEQ7QUFFQSxRQUFNMEosb0JBQW9CLEdBQUdMLFNBQVMsQ0FBQ00sSUFBdkM7QUFDQSxRQUFNQyxtQkFBbUIsR0FBR1AsU0FBUyxDQUFDTSxJQUFWLEdBQWlCTixTQUFTLENBQUN0SixLQUF2RDtBQUVBLFFBQU04SixZQUFZLEdBQUcsRUFBckI7O0FBQ0EsT0FBSyxJQUFJL0osQ0FBQyxHQUFHeUosa0JBQWIsRUFBaUN6SixDQUFDLEdBQUcySixpQkFBckMsRUFBd0QzSixDQUFDLEVBQXpELEVBQTZEO0FBQzNELFNBQUssSUFBSUQsQ0FBQyxHQUFHNkosb0JBQWIsRUFBbUM3SixDQUFDLEdBQUcrSixtQkFBdkMsRUFBNEQvSixDQUFDLEVBQTdELEVBQWlFO0FBQy9ELFlBQU1pSyx3QkFBd0IsR0FBSVYsU0FBUyxDQUFDckosS0FBVixHQUFrQkQsQ0FBbEIsR0FBc0JELENBQXZCLElBQTZCLENBQTlEOztBQUNBLFdBQUssSUFBSWtLLE9BQU8sR0FBRyxDQUFuQixFQUFzQkEsT0FBTyxHQUFHek0sb0JBQWhDLEVBQXNEeU0sT0FBTyxFQUE3RCxFQUFpRTtBQUMvREYsUUFBQUEsWUFBWSxDQUFDekMsSUFBYixDQUFrQmtCLEtBQUssQ0FBQ3pLLElBQU4sQ0FBV2lNLHdCQUF3QixHQUFHQyxPQUF0QyxDQUFsQjtBQUNEO0FBQ0Y7QUFDRjs7QUFFRHpCLEVBQUFBLEtBQUssQ0FBQ3pLLElBQU4sR0FBYVEsZUFBT0MsSUFBUCxDQUFZdUwsWUFBWixDQUFiO0FBQ0F2QixFQUFBQSxLQUFLLENBQUN2SSxLQUFOLEdBQWNzSixTQUFTLENBQUN0SixLQUF4QjtBQUNBdUksRUFBQUEsS0FBSyxDQUFDdEksTUFBTixHQUFlcUosU0FBUyxDQUFDckosTUFBekI7QUFDQSxTQUFPc0ksS0FBUDtBQUNEOztBQUVELFNBQVNnQixtQkFBVCxDQUE4QmhDLElBQTlCLEVBQW9DMEMsU0FBcEMsRUFBK0M7QUFDN0MsUUFBTUwsSUFBSSxHQUFHckMsSUFBSSxDQUFDcUMsSUFBTCxJQUFhSyxTQUFTLENBQUNqSyxLQUF2QixHQUErQmlLLFNBQVMsQ0FBQ2pLLEtBQXpDLEdBQWlEdUgsSUFBSSxDQUFDcUMsSUFBbkU7QUFDQSxRQUFNSCxHQUFHLEdBQUdsQyxJQUFJLENBQUNrQyxHQUFMLElBQVlRLFNBQVMsQ0FBQ2hLLE1BQXRCLEdBQStCZ0ssU0FBUyxDQUFDaEssTUFBekMsR0FBa0RzSCxJQUFJLENBQUNrQyxHQUFuRTtBQUNBLFFBQU16SixLQUFLLEdBQUdpSyxTQUFTLENBQUNqSyxLQUFWLElBQW9CNEosSUFBSSxHQUFHckMsSUFBSSxDQUFDdkgsS0FBaEMsR0FBeUN1SCxJQUFJLENBQUN2SCxLQUE5QyxHQUF1RGlLLFNBQVMsQ0FBQ2pLLEtBQVYsR0FBa0I0SixJQUF2RjtBQUNBLFFBQU0zSixNQUFNLEdBQUdnSyxTQUFTLENBQUNoSyxNQUFWLElBQXFCd0osR0FBRyxHQUFHbEMsSUFBSSxDQUFDdEgsTUFBaEMsR0FBMENzSCxJQUFJLENBQUN0SCxNQUEvQyxHQUF5RGdLLFNBQVMsQ0FBQ2hLLE1BQVYsR0FBbUJ3SixHQUEzRjtBQUNBLFNBQU87QUFBQ0csSUFBQUEsSUFBRDtBQUFPSCxJQUFBQSxHQUFQO0FBQVl6SixJQUFBQSxLQUFaO0FBQW1CQyxJQUFBQTtBQUFuQixHQUFQO0FBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IEppbXAgZnJvbSAnamltcCc7XG5pbXBvcnQgeyBCdWZmZXIgfSBmcm9tICdidWZmZXInO1xuaW1wb3J0IHsgUE5HIH0gZnJvbSAncG5nanMnO1xuaW1wb3J0IEIgZnJvbSAnYmx1ZWJpcmQnO1xuaW1wb3J0IHsgaGFzVmFsdWUgfSBmcm9tICcuL3V0aWwnO1xuaW1wb3J0IGxvZyBmcm9tICcuL2xvZ2dlcic7XG5pbXBvcnQgeyByZXF1aXJlUGFja2FnZSB9IGZyb20gJy4vbm9kZSc7XG5cblxuY29uc3QgeyBNSU1FX0pQRUcsIE1JTUVfUE5HLCBNSU1FX0JNUCB9ID0gSmltcDtcbmxldCBjdiA9IG51bGw7XG5cbi8qKlxuICogQHR5cGVkZWYge09iamVjdH0gUmVnaW9uXG4gKiBAcHJvcGVydHkge251bWJlcn0gbGVmdCAtIFRoZSBvZmZzZXQgZnJvbSB0aGUgbGVmdCBzaWRlXG4gKiBAcHJvcGVydHkge251bWJlcn0gdG9wIC0gVGhlIG9mZnNldCBmcm9tIHRoZSB0b3BcbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSB3aWR0aCAtIFRoZSB3aWR0aFxuICogQHByb3BlcnR5IHtudW1iZXJ9IGhlaWdodCAtIFRoZSBoZWlnaHRcbiAqL1xuXG4vKipcbiAqIEB0eXBlZGVmIHtPYmplY3R9IFBvaW50XG4gKiBAcHJvcGVydHkge251bWJlcn0geCAtIFRoZSB4IGNvb3JkaW5hdGVcbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSB5IC0gVGhlIHkgY29vcmRpbmF0ZVxuICovXG5cbi8qKlxuICogQHR5cGVkZWYge09iamVjdH0gUmVjdFxuICogQHByb3BlcnR5IHtudW1iZXJ9IHggLSBUaGUgdG9wIGxlZnQgY29vcmRpbmF0ZVxuICogQHByb3BlcnR5IHtudW1iZXJ9IHkgLSBUaGUgYm90dG9tIHJpZ2h0IGNvb3JkaW5hdGVcbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSB3aWR0aCAtIFRoZSB3aWR0aFxuICogQHByb3BlcnR5IHtudW1iZXJ9IGhlaWdodCAtIFRoZSBoZWlnaHRcbiAqL1xuXG5jb25zdCBCWVRFU19JTl9QSVhFTF9CTE9DSyA9IDQ7XG5jb25zdCBTQ0FOTElORV9GSUxURVJfTUVUSE9EID0gNDtcbmNvbnN0IERFRkFVTFRfTUFUQ0hfVEhSRVNIT0xEID0gMC41O1xuY29uc3QgTUFUQ0hfTkVJR0hCT1VSX1RIUkVTSE9MRCA9IDEwO1xuXG5jb25zdCBBVkFJTEFCTEVfREVURUNUT1JTID0gW1xuICAnQUtBWkUnLFxuICAnQUdBU1QnLFxuICAnQlJJU0snLFxuICAnRkFTVCcsXG4gICdHRlRUJyxcbiAgJ0tBWkUnLFxuICAnTVNFUicsXG4gICdTSUZUJyxcbiAgJ09SQicsXG5dO1xuXG5jb25zdCBBVkFJTEFCTEVfTUFUQ0hJTkdfRlVOQ1RJT05TID0gW1xuICAnRmxhbm5CYXNlZCcsXG4gICdCcnV0ZUZvcmNlJyxcbiAgJ0JydXRlRm9yY2VMMScsXG4gICdCcnV0ZUZvcmNlSGFtbWluZycsXG4gICdCcnV0ZUZvcmNlSGFtbWluZ0x1dCcsXG4gICdCcnV0ZUZvcmNlU0wyJyxcbl07XG5cbi8qKlxuICogVXRpbGl0eSBmdW5jdGlvbiB0byBnZXQgYSBKaW1wIGltYWdlIG9iamVjdCBmcm9tIGJ1ZmZlciBvciBiYXNlNjQgZGF0YS4gSmltcFxuICogaXMgYSBncmVhdCBsaWJyYXJ5IGhvd2V2ZXIgaXQgZG9lcyBJTyBpbiB0aGUgY29uc3RydWN0b3Igc28gaXQncyBub3RcbiAqIGNvbnZlbmllbnQgZm9yIG91ciBhc3luYy9hd2FpdCBtb2RlbC5cbiAqXG4gKiBAcGFyYW0ge0J1ZmZlcnxzdHJpbmd9IGRhdGEgLSBiaW5hcnkgaW1hZ2UgYnVmZmVyIG9yIGJhc2U2NC1lbmNvZGVkIGltYWdlXG4gKiBzdHJpbmdcbiAqIEByZXR1cm5zIHtKaW1wfSAtIHRoZSBqaW1wIGltYWdlIG9iamVjdFxuICovXG5hc3luYyBmdW5jdGlvbiBnZXRKaW1wSW1hZ2UgKGRhdGEpIHtcbiAgcmV0dXJuIGF3YWl0IG5ldyBCKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICBpZiAoIV8uaXNTdHJpbmcoZGF0YSkgJiYgIV8uaXNCdWZmZXIoZGF0YSkpIHtcbiAgICAgIHJldHVybiByZWplY3QobmV3IEVycm9yKCdNdXN0IGluaXRpYWxpemUgamltcCBvYmplY3Qgd2l0aCBzdHJpbmcgb3IgYnVmZmVyJykpO1xuICAgIH1cbiAgICAvLyBpZiBkYXRhIGlzIGEgc3RyaW5nLCBhc3N1bWUgaXQgaXMgYSBiYXNlNjQtZW5jb2RlZCBpbWFnZVxuICAgIGlmIChfLmlzU3RyaW5nKGRhdGEpKSB7XG4gICAgICBkYXRhID0gQnVmZmVyLmZyb20oZGF0YSwgJ2Jhc2U2NCcpO1xuICAgIH1cbiAgICBuZXcgSmltcChkYXRhLCAoZXJyLCBpbWdPYmopID0+IHtcbiAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgcmV0dXJuIHJlamVjdChlcnIpO1xuICAgICAgfVxuICAgICAgaWYgKCFpbWdPYmopIHtcbiAgICAgICAgcmV0dXJuIHJlamVjdChuZXcgRXJyb3IoJ0NvdWxkIG5vdCBjcmVhdGUgamltcCBpbWFnZSBmcm9tIHRoYXQgZGF0YScpKTtcbiAgICAgIH1cbiAgICAgIGltZ09iai5fZ2V0QnVmZmVyID0gaW1nT2JqLmdldEJ1ZmZlci5iaW5kKGltZ09iaik7XG4gICAgICBpbWdPYmouZ2V0QnVmZmVyID0gQi5wcm9taXNpZnkoaW1nT2JqLl9nZXRCdWZmZXIsIHtjb250ZXh0OiBpbWdPYmp9KTtcbiAgICAgIHJlc29sdmUoaW1nT2JqKTtcbiAgICB9KTtcbiAgfSk7XG59XG5cbi8qKlxuICogQHRocm93cyB7RXJyb3J9IElmIG9wZW5jdjRub2RlanMgbW9kdWxlIGlzIG5vdCBpbnN0YWxsZWQgb3IgY2Fubm90IGJlIGxvYWRlZFxuICovXG5hc3luYyBmdW5jdGlvbiBpbml0T3BlbkNWICgpIHtcbiAgaWYgKGN2KSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgbG9nLmRlYnVnKGBJbml0aWFsaXppbmcgb3BlbmN2YCk7XG4gIHRyeSB7XG4gICAgY3YgPSBhd2FpdCByZXF1aXJlUGFja2FnZSgnb3BlbmN2NG5vZGVqcycpO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBsb2cud2FybihgVW5hYmxlIHRvIGxvYWQgJ29wZW5jdjRub2RlanMnOiAke2Vyci5tZXNzYWdlfWApO1xuICB9XG5cbiAgaWYgKCFjdikge1xuICAgIHRocm93IG5ldyBFcnJvcihgJ29wZW5jdjRub2RlanMnIG1vZHVsZSBpcyByZXF1aXJlZCB0byB1c2UgT3BlbkNWIGZlYXR1cmVzLiBgICtcbiAgICAgICAgICAgICAgICAgICAgYFBsZWFzZSBpbnN0YWxsIGl0IGZpcnN0ICgnbnBtIGkgLWcgb3BlbmN2NG5vZGVqcycpIGFuZCByZXN0YXJ0IEFwcGl1bS4gYCArXG4gICAgICAgICAgICAgICAgICAgICdSZWFkIGh0dHBzOi8vZ2l0aHViLmNvbS9qdXN0YWR1ZGV3aG9oYWNrcy9vcGVuY3Y0bm9kZWpzI2hvdy10by1pbnN0YWxsIGZvciBtb3JlIGRldGFpbHMgb24gdGhpcyB0b3BpYy4nKTtcbiAgfVxufVxuXG4vKipcbiAqIEB0eXBlZGVmIHtPYmplY3R9IE1hdGNoQ29tcHV0YXRpb25SZXN1bHRcbiAqIEBwcm9wZXJ0eSB7Y3YuRGVzY3JpcHRvck1hdGNofSBkZXNjaXB0b3IgLSBPcGVuQ1YgbWF0Y2ggZGVzY3JpcHRvclxuICogQHByb3BlcnR5IHtBcnJheTxjdi5LZXlQb2ludD59IGtleVBvaW50cyAtIFRoZSBhcnJheSBvZiBrZXkgcG9pbnRzXG4gKi9cblxuLyoqXG4gKiBDYWxjdWxhdGVzIGFuIE9wZW5DViBtYXRjaCBkZXNjcmlwdG9yIG9mIGFuIGltYWdlLCB3aGljaCBjYW4gYmUgdXNlZFxuICogZm9yIGJydXRlLWZvcmNlIG1hdGNoaW5nLlxuICogUmVhZCBodHRwczovL2RvY3Mub3BlbmN2Lm9yZy8zLjAtYmV0YS9kb2MvcHlfdHV0b3JpYWxzL3B5X2ZlYXR1cmUyZC9weV9tYXRjaGVyL3B5X21hdGNoZXIuaHRtbFxuICogZm9yIG1vcmUgZGV0YWlscy5cbiAqXG4gKiBAcGFyYW0ge2N2Lk1hdH0gaW1nIEltYWdlIGRhdGFcbiAqIEBwYXJhbSB7Y3YuRmVhdHVyZURldGVjdG9yfSBkZXRlY3RvciBPcGVuQ1YgZmVhdHVyZSBkZXRlY3RvciBpbnN0YW5jZVxuICpcbiAqIEByZXR1cm5zIHtNYXRjaENvbXB1dGF0aW9uUmVzdWx0fVxuICovXG5hc3luYyBmdW5jdGlvbiBkZXRlY3RBbmRDb21wdXRlIChpbWcsIGRldGVjdG9yKSB7XG4gIGNvbnN0IGtleVBvaW50cyA9IGF3YWl0IGRldGVjdG9yLmRldGVjdEFzeW5jKGltZyk7XG4gIGNvbnN0IGRlc2NyaXB0b3IgPSBhd2FpdCBkZXRlY3Rvci5jb21wdXRlQXN5bmMoaW1nLCBrZXlQb2ludHMpO1xuICByZXR1cm4ge1xuICAgIGtleVBvaW50cyxcbiAgICBkZXNjcmlwdG9yXG4gIH07XG59XG5cbi8qKlxuICogQ2FsY3VsYXRlZCB0aGUgYm91bmRpbmcgcmVjdCBjb29yZGluYXRlcyBmb3IgdGhlIGFycmF5IG9mIG1hdGNoaW5nIHBvaW50c1xuICpcbiAqIEBwYXJhbSB7QXJyYXk8UG9pbnQ+fSBtYXRjaGVkUG9pbnRzIEFycmF5IG9mIG1hdGNoaW5nIHBvaW50c1xuICogQHJldHVybnMge1JlY3R9IFRoZSBtYXRjaGluZyBib3VuZGluZyByZWN0IG9yIGEgemVybyByZWN0IGlmIG5vIG1hdGNoXG4gKiBjYW4gYmUgZm91bmQuXG4gKi9cbmZ1bmN0aW9uIGNhbGN1bGF0ZU1hdGNoZWRSZWN0IChtYXRjaGVkUG9pbnRzKSB7XG4gIGlmIChtYXRjaGVkUG9pbnRzLmxlbmd0aCA8IDIpIHtcbiAgICByZXR1cm4ge1xuICAgICAgeDogMCxcbiAgICAgIHk6IDAsXG4gICAgICB3aWR0aDogMCxcbiAgICAgIGhlaWdodDogMFxuICAgIH07XG4gIH1cblxuICBjb25zdCBwb2ludHNTb3J0ZWRCeURpc3RhbmNlID0gbWF0Y2hlZFBvaW50c1xuICAgIC5tYXAoKHBvaW50KSA9PiBbTWF0aC5zcXJ0KHBvaW50LnggKiBwb2ludC54ICsgcG9pbnQueSAqIHBvaW50LnkpLCBwb2ludF0pXG4gICAgLnNvcnQoKHBhaXIxLCBwYWlyMikgPT4gcGFpcjFbMF0gPj0gcGFpcjJbMF0pXG4gICAgLm1hcCgocGFpcikgPT4gcGFpclsxXSk7XG4gIGNvbnN0IGZpcnN0UG9pbnQgPSBfLmhlYWQocG9pbnRzU29ydGVkQnlEaXN0YW5jZSk7XG4gIGNvbnN0IGxhc3RQb2ludCA9IF8ubGFzdChwb2ludHNTb3J0ZWRCeURpc3RhbmNlKTtcbiAgY29uc3QgdG9wTGVmdFBvaW50ID0ge1xuICAgIHg6IGZpcnN0UG9pbnQueCA8PSBsYXN0UG9pbnQueCA/IGZpcnN0UG9pbnQueCA6IGxhc3RQb2ludC54LFxuICAgIHk6IGZpcnN0UG9pbnQueSA8PSBsYXN0UG9pbnQueSA/IGZpcnN0UG9pbnQueSA6IGxhc3RQb2ludC55LFxuICB9O1xuICBjb25zdCBib3R0b21SaWdodFBvaW50ID0ge1xuICAgIHg6IGZpcnN0UG9pbnQueCA+PSBsYXN0UG9pbnQueCA/IGZpcnN0UG9pbnQueCA6IGxhc3RQb2ludC54LFxuICAgIHk6IGZpcnN0UG9pbnQueSA+PSBsYXN0UG9pbnQueSA/IGZpcnN0UG9pbnQueSA6IGxhc3RQb2ludC55LFxuICB9O1xuICByZXR1cm4ge1xuICAgIHg6IHRvcExlZnRQb2ludC54LFxuICAgIHk6IHRvcExlZnRQb2ludC55LFxuICAgIHdpZHRoOiBib3R0b21SaWdodFBvaW50LnggLSB0b3BMZWZ0UG9pbnQueCxcbiAgICBoZWlnaHQ6IGJvdHRvbVJpZ2h0UG9pbnQueSAtIHRvcExlZnRQb2ludC55XG4gIH07XG59XG5cbi8qKlxuICogRHJhd3MgYSByZWN0YW5uZ2xlIG9uIHRoZSBnaXZlbiBpbWFnZSBtYXRyaXhcbiAqXG4gKiBAcGFyYW0ge2N2Lk1hdH0gbWF0IFRoZSBzb3VyY2UgaW1hZ2VcbiAqIEBwYXJhbSB7UmVjdH0gcmVnaW9uIFRoZSByZWdpb24gdG8gaGlnaGxpZ2h0XG4gKlxuICogQHJldHVybnMge2N2Lk1hdH0gVGhlIHNhbWUgaW1hZ2Ugd2l0aCB0aGUgcmVjdGFuZ2Ugb24gaXRcbiAqL1xuZnVuY3Rpb24gaGlnaGxpZ2h0UmVnaW9uIChtYXQsIHJlZ2lvbikge1xuICBpZiAocmVnaW9uLndpZHRoIDw9IDAgfHwgcmVnaW9uLmhlaWdodCA8PSAwKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gaGlnaGxpZ2h0IGluIHJlZFxuICBjb25zdCBjb2xvciA9IG5ldyBjdi5WZWMoMCwgMCwgMjU1KTtcbiAgY29uc3QgdGhpY2tuZXNzID0gMjtcbiAgbWF0LmRyYXdSZWN0YW5nbGUobmV3IGN2LlJlY3QocmVnaW9uLngsIHJlZ2lvbi55LCByZWdpb24ud2lkdGgsIHJlZ2lvbi5oZWlnaHQpLCBjb2xvciwgdGhpY2tuZXNzLCBjdi5MSU5FXzgpO1xuICByZXR1cm4gbWF0O1xufVxuXG4vKipcbiAqIEB0eXBlZGVmIHtPYmplY3R9IE1hdGNoaW5nT3B0aW9uc1xuICogQHByb3BlcnR5IHs/c3RyaW5nfSBkZXRlY3Rvck5hbWUgWydPUkInXSBPbmUgb2YgcG9zc2libGUgT3BlbkNWIGZlYXR1cmUgZGV0ZWN0b3IgbmFtZXNcbiAqIGZyb20gYEFWQUlMQUJMRV9ERVRFQ1RPUlNgIGFycmF5LlxuICogU29tZSBvZiB0aGVzZSBtZXRob2RzIChGQVNULCBBR0FTVCwgR0ZUVCwgRkFTVCwgU0lGVCBhbmQgTVNFUikgYXJlIG5vdCBhdmFpbGFibGVcbiAqIGluIHRoZSBkZWZhdWx0IE9wZW5DViBpbnN0YWxsYXRpb24gYW5kIGhhdmUgdG8gYmUgZW5hYmxlZCBtYW51YWxseSBiZWZvcmVcbiAqIGxpYnJhcnkgY29tcGlsYXRpb24uXG4gKiBAcHJvcGVydHkgez9zdHJpbmd9IG1hdGNoRnVuYyBbJ0JydXRlRm9yY2UnXSBUaGUgbmFtZSBvZiB0aGUgbWF0Y2hpbmcgZnVuY3Rpb24uXG4gKiBTaG91bGQgYmUgb25lIG9mIGBBVkFJTEFCTEVfTUFUQ0hJTkdfRlVOQ1RJT05TYCBhcnJheS5cbiAqIEBwcm9wZXJ0eSB7P251bWJlcnxGdW5jdGlvbn0gZ29vZE1hdGNoZXNGYWN0b3IgVGhlIG1heGltdW0gY291bnQgb2YgXCJnb29kXCIgbWF0Y2hlc1xuICogKGUuIGcuIHdpdGggbWluaW1hbCBkaXN0YW5jZXMpIG9yIGEgZnVuY3Rpb24sIHdoaWNoIGFjY2VwdHMgMyBhcmd1bWVudHM6IHRoZSBjdXJyZW50IGRpc3RhbmNlLFxuICogbWluaW1hbCBkaXN0YW5jZSwgbWF4aW11bSBkaXN0YW5jZSBhbmQgcmV0dXJucyB0cnVlIG9yIGZhbHNlIHRvIGluY2x1ZGUgb3IgZXhjbHVkZSB0aGUgbWF0Y2guXG4gKiBAcHJvcGVydHkgez9ib29sZWFufSB2aXN1YWxpemUgW2ZhbHNlXSBXaGV0aGVyIHRvIHJldHVybiB0aGUgcmVzdWx0aW5nIHZpc2FsaXphdGlvblxuICogYXMgYW4gaW1hZ2UgKHVzZWZ1bCBmb3IgZGVidWdnaW5nIHB1cnBvc2VzKVxuICovXG5cbi8qKlxuICogQHR5cGVkZWYge09iamVjdH0gTWF0Y2hpbmdSZXN1bHRcbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBjb3VudCBUaGUgY291bnQgb2YgbWF0Y2hlZCBlZGdlcyBvbiBib3RoIGltYWdlcy5cbiAqIFRoZSBtb3JlIG1hdGNoaW5nIGVkZ2VzIHRoZXJlIGFyZSBubyBib3RoIGltYWdlcyB0aGUgbW9yZSBzaW1pbGFyIHRoZXkgYXJlLlxuICogQHByb3BlcnR5IHtudW1iZXJ9IHRvdGFsQ291bnQgVGhlIHRvdGFsIGNvdW50IG9mIG1hdGNoZWQgZWRnZXMgb24gYm90aCBpbWFnZXMuXG4gKiBJdCBpcyBlcXVhbCB0byBgY291bnRgIGlmIGBnb29kTWF0Y2hlc0ZhY3RvcmAgZG9lcyBub3QgbGltaXQgdGhlIG1hdGNoZXMsXG4gKiBvdGhlcndpc2UgaXQgY29udGFpbnMgdGhlIHRvdGFsIGNvdW50IG9mIG1hdGNoZXMgYmVmb3JlIGBnb29kTWF0Y2hlc0ZhY3RvcmAgaXNcbiAqIGFwcGxpZWQuXG4gKiBAcHJvcGVydHkgez9CdWZmZXJ9IHZpc3VhbGl6YXRpb24gVGhlIHZpc3VhbGl6YXRpb24gb2YgdGhlIG1hdGNoaW5nIHJlc3VsdFxuICogcmVwcmVzZW50ZWQgYXMgUE5HIGltYWdlIGJ1ZmZlci4gVGhpcyB2aXN1YWxpemF0aW9uIGxvb2tzIGxpa2VcbiAqIGh0dHBzOi8vdXNlci1pbWFnZXMuZ2l0aHVidXNlcmNvbnRlbnQuY29tLzMxMTI1NTIxLzI5NzAyNzMxLWM3OWUzMTQyLTg5NzItMTFlNy05NDdlLWRiMTA5ZDQxNTQ2OS5qcGdcbiAqIEBwcm9wZXJ0eSB7QXJyYXk8UG9pbnQ+fSBwb2ludHMxIFRoZSBhcnJheSBvZiBtYXRjaGluZyBwb2ludHMgb24gdGhlIGZpcnN0IGltYWdlXG4gKiBAcHJvcGVydHkge1JlY3R9IHJlY3QxIFRoZSBib3VuZGluZyByZWN0IGZvciB0aGUgYG1hdGNoZWRQb2ludHMxYCBzZXQgb3IgYSB6ZXJvIHJlY3RcbiAqIGlmIG5vdCBlbm91Z2ggbWF0Y2hpbmcgcG9pbnRzIGFyZSBmb3VuZFxuICogQHByb3BlcnR5IHtBcnJheTxQb2ludD59IHBvaW50czIgVGhlIGFycmF5IG9mIG1hdGNoaW5nIHBvaW50cyBvbiB0aGUgc2Vjb25kIGltYWdlXG4gKiBAcHJvcGVydHkge1JlY3R9IHJlY3QyIFRoZSBib3VuZGluZyByZWN0IGZvciB0aGUgYG1hdGNoZWRQb2ludHMyYCBzZXQgb3IgYSB6ZXJvIHJlY3RcbiAqIGlmIG5vdCBlbm91Z2ggbWF0Y2hpbmcgcG9pbnRzIGFyZSBmb3VuZFxuICovXG5cbi8qKlxuICogQ2FsY3VsYXRlcyB0aGUgY291bnQgb2YgY29tbW9uIGVkZ2VzIGJldHdlZW4gdHdvIGltYWdlcy5cbiAqIFRoZSBpbWFnZXMgbWlnaHQgYmUgcm90YXRlZCBvciByZXNpemVkIHJlbGF0aXZlbHkgdG8gZWFjaCBvdGhlci5cbiAqXG4gKiBAcGFyYW0ge0J1ZmZlcn0gaW1nMURhdGEgVGhlIGRhdGEgb2YgdGhlIGZpcnN0IGltYWdlIHBhY2tlZCBpbnRvIGEgTm9kZUpTIGJ1ZmZlclxuICogQHBhcmFtIHtCdWZmZXJ9IGltZzJEYXRhIFRoZSBkYXRhIG9mIHRoZSBzZWNvbmQgaW1hZ2UgcGFja2VkIGludG8gYSBOb2RlSlMgYnVmZmVyXG4gKiBAcGFyYW0gez9NYXRjaGluZ09wdGlvbnN9IG9wdGlvbnMgW3t9XSBTZXQgb2YgbWF0Y2hpbmcgb3B0aW9uc1xuICpcbiAqIEByZXR1cm5zIHtNYXRjaGluZ1Jlc3VsdH0gTWFjaGluZyByZXN1bHRcbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiBgZGV0ZWN0b3JOYW1lYCB2YWx1ZSBpcyB1bmtub3duLlxuICovXG5hc3luYyBmdW5jdGlvbiBnZXRJbWFnZXNNYXRjaGVzIChpbWcxRGF0YSwgaW1nMkRhdGEsIG9wdGlvbnMgPSB7fSkge1xuICBhd2FpdCBpbml0T3BlbkNWKCk7XG5cbiAgY29uc3Qge2RldGVjdG9yTmFtZSA9ICdPUkInLCB2aXN1YWxpemUgPSBmYWxzZSxcbiAgICAgICAgIGdvb2RNYXRjaGVzRmFjdG9yLCBtYXRjaEZ1bmMgPSAnQnJ1dGVGb3JjZSd9ID0gb3B0aW9ucztcbiAgaWYgKCFfLmluY2x1ZGVzKEFWQUlMQUJMRV9ERVRFQ1RPUlMsIGRldGVjdG9yTmFtZSkpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYCcke2RldGVjdG9yTmFtZX0nIGRldGVjdG9yIGlzIHVua25vd24uIGAgK1xuICAgICAgICAgICAgICAgICAgICBgT25seSAke0pTT04uc3RyaW5naWZ5KEFWQUlMQUJMRV9ERVRFQ1RPUlMpfSBkZXRlY3RvcnMgYXJlIHN1cHBvcnRlZC5gKTtcbiAgfVxuICBpZiAoIV8uaW5jbHVkZXMoQVZBSUxBQkxFX01BVENISU5HX0ZVTkNUSU9OUywgbWF0Y2hGdW5jKSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgJyR7bWF0Y2hGdW5jfScgbWF0Y2hpbmcgZnVuY3Rpb24gaXMgdW5rbm93bi4gYCArXG4gICAgICAgICAgICAgICAgICAgIGBPbmx5ICR7SlNPTi5zdHJpbmdpZnkoQVZBSUxBQkxFX01BVENISU5HX0ZVTkNUSU9OUyl9IG1hdGNoaW5nIGZ1bmN0aW9ucyBhcmUgc3VwcG9ydGVkLmApO1xuICB9XG5cbiAgY29uc3QgZGV0ZWN0b3IgPSBuZXcgY3ZbYCR7ZGV0ZWN0b3JOYW1lfURldGVjdG9yYF0oKTtcbiAgY29uc3QgW2ltZzEsIGltZzJdID0gYXdhaXQgQi5hbGwoW1xuICAgIGN2LmltZGVjb2RlQXN5bmMoaW1nMURhdGEpLFxuICAgIGN2LmltZGVjb2RlQXN5bmMoaW1nMkRhdGEpXG4gIF0pO1xuICBjb25zdCBbcmVzdWx0MSwgcmVzdWx0Ml0gPSBhd2FpdCBCLmFsbChbXG4gICAgZGV0ZWN0QW5kQ29tcHV0ZShpbWcxLCBkZXRlY3RvciksXG4gICAgZGV0ZWN0QW5kQ29tcHV0ZShpbWcyLCBkZXRlY3RvcilcbiAgXSk7XG4gIGxldCBtYXRjaGVzID0gW107XG4gIHRyeSB7XG4gICAgbWF0Y2hlcyA9IGF3YWl0IGN2W2BtYXRjaCR7bWF0Y2hGdW5jfUFzeW5jYF0ocmVzdWx0MS5kZXNjcmlwdG9yLCByZXN1bHQyLmRlc2NyaXB0b3IpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBDYW5ub3QgZmluZCBhbnkgbWF0Y2hlcyBiZXR3ZWVuIHRoZSBnaXZlbiBpbWFnZXMuIFRyeSBhbm90aGVyIGRldGVjdGlvbiBhbGdvcml0aG0uIGAgK1xuICAgICAgICAgICAgICAgICAgICBgIE9yaWdpbmFsIGVycm9yOiAke2V9YCk7XG4gIH1cbiAgY29uc3QgdG90YWxDb3VudCA9IG1hdGNoZXMubGVuZ3RoO1xuICBpZiAoaGFzVmFsdWUoZ29vZE1hdGNoZXNGYWN0b3IpKSB7XG4gICAgaWYgKF8uaXNGdW5jdGlvbihnb29kTWF0Y2hlc0ZhY3RvcikpIHtcbiAgICAgIGNvbnN0IGRpc3RhbmNlcyA9IG1hdGNoZXMubWFwKChtYXRjaCkgPT4gbWF0Y2guZGlzdGFuY2UpO1xuICAgICAgY29uc3QgbWluRGlzdGFuY2UgPSBfLm1pbihkaXN0YW5jZXMpO1xuICAgICAgY29uc3QgbWF4RGlzdGFuY2UgPSBfLm1heChkaXN0YW5jZXMpO1xuICAgICAgbWF0Y2hlcyA9IG1hdGNoZXNcbiAgICAgICAgLmZpbHRlcigobWF0Y2gpID0+IGdvb2RNYXRjaGVzRmFjdG9yKG1hdGNoLmRpc3RhbmNlLCBtaW5EaXN0YW5jZSwgbWF4RGlzdGFuY2UpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKG1hdGNoZXMubGVuZ3RoID4gZ29vZE1hdGNoZXNGYWN0b3IpIHtcbiAgICAgICAgbWF0Y2hlcyA9IG1hdGNoZXNcbiAgICAgICAgICAuc29ydCgobWF0Y2gxLCBtYXRjaDIpID0+IG1hdGNoMS5kaXN0YW5jZSAtIG1hdGNoMi5kaXN0YW5jZSlcbiAgICAgICAgICAuc2xpY2UoMCwgZ29vZE1hdGNoZXNGYWN0b3IpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGNvbnN0IGV4dHJhY3RQb2ludCA9IChrZXlQb2ludHMsIGluZGV4UHJvcGVydHlOYW1lKSA9PiAobWF0Y2gpID0+IHtcbiAgICBjb25zdCB7cHQsIHBvaW50fSA9IGtleVBvaW50c1ttYXRjaFtpbmRleFByb3BlcnR5TmFtZV1dO1xuICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9qdXN0YWR1ZGV3aG9oYWNrcy9vcGVuY3Y0bm9kZWpzL2lzc3Vlcy81ODRcbiAgICByZXR1cm4gKHB0IHx8IHBvaW50KTtcbiAgfTtcbiAgY29uc3QgcG9pbnRzMSA9IG1hdGNoZXMubWFwKGV4dHJhY3RQb2ludChyZXN1bHQxLmtleVBvaW50cywgJ3F1ZXJ5SWR4JykpO1xuICBjb25zdCByZWN0MSA9IGNhbGN1bGF0ZU1hdGNoZWRSZWN0KHBvaW50czEpO1xuICBjb25zdCBwb2ludHMyID0gbWF0Y2hlcy5tYXAoZXh0cmFjdFBvaW50KHJlc3VsdDIua2V5UG9pbnRzLCAndHJhaW5JZHgnKSk7XG4gIGNvbnN0IHJlY3QyID0gY2FsY3VsYXRlTWF0Y2hlZFJlY3QocG9pbnRzMik7XG5cbiAgY29uc3QgcmVzdWx0ID0ge1xuICAgIHBvaW50czEsXG4gICAgcmVjdDEsXG4gICAgcG9pbnRzMixcbiAgICByZWN0MixcbiAgICB0b3RhbENvdW50LFxuICAgIGNvdW50OiBtYXRjaGVzLmxlbmd0aCxcbiAgfTtcbiAgaWYgKHZpc3VhbGl6ZSkge1xuICAgIGNvbnN0IHZpc3VhbGl6YXRpb24gPSBjdi5kcmF3TWF0Y2hlcyhpbWcxLCBpbWcyLCByZXN1bHQxLmtleVBvaW50cywgcmVzdWx0Mi5rZXlQb2ludHMsIG1hdGNoZXMpO1xuICAgIGhpZ2hsaWdodFJlZ2lvbih2aXN1YWxpemF0aW9uLCByZWN0MSk7XG4gICAgaGlnaGxpZ2h0UmVnaW9uKHZpc3VhbGl6YXRpb24sIHtcbiAgICAgIHg6IGltZzEuY29scyArIHJlY3QyLngsXG4gICAgICB5OiByZWN0Mi55LFxuICAgICAgd2lkdGg6IHJlY3QyLndpZHRoLFxuICAgICAgaGVpZ2h0OiByZWN0Mi5oZWlnaHRcbiAgICB9KTtcbiAgICByZXN1bHQudmlzdWFsaXphdGlvbiA9IGF3YWl0IGN2LmltZW5jb2RlQXN5bmMoJy5wbmcnLCB2aXN1YWxpemF0aW9uKTtcbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufVxuXG4vKipcbiAqIEB0eXBlZGVmIHtPYmplY3R9IFNpbWlsYXJpdHlPcHRpb25zXG4gKiBAcHJvcGVydHkgez9ib29sZWFufSB2aXN1YWxpemUgW2ZhbHNlXSBXaGV0aGVyIHRvIHJldHVybiB0aGUgcmVzdWx0aW5nIHZpc2FsaXphdGlvblxuICogYXMgYW4gaW1hZ2UgKHVzZWZ1bCBmb3IgZGVidWdnaW5nIHB1cnBvc2VzKVxuICovXG5cbi8qKlxuICogQHR5cGVkZWYge09iamVjdH0gU2ltaWxhcml0eVJlc3VsdFxuICogQHByb3BlcnR5IHtudW1iZXJ9IHNjb3JlIFRoZSBzaW1pbGFyaXR5IHNjb3JlIGFzIGEgZmxvYXQgbnVtYmVyIGluIHJhbmdlIFswLjAsIDEuMF0uXG4gKiAxLjAgaXMgdGhlIGhpZ2hlc3Qgc2NvcmUgKG1lYW5zIGJvdGggaW1hZ2VzIGFyZSB0b3RhbGx5IGVxdWFsKS5cbiAqIEBwcm9wZXJ0eSB7P0J1ZmZlcn0gdmlzdWFsaXphdGlvbiBUaGUgdmlzdWFsaXphdGlvbiBvZiB0aGUgbWF0Y2hpbmcgcmVzdWx0XG4gKiByZXByZXNlbnRlZCBhcyBQTkcgaW1hZ2UgYnVmZmVyLiBUaGlzIGltYWdlIGluY2x1ZGVzIGJvdGggaW5wdXQgcGljdHVyZXMgd2hlcmVcbiAqIGRpZmZlcmVuY2UgcmVnaW9ucyBhcmUgaGlnaGxpZ2h0ZWQgd2l0aCByZWN0YW5nbGVzLlxuICovXG5cbi8qKlxuICogQ2FsY3VsYXRlcyB0aGUgc2ltaWxhcml0eSBzY29yZSBiZXR3ZWVuIHR3byBpbWFnZXMuXG4gKiBJdCBpcyBleHBlY3RlZCwgdGhhdCBib3RoIGltYWdlcyBoYXZlIHRoZSBzYW1lIHJlc29sdXRpb24uXG4gKlxuICogQHBhcmFtIHtCdWZmZXJ9IGltZzFEYXRhIFRoZSBkYXRhIG9mIHRoZSBmaXJzdCBpbWFnZSBwYWNrZWQgaW50byBhIE5vZGVKUyBidWZmZXJcbiAqIEBwYXJhbSB7QnVmZmVyfSBpbWcyRGF0YSBUaGUgZGF0YSBvZiB0aGUgc2Vjb25kIGltYWdlIHBhY2tlZCBpbnRvIGEgTm9kZUpTIGJ1ZmZlclxuICogQHBhcmFtIHs/U2ltaWxhcml0eU9wdGlvbnN9IG9wdGlvbnMgW3t9XSBTZXQgb2Ygc2ltaWxhcml0eSBjYWxjdWxhdGlvbiBvcHRpb25zXG4gKlxuICogQHJldHVybnMge1NpbWlsYXJpdHlSZXN1bHR9IFRoZSBjYWxjdWxhdGlvbiByZXN1bHRcbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGUgZ2l2ZW4gaW1hZ2VzIGhhdmUgZGlmZmVyZW50IHJlc29sdXRpb24uXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGdldEltYWdlc1NpbWlsYXJpdHkgKGltZzFEYXRhLCBpbWcyRGF0YSwgb3B0aW9ucyA9IHt9KSB7XG4gIGF3YWl0IGluaXRPcGVuQ1YoKTtcblxuICBjb25zdCB7dmlzdWFsaXplID0gZmFsc2V9ID0gb3B0aW9ucztcbiAgbGV0IFt0ZW1wbGF0ZSwgcmVmZXJlbmNlXSA9IGF3YWl0IEIuYWxsKFtcbiAgICBjdi5pbWRlY29kZUFzeW5jKGltZzFEYXRhKSxcbiAgICBjdi5pbWRlY29kZUFzeW5jKGltZzJEYXRhKVxuICBdKTtcbiAgaWYgKHRlbXBsYXRlLnJvd3MgIT09IHJlZmVyZW5jZS5yb3dzIHx8IHRlbXBsYXRlLmNvbHMgIT09IHJlZmVyZW5jZS5jb2xzKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdCb3RoIGltYWdlcyBhcmUgZXhwZWN0ZWQgdG8gaGF2ZSB0aGUgc2FtZSBzaXplIGluIG9yZGVyIHRvICcgK1xuICAgICAgICAgICAgICAgICAgICAnY2FsY3VsYXRlIHRoZSBzaW1pbGFyaXR5IHNjb3JlLicpO1xuICB9XG4gIFt0ZW1wbGF0ZSwgcmVmZXJlbmNlXSA9IGF3YWl0IEIuYWxsKFtcbiAgICB0ZW1wbGF0ZS5jb252ZXJ0VG9Bc3luYyhjdi5DVl84VUMzKSxcbiAgICByZWZlcmVuY2UuY29udmVydFRvQXN5bmMoY3YuQ1ZfOFVDMylcbiAgXSk7XG5cbiAgbGV0IG1hdGNoZWQ7XG4gIHRyeSB7XG4gICAgbWF0Y2hlZCA9IGF3YWl0IHJlZmVyZW5jZS5tYXRjaFRlbXBsYXRlQXN5bmModGVtcGxhdGUsIGN2LlRNX0NDT0VGRl9OT1JNRUQpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBUaGUgcmVmZXJlbmNlIGltYWdlIGRpZCBub3QgbWF0Y2ggdG8gdGhlIHRlbXBsYXRlIG9uZS4gT3JpZ2luYWwgZXJyb3I6ICR7ZS5tZXNzYWdlfWApO1xuICB9XG4gIGNvbnN0IG1pbk1heCA9IGF3YWl0IG1hdGNoZWQubWluTWF4TG9jQXN5bmMoKTtcbiAgY29uc3QgcmVzdWx0ID0ge1xuICAgIHNjb3JlOiBtaW5NYXgubWF4VmFsXG4gIH07XG4gIGlmICh2aXN1YWxpemUpIHtcbiAgICBjb25zdCByZXN1bHRNYXQgPSBuZXcgY3YuTWF0KHRlbXBsYXRlLnJvd3MsIHRlbXBsYXRlLmNvbHMgKiAyLCBjdi5DVl84VUMzKTtcbiAgICBhd2FpdCBCLmFsbChbXG4gICAgICByZWZlcmVuY2UuY29weVRvQXN5bmMoXG4gICAgICAgIHJlc3VsdE1hdC5nZXRSZWdpb24obmV3IGN2LlJlY3QoMCwgMCwgcmVmZXJlbmNlLmNvbHMsIHJlZmVyZW5jZS5yb3dzKSkpLFxuICAgICAgdGVtcGxhdGUuY29weVRvQXN5bmMoXG4gICAgICAgIHJlc3VsdE1hdC5nZXRSZWdpb24obmV3IGN2LlJlY3QocmVmZXJlbmNlLmNvbHMsIDAsIHRlbXBsYXRlLmNvbHMsIHRlbXBsYXRlLnJvd3MpKSlcbiAgICBdKTtcbiAgICBsZXQgbWFzayA9IHJlZmVyZW5jZS5hYnNkaWZmKHRlbXBsYXRlKTtcbiAgICBtYXNrID0gYXdhaXQgbWFzay5jdnRDb2xvckFzeW5jKGN2LkNPTE9SX0JHUjJHUkFZKTtcbiAgICBsZXQgY29udG91cnMgPSBbXTtcbiAgICB0cnkge1xuICAgICAgbWFzayA9IGF3YWl0IG1hc2sudGhyZXNob2xkQXN5bmMoMTI4LCAyNTUsIGN2LlRIUkVTSF9CSU5BUlkgfCBjdi5USFJFU0hfT1RTVSk7XG4gICAgICBjb250b3VycyA9IGF3YWl0IG1hc2suZmluZENvbnRvdXJzQXN5bmMoY3YuUkVUUl9FWFRFUk5BTCwgY3YuQ0hBSU5fQVBQUk9YX1NJTVBMRSk7XG4gICAgfSBjYXRjaCAoaWduKSB7XG4gICAgICAvLyBObyBjb250b3VycyBjYW4gYmUgZm91bmQsIHdoaWNoIG1lYW5zLCBtb3N0IGxpa2VseSwgdGhhdCBpbWFnZXMgYXJlIGVxdWFsXG4gICAgfVxuICAgIGZvciAoY29uc3QgY29udG91ciBvZiBjb250b3Vycykge1xuICAgICAgY29uc3QgYm91bmRpbmdSZWN0ID0gY29udG91ci5ib3VuZGluZ1JlY3QoKTtcbiAgICAgIGhpZ2hsaWdodFJlZ2lvbihyZXN1bHRNYXQsIGJvdW5kaW5nUmVjdCk7XG4gICAgICBoaWdobGlnaHRSZWdpb24ocmVzdWx0TWF0LCB7XG4gICAgICAgIHg6IHJlZmVyZW5jZS5jb2xzICsgYm91bmRpbmdSZWN0LngsXG4gICAgICAgIHk6IGJvdW5kaW5nUmVjdC55LFxuICAgICAgICB3aWR0aDogYm91bmRpbmdSZWN0LndpZHRoLFxuICAgICAgICBoZWlnaHQ6IGJvdW5kaW5nUmVjdC5oZWlnaHRcbiAgICAgIH0pO1xuICAgIH1cbiAgICByZXN1bHQudmlzdWFsaXphdGlvbiA9IGF3YWl0IGN2LmltZW5jb2RlQXN5bmMoJy5wbmcnLCByZXN1bHRNYXQpO1xuICB9XG4gIHJldHVybiByZXN1bHQ7XG59XG5cbi8qKlxuICogQHR5cGVkZWYge09iamVjdH0gT2NjdXJyZW5jZU9wdGlvbnNcbiAqIEBwcm9wZXJ0eSB7P2Jvb2xlYW59IHZpc3VhbGl6ZSBbZmFsc2VdIFdoZXRoZXIgdG8gcmV0dXJuIHRoZSByZXN1bHRpbmcgdmlzYWxpemF0aW9uXG4gKiBhcyBhbiBpbWFnZSAodXNlZnVsIGZvciBkZWJ1Z2dpbmcgcHVycG9zZXMpXG4gKiBAcHJvcGVydHkgez9mbG9hdH0gdGhyZXNob2xkIFswLjVdIEF0IHdoYXQgbm9ybWFsaXplZCB0aHJlc2hvbGQgdG8gcmVqZWN0XG4gKiBhIG1hdGNoXG4gKiBAcHJvcGVydHkgez9mbG9hdH0gbXVsdGlwbGUgW2ZhbHNlXSBmaW5kIG11bHRpcGxlIG1hdGNoZXMgaW4gdGhlIGltYWdlXG4gKiBAcHJvcGVydHkgez9udW1iZXJ9IG1hdGNoTmVpZ2hib3VyVGhyZXNob2xkIFsxMF0gVGhlIHBpeGVsIGRpc3RhbmNlIGJldHdlZW4gbWF0Y2hlcyB3ZSBjb25zaWRlclxuICogdG8gYmUgcGFydCBvZiB0aGUgc2FtZSB0ZW1wbGF0ZSBtYXRjaFxuICovXG5cbi8qKlxuICogQHR5cGVkZWYge09iamVjdH0gT2NjdXJyZW5jZVJlc3VsdFxuICogQHByb3BlcnR5IHtSZWN0fSByZWN0IFRoZSByZWdpb24gb2YgdGhlIHBhcnRpYWwgaW1hZ2Ugb2NjdXJlbmNlXG4gKiBvbiB0aGUgZnVsbCBpbWFnZVxuICogQHByb3BlcnR5IHs/QnVmZmVyfSB2aXN1YWxpemF0aW9uIFRoZSB2aXN1YWxpemF0aW9uIG9mIHRoZSBtYXRjaGluZyByZXN1bHRcbiAqIHJlcHJlc2VudGVkIGFzIFBORyBpbWFnZSBidWZmZXIuIE9uIHRoaXMgaW1hZ2UgdGhlIG1hdGNoaW5nXG4gKiByZWdpb24gaXMgaGlnaGxpZ2h0ZWQgd2l0aCBhIHJlY3RhbmdsZS4gSWYgdGhlIG11bHRpcGxlIG9wdGlvbiBpcyBwYXNzZWQsXG4gKiBhbGwgcmVzdWx0cyBhcmUgaGlnaGxpZ2h0ZWQgaGVyZS5cbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBzY29yZSBUaGUgc2ltaWxhcml0eSBzY29yZSBhcyBhIGZsb2F0IG51bWJlciBpbiByYW5nZSBbMC4wLCAxLjBdLlxuICogMS4wIGlzIHRoZSBoaWdoZXN0IHNjb3JlIChtZWFucyBib3RoIGltYWdlcyBhcmUgdG90YWxseSBlcXVhbCkuXG4gKiBAcHJvcGVydHkge0FycmF5PE9jY3VycmVuY2VSZXN1bHQ+fSBtdWx0aXBsZSBUaGUgYXJyYXkgb2YgbWF0Y2hpbmcgT2NjdXJlbmNlUmVzdWx0c1xuICogLSBvbmx5IHdoZW4gbXVsdGlwbGUgb3B0aW9uIGlzIHBhc3NlZFxuICovXG5cbi8qKlxuICogQ2FsY3VsYXRlcyB0aGUgb2NjdXJlbmNlIHBvc2l0aW9uIG9mIGEgcGFydGlhbCBpbWFnZSBpbiB0aGUgZnVsbFxuICogaW1hZ2UuXG4gKlxuICogQHBhcmFtIHtCdWZmZXJ9IGZ1bGxJbWdEYXRhIFRoZSBkYXRhIG9mIHRoZSBmdWxsIGltYWdlIHBhY2tlZCBpbnRvIGEgTm9kZUpTIGJ1ZmZlclxuICogQHBhcmFtIHtCdWZmZXJ9IHBhcnRpYWxJbWdEYXRhIFRoZSBkYXRhIG9mIHRoZSBwYXJ0aWFsIGltYWdlIHBhY2tlZCBpbnRvIGEgTm9kZUpTIGJ1ZmZlclxuICogQHBhcmFtIHs/T2NjdXJyZW5jZU9wdGlvbnN9IG9wdGlvbnMgW3t9XSBTZXQgb2Ygb2NjdXJyZW5jZSBjYWxjdWxhdGlvbiBvcHRpb25zXG4gKlxuICogQHJldHVybnMge09jY3VycmVuY2VSZXN1bHR9XG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgbm8gb2NjdXJlbmNlcyBvZiB0aGUgcGFydGlhbCBpbWFnZSBjYW4gYmUgZm91bmQgaW4gdGhlIGZ1bGwgaW1hZ2VcbiAqL1xuYXN5bmMgZnVuY3Rpb24gZ2V0SW1hZ2VPY2N1cnJlbmNlIChmdWxsSW1nRGF0YSwgcGFydGlhbEltZ0RhdGEsIG9wdGlvbnMgPSB7fSkge1xuICBhd2FpdCBpbml0T3BlbkNWKCk7XG5cbiAgY29uc3QgeyB2aXN1YWxpemUgPSBmYWxzZSxcbiAgICAgICAgICB0aHJlc2hvbGQgPSBERUZBVUxUX01BVENIX1RIUkVTSE9MRCxcbiAgICAgICAgICBtdWx0aXBsZSA9IGZhbHNlLFxuICAgICAgICAgIG1hdGNoTmVpZ2hib3VyVGhyZXNob2xkID0gTUFUQ0hfTkVJR0hCT1VSX1RIUkVTSE9MRCB9ID0gb3B0aW9ucztcblxuICBjb25zdCBbZnVsbEltZywgcGFydGlhbEltZ10gPSBhd2FpdCBCLmFsbChbXG4gICAgY3YuaW1kZWNvZGVBc3luYyhmdWxsSW1nRGF0YSksXG4gICAgY3YuaW1kZWNvZGVBc3luYyhwYXJ0aWFsSW1nRGF0YSlcbiAgXSk7XG4gIGNvbnN0IHJlc3VsdHMgPSBbXTtcbiAgbGV0IHZpc3VhbGl6YXRpb24gPSBudWxsO1xuXG4gIHRyeSB7XG4gICAgY29uc3QgbWF0Y2hlZCA9IGF3YWl0IGZ1bGxJbWcubWF0Y2hUZW1wbGF0ZUFzeW5jKHBhcnRpYWxJbWcsIGN2LlRNX0NDT0VGRl9OT1JNRUQpO1xuICAgIGNvbnN0IG1pbk1heCA9IGF3YWl0IG1hdGNoZWQubWluTWF4TG9jQXN5bmMoKTtcblxuICAgIGlmIChtdWx0aXBsZSkge1xuICAgICAgY29uc3Qgbm9uWmVyb01hdGNoUmVzdWx0cyA9IG1hdGNoZWQudGhyZXNob2xkKHRocmVzaG9sZCwgMSwgY3YuVEhSRVNIX0JJTkFSWSkuY29udmVydFRvKGN2LkNWXzhVKS5maW5kTm9uWmVybygpO1xuICAgICAgY29uc3QgbWF0Y2hlcyA9IGZpbHRlck5lYXJNYXRjaGVzKG5vblplcm9NYXRjaFJlc3VsdHMsIG1hdGNoTmVpZ2hib3VyVGhyZXNob2xkKTtcblxuICAgICAgZm9yIChjb25zdCBlbGVtZW50IG9mIG1hdGNoZXMpIHtcbiAgICAgICAgcmVzdWx0cy5wdXNoKHtcbiAgICAgICAgICBzY29yZTogbWF0Y2hlZC5hdChlbGVtZW50LnksIGVsZW1lbnQueCksXG4gICAgICAgICAgcmVjdDoge1xuICAgICAgICAgICAgeDogZWxlbWVudC54LFxuICAgICAgICAgICAgeTogZWxlbWVudC55LFxuICAgICAgICAgICAgd2lkdGg6IHBhcnRpYWxJbWcuY29scyxcbiAgICAgICAgICAgIGhlaWdodDogcGFydGlhbEltZy5yb3dzXG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKG1pbk1heC5tYXhWYWwgPj0gdGhyZXNob2xkKSB7XG4gICAgICByZXN1bHRzLnB1c2goe1xuICAgICAgICBzY29yZTogbWluTWF4Lm1heFZhbCxcbiAgICAgICAgcmVjdDoge1xuICAgICAgICAgIHg6IG1pbk1heC5tYXhMb2MueCxcbiAgICAgICAgICB5OiBtaW5NYXgubWF4TG9jLnksXG4gICAgICAgICAgd2lkdGg6IHBhcnRpYWxJbWcuY29scyxcbiAgICAgICAgICBoZWlnaHQ6IHBhcnRpYWxJbWcucm93c1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBpZiAoXy5pc0VtcHR5KHJlc3VsdHMpKSB7XG4gICAgICAvLyBCZWxvdyBlcnJvciBtZXNzYWdlLCBgQ2Fubm90IGZpbmQgYW55IG9jY3VycmVuY2VzYCBpcyByZWZlcmVuY2VkIGluIGZpbmQgYnkgaW1hZ2VcbiAgICAgIHRocm93IG5ldyBFcnJvcihgTWF0Y2ggdGhyZXNob2xkOiAke3RocmVzaG9sZH0uIEhpZ2hlc3QgbWF0Y2ggdmFsdWUgYCArXG4gICAgICAgICAgICAgICAgICAgICAgYGZvdW5kIHdhcyAke21pbk1heC5tYXhWYWx9YCk7XG4gICAgfVxuICB9IGNhdGNoIChlKSB7XG4gICAgLy8gQmVsb3cgZXJyb3IgbWVzc2FnZSwgYENhbm5vdCBmaW5kIGFueSBvY2N1cnJlbmNlc2AgaXMgcmVmZXJlbmNlZCBpbiBmaW5kIGJ5IGltYWdlXG4gICAgdGhyb3cgbmV3IEVycm9yKGBDYW5ub3QgZmluZCBhbnkgb2NjdXJyZW5jZXMgb2YgdGhlIHBhcnRpYWwgaW1hZ2UgaW4gdGhlIGZ1bGwgaW1hZ2UuIGAgK1xuICAgICAgYE9yaWdpbmFsIGVycm9yOiAke2UubWVzc2FnZX1gKTtcbiAgfVxuXG4gIGlmICh2aXN1YWxpemUpIHtcbiAgICBjb25zdCBmdWxsSGlnaGxpZ2h0ZWRJbWFnZSA9IGZ1bGxJbWcuY29weSgpO1xuXG4gICAgZm9yIChjb25zdCByZXN1bHQgb2YgcmVzdWx0cykge1xuICAgICAgY29uc3Qgc2luZ2xlSGlnaGxpZ2h0ZWRJbWFnZSA9IGZ1bGxJbWcuY29weSgpO1xuXG4gICAgICBoaWdobGlnaHRSZWdpb24oc2luZ2xlSGlnaGxpZ2h0ZWRJbWFnZSwgcmVzdWx0LnJlY3QpO1xuICAgICAgaGlnaGxpZ2h0UmVnaW9uKGZ1bGxIaWdobGlnaHRlZEltYWdlLCByZXN1bHQucmVjdCk7XG4gICAgICByZXN1bHQudmlzdWFsaXphdGlvbiA9IGF3YWl0IGN2LmltZW5jb2RlQXN5bmMoJy5wbmcnLCBzaW5nbGVIaWdobGlnaHRlZEltYWdlKTtcbiAgICB9XG4gICAgdmlzdWFsaXphdGlvbiA9IGF3YWl0IGN2LmltZW5jb2RlQXN5bmMoJy5wbmcnLCBmdWxsSGlnaGxpZ2h0ZWRJbWFnZSk7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIHJlY3Q6IHJlc3VsdHNbMF0ucmVjdCxcbiAgICBzY29yZTogcmVzdWx0c1swXS5zY29yZSxcbiAgICB2aXN1YWxpemF0aW9uLFxuICAgIG11bHRpcGxlOiByZXN1bHRzXG4gIH07XG59XG5cbi8qKlxuICogRmlsdGVyIG91dCBtYXRjaCByZXN1bHRzIHdoaWNoIGhhdmUgYSBtYXRjaGVkIG5laWdoYm91clxuICpcbiAqIEBwYXJhbSB7QXJyYXk8UG9pbnQ+fSBub25aZXJvTWF0Y2hSZXN1bHRzIG1hdHJpeCBvZiBpbWFnZSBtYXRjaCByZXN1bHRzXG4gKiBAcGFyYW0ge251bWJlcn0gbWF0Y2hOZWlnaGJvdXJUaHJlc2hvbGQgVGhlIHBpeGVsIGRpc3RhbmNlIHdpdGhpbiB3aGljaCB3ZVxuICogY29uc2lkZXIgYW4gZWxlbWVudCBiZWluZyBhIG5laWdoYm91ciBvZiBhbiBleGlzdGluZyBtYXRjaFxuICogQHJldHVybiB7QXJyYXk8UG9pbnQ+fSB0aGUgZmlsdGVyZWQgYXJyYXkgb2YgbWF0Y2hlZCBwb2ludHNcbiAqL1xuZnVuY3Rpb24gZmlsdGVyTmVhck1hdGNoZXMgKG5vblplcm9NYXRjaFJlc3VsdHMsIG1hdGNoTmVpZ2hib3VyVGhyZXNob2xkKSB7XG4gIHJldHVybiBub25aZXJvTWF0Y2hSZXN1bHRzLnJlZHVjZSgoYWNjLCBlbGVtZW50KSA9PiB7XG4gICAgaWYgKCFhY2Muc29tZSgobWF0Y2gpID0+IGRpc3RhbmNlKG1hdGNoLCBlbGVtZW50KSA8PSBtYXRjaE5laWdoYm91clRocmVzaG9sZCkpIHtcbiAgICAgIGFjYy5wdXNoKGVsZW1lbnQpO1xuICAgIH1cbiAgICByZXR1cm4gYWNjO1xuICB9LCBbXSk7XG59XG5cbi8qKlxuICogRmluZCB0aGUgZGlzdGFuY2UgYmV0d2VlbiB0d28gcG9pbnRzXG4gKlxuICogQHBhcmFtIHtQb2ludH0gcG9pbnQxIFRoZSBmaXJzdCBwb2ludFxuICogQHBhcmFtIHtQb2ludH0gcG9pbnQyIFRoZSBzZWNvbmQgcG9pbnRcbiAqIEByZXR1cm4ge251bWJlcn0gdGhlIGRpc3RhbmNlXG4gKi9cbmZ1bmN0aW9uIGRpc3RhbmNlIChwb2ludDEsIHBvaW50Mikge1xuICBjb25zdCBhMiA9IE1hdGgucG93KChwb2ludDEueCAtIHBvaW50Mi54KSwgMik7XG4gIGNvbnN0IGIyID0gTWF0aC5wb3coKHBvaW50MS55IC0gcG9pbnQyLnkpLCAyKTtcbiAgcmV0dXJuIE1hdGguc3FydChhMiArIGIyKTtcbn1cblxuLyoqXG4gKiBDcm9wIHRoZSBpbWFnZSBieSBnaXZlbiByZWN0YW5nbGUgKHVzZSBiYXNlNjQgc3RyaW5nIGFzIGlucHV0IGFuZCBvdXRwdXQpXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGJhc2U2NEltYWdlIFRoZSBzdHJpbmcgd2l0aCBiYXNlNjQgZW5jb2RlZCBpbWFnZVxuICogQHBhcmFtIHtSZWdpb259IHJlY3QgVGhlIHNlbGVjdGVkIHJlZ2lvbiBvZiBpbWFnZVxuICogQHJldHVybiB7c3RyaW5nfSBiYXNlNjQgZW5jb2RlZCBzdHJpbmcgb2YgY3JvcHBlZCBpbWFnZVxuICovXG5hc3luYyBmdW5jdGlvbiBjcm9wQmFzZTY0SW1hZ2UgKGJhc2U2NEltYWdlLCByZWN0KSB7XG4gIGNvbnN0IGltYWdlID0gYXdhaXQgYmFzZTY0VG9JbWFnZShiYXNlNjRJbWFnZSk7XG4gIGNyb3BJbWFnZShpbWFnZSwgcmVjdCk7XG4gIHJldHVybiBhd2FpdCBpbWFnZVRvQmFzZTY0KGltYWdlKTtcbn1cblxuLyoqXG4gKiBDcmVhdGUgYSBwbmdqcyBpbWFnZSBmcm9tIGdpdmVuIGJhc2U2NCBpbWFnZVxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBiYXNlNjRJbWFnZSBUaGUgc3RyaW5nIHdpdGggYmFzZTY0IGVuY29kZWQgaW1hZ2VcbiAqIEByZXR1cm4ge1BOR30gVGhlIGltYWdlIG9iamVjdFxuICovXG5hc3luYyBmdW5jdGlvbiBiYXNlNjRUb0ltYWdlIChiYXNlNjRJbWFnZSkge1xuICBjb25zdCBpbWFnZUJ1ZmZlciA9IEJ1ZmZlci5mcm9tKGJhc2U2NEltYWdlLCAnYmFzZTY0Jyk7XG4gIHJldHVybiBhd2FpdCBuZXcgQigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgY29uc3QgaW1hZ2UgPSBuZXcgUE5HKHtmaWx0ZXJUeXBlOiBTQ0FOTElORV9GSUxURVJfTUVUSE9EfSk7XG4gICAgaW1hZ2UucGFyc2UoaW1hZ2VCdWZmZXIsIChlcnIsIGltYWdlKSA9PiB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgcHJvbWlzZS9wcmVmZXItYXdhaXQtdG8tY2FsbGJhY2tzXG4gICAgICBpZiAoZXJyKSB7XG4gICAgICAgIHJldHVybiByZWplY3QoZXJyKTtcbiAgICAgIH1cbiAgICAgIHJlc29sdmUoaW1hZ2UpO1xuICAgIH0pO1xuICB9KTtcbn1cblxuLyoqXG4gKiBDcmVhdGUgYSBiYXNlNjQgc3RyaW5nIGZvciBnaXZlbiBpbWFnZSBvYmplY3RcbiAqXG4gKiBAcGFyYW0ge1BOR30gaW1hZ2UgVGhlIGltYWdlIG9iamVjdFxuICogQHJldHVybiB7c3RyaW5nfSBUaGUgc3RyaW5nIHdpdGggYmFzZTY0IGVuY29kZWQgaW1hZ2VcbiAqL1xuYXN5bmMgZnVuY3Rpb24gaW1hZ2VUb0Jhc2U2NCAoaW1hZ2UpIHtcbiAgcmV0dXJuIGF3YWl0IG5ldyBCKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICBjb25zdCBjaHVua3MgPSBbXTtcbiAgICBpbWFnZS5wYWNrKClcbiAgICAub24oJ2RhdGEnLCAoY2h1bmspID0+IGNodW5rcy5wdXNoKGNodW5rKSkub24oJ2VuZCcsICgpID0+IHtcbiAgICAgIHJlc29sdmUoQnVmZmVyLmNvbmNhdChjaHVua3MpLnRvU3RyaW5nKCdiYXNlNjQnKSk7XG4gICAgfSlcbiAgICAub24oJ2Vycm9yJywgKGVycikgPT4geyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHByb21pc2UvcHJlZmVyLWF3YWl0LXRvLWNhbGxiYWNrc1xuICAgICAgcmVqZWN0KGVycik7XG4gICAgfSk7XG4gIH0pO1xufVxuXG4vKipcbiAqIENyb3AgdGhlIGltYWdlIGJ5IGdpdmVuIHJlY3RhbmdsZVxuICpcbiAqIEBwYXJhbSB7UE5HfSBpbWFnZSBUaGUgaW1hZ2UgdG8gbXV0YXRlIGJ5IGNyb3BwaW5nXG4gKiBAcGFyYW0ge1JlZ2lvbn0gcmVjdCBUaGUgc2VsZWN0ZWQgcmVnaW9uIG9mIGltYWdlXG4gKi9cbmZ1bmN0aW9uIGNyb3BJbWFnZSAoaW1hZ2UsIHJlY3QpIHtcbiAgY29uc3QgaW1hZ2VSZWN0ID0ge3dpZHRoOiBpbWFnZS53aWR0aCwgaGVpZ2h0OiBpbWFnZS5oZWlnaHR9O1xuICBjb25zdCBpbnRlclJlY3QgPSBnZXRSZWN0SW50ZXJzZWN0aW9uKHJlY3QsIGltYWdlUmVjdCk7XG4gIGlmIChpbnRlclJlY3Qud2lkdGggPCByZWN0LndpZHRoIHx8IGludGVyUmVjdC5oZWlnaHQgPCByZWN0LmhlaWdodCkge1xuICAgIHRocm93IG5ldyBFcnJvcihgQ2Fubm90IGNyb3AgJHtKU09OLnN0cmluZ2lmeShyZWN0KX0gZnJvbSAke0pTT04uc3RyaW5naWZ5KGltYWdlUmVjdCl9IGJlY2F1c2UgdGhlIGludGVyc2VjdGlvbiBiZXR3ZWVuIHRoZW0gd2FzIG5vdCB0aGUgc2l6ZSBvZiB0aGUgcmVjdGApO1xuICB9XG5cbiAgY29uc3QgZmlyc3RWZXJ0aWNhbFBpeGVsID0gaW50ZXJSZWN0LnRvcDtcbiAgY29uc3QgbGFzdFZlcnRpY2FsUGl4ZWwgPSBpbnRlclJlY3QudG9wICsgaW50ZXJSZWN0LmhlaWdodDtcblxuICBjb25zdCBmaXJzdEhvcml6b250YWxQaXhlbCA9IGludGVyUmVjdC5sZWZ0O1xuICBjb25zdCBsYXN0SG9yaXpvbnRhbFBpeGVsID0gaW50ZXJSZWN0LmxlZnQgKyBpbnRlclJlY3Qud2lkdGg7XG5cbiAgY29uc3QgY3JvcHBlZEFycmF5ID0gW107XG4gIGZvciAobGV0IHkgPSBmaXJzdFZlcnRpY2FsUGl4ZWw7IHkgPCBsYXN0VmVydGljYWxQaXhlbDsgeSsrKSB7XG4gICAgZm9yIChsZXQgeCA9IGZpcnN0SG9yaXpvbnRhbFBpeGVsOyB4IDwgbGFzdEhvcml6b250YWxQaXhlbDsgeCsrKSB7XG4gICAgICBjb25zdCBmaXJzdEJ5dGVJZHhJblBpeGVsQmxvY2sgPSAoaW1hZ2VSZWN0LndpZHRoICogeSArIHgpIDw8IDI7XG4gICAgICBmb3IgKGxldCBieXRlSWR4ID0gMDsgYnl0ZUlkeCA8IEJZVEVTX0lOX1BJWEVMX0JMT0NLOyBieXRlSWR4KyspIHtcbiAgICAgICAgY3JvcHBlZEFycmF5LnB1c2goaW1hZ2UuZGF0YVtmaXJzdEJ5dGVJZHhJblBpeGVsQmxvY2sgKyBieXRlSWR4XSk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgaW1hZ2UuZGF0YSA9IEJ1ZmZlci5mcm9tKGNyb3BwZWRBcnJheSk7XG4gIGltYWdlLndpZHRoID0gaW50ZXJSZWN0LndpZHRoO1xuICBpbWFnZS5oZWlnaHQgPSBpbnRlclJlY3QuaGVpZ2h0O1xuICByZXR1cm4gaW1hZ2U7XG59XG5cbmZ1bmN0aW9uIGdldFJlY3RJbnRlcnNlY3Rpb24gKHJlY3QsIGltYWdlU2l6ZSkge1xuICBjb25zdCBsZWZ0ID0gcmVjdC5sZWZ0ID49IGltYWdlU2l6ZS53aWR0aCA/IGltYWdlU2l6ZS53aWR0aCA6IHJlY3QubGVmdDtcbiAgY29uc3QgdG9wID0gcmVjdC50b3AgPj0gaW1hZ2VTaXplLmhlaWdodCA/IGltYWdlU2l6ZS5oZWlnaHQgOiByZWN0LnRvcDtcbiAgY29uc3Qgd2lkdGggPSBpbWFnZVNpemUud2lkdGggPj0gKGxlZnQgKyByZWN0LndpZHRoKSA/IHJlY3Qud2lkdGggOiAoaW1hZ2VTaXplLndpZHRoIC0gbGVmdCk7XG4gIGNvbnN0IGhlaWdodCA9IGltYWdlU2l6ZS5oZWlnaHQgPj0gKHRvcCArIHJlY3QuaGVpZ2h0KSA/IHJlY3QuaGVpZ2h0IDogKGltYWdlU2l6ZS5oZWlnaHQgLSB0b3ApO1xuICByZXR1cm4ge2xlZnQsIHRvcCwgd2lkdGgsIGhlaWdodH07XG59XG5cbmV4cG9ydCB7XG4gIGNyb3BCYXNlNjRJbWFnZSwgYmFzZTY0VG9JbWFnZSwgaW1hZ2VUb0Jhc2U2NCwgY3JvcEltYWdlLCBnZXRJbWFnZXNNYXRjaGVzLFxuICBnZXRJbWFnZXNTaW1pbGFyaXR5LCBnZXRJbWFnZU9jY3VycmVuY2UsIGdldEppbXBJbWFnZSwgTUlNRV9KUEVHLCBNSU1FX1BORyxcbiAgTUlNRV9CTVAsXG59O1xuIl0sImZpbGUiOiJsaWIvaW1hZ2UtdXRpbC5qcyIsInNvdXJjZVJvb3QiOiIuLi8uLiJ9
