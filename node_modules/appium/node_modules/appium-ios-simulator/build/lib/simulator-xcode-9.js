"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

require("source-map-support/register");

var _simulatorXcode = _interopRequireDefault(require("./simulator-xcode-8"));

var _lodash = _interopRequireDefault(require("lodash"));

var _path = _interopRequireDefault(require("path"));

var _appiumSupport = require("appium-support");

var _asyncLock = _interopRequireDefault(require("async-lock"));

var _logger = _interopRequireDefault(require("./logger"));

var _asyncbox = require("asyncbox");

var _utils = require("./utils.js");

var _defaultsUtils = require("./defaults-utils");

const SIMULATOR_SHUTDOWN_TIMEOUT = 15 * 1000;
const startupLock = new _asyncLock.default();
const preferencesPlistGuard = new _asyncLock.default();
const ENROLLMENT_NOTIFICATION_RECEIVER = 'com.apple.BiometricKit.enrollmentChanged';

class SimulatorXcode9 extends _simulatorXcode.default {
  constructor(udid, xcodeVersion) {
    super(udid, xcodeVersion);
  }

  async run(opts = {}) {
    opts = _lodash.default.cloneDeep(opts);

    _lodash.default.defaultsDeep(opts, {
      devicePreferences: {},
      isHeadless: false,
      startupTimeout: this.startupTimeout
    });

    if (opts.scaleFactor) {
      opts.devicePreferences.SimulatorWindowLastScale = parseFloat(opts.scaleFactor);
    }

    const commonPreferences = {
      RotateWindowWhenSignaledByGuest: true
    };

    if (_lodash.default.isBoolean(opts.connectHardwareKeyboard) || _lodash.default.isNil(opts.connectHardwareKeyboard)) {
      var _opts$connectHardware, _opts$connectHardware2;

      opts.devicePreferences.ConnectHardwareKeyboard = (_opts$connectHardware = opts.connectHardwareKeyboard) !== null && _opts$connectHardware !== void 0 ? _opts$connectHardware : false;
      commonPreferences.ConnectHardwareKeyboard = (_opts$connectHardware2 = opts.connectHardwareKeyboard) !== null && _opts$connectHardware2 !== void 0 ? _opts$connectHardware2 : false;
    }

    if (_lodash.default.isBoolean(opts.tracePointer)) {
      commonPreferences.ShowSingleTouches = opts.tracePointer;
      commonPreferences.ShowPinches = opts.tracePointer;
      commonPreferences.ShowPinchPivotPoint = opts.tracePointer;
      commonPreferences.HighlightEdgeGestures = opts.tracePointer;
    }

    switch (_lodash.default.lowerCase(opts.pasteboardAutomaticSync)) {
      case 'on':
        commonPreferences.PasteboardAutomaticSync = true;
        break;

      case 'off':
        commonPreferences.PasteboardAutomaticSync = false;
        break;

      case 'system':
        break;

      default:
        _logger.default.info(`['on', 'off' or 'system'] are available as the pasteboard automatic sync option. Defaulting to 'off'`);

        commonPreferences.PasteboardAutomaticSync = false;
    }

    await this.updatePreferences(opts.devicePreferences, commonPreferences);
    const timer = new _appiumSupport.timing.Timer().start();
    const shouldWaitForBoot = await startupLock.acquire(this.uiClientBundleId, async () => {
      const isServerRunning = await this.isRunning();
      const uiClientPid = await this.getUIClientPid();

      if (opts.isHeadless) {
        if (isServerRunning && !uiClientPid) {
          _logger.default.info(`Simulator with UDID '${this.udid}' is already booted in headless mode.`);

          return false;
        }

        if (await this.killUIClient({
          pid: uiClientPid
        })) {
          _logger.default.info(`Detected the Simulator UI client was running and killed it. Verifying the current Simulator state`);
        }

        try {
          await (0, _asyncbox.waitForCondition)(async () => await this.isShutdown(), {
            waitMs: 5000,
            intervalMs: 100
          });
        } catch (e) {
          if (!(await this.isRunning())) {
            throw new Error(`Simulator with UDID '${this.udid}' cannot be transitioned to headless mode`);
          }

          return false;
        }

        _logger.default.info(`Booting Simulator with UDID '${this.udid}' in headless mode. ` + `All UI-related capabilities are going to be ignored`);

        await this.boot();
      } else {
        if (isServerRunning && uiClientPid) {
          _logger.default.info(`Both Simulator with UDID '${this.udid}' and the UI client are currently running`);

          return false;
        }

        if (isServerRunning) {
          _logger.default.info(`Simulator '${this.udid}' is booted while its UI is not visible. ` + `Trying to restart it with the Simulator window visible`);

          await this.shutdown({
            timeout: SIMULATOR_SHUTDOWN_TIMEOUT
          });
        }

        await this.launchWindow(uiClientPid, opts);
      }

      return true;
    });

    if (shouldWaitForBoot) {
      await this.waitForBoot(opts.startupTimeout);

      _logger.default.info(`Simulator with UDID ${this.udid} booted in ${timer.getDuration().asSeconds.toFixed(3)}s`);
    }
  }

  async launchWindow(isUiClientRunning, opts = {}) {
    await this.boot();

    if (!isUiClientRunning) {
      await this.startUIClient(opts);
    }
  }

  async boot() {
    if (await this.isRunning()) {
      _logger.default.info(`Simulator '${this.udid}' is already running`);

      return;
    }

    _logger.default.info(`Booting Simulator '${this.udid}'`);

    try {
      await this.simctl.bootDevice();
    } catch (e) {
      _logger.default.warn(e.stderr || e.message);
    }

    await (0, _asyncbox.retryInterval)(5, 1000, async () => {
      if (!(await this.isRunning())) {
        throw new Error(`Simulator '${this.udid}' is not running after being booted. ` + `Check the Appium log for more details.`);
      }
    });
  }

  verifyDevicePreferences(prefs = {}) {
    if (_lodash.default.isEmpty(prefs)) {
      return;
    }

    if (!_lodash.default.isUndefined(prefs.SimulatorWindowLastScale)) {
      if (!_lodash.default.isNumber(prefs.SimulatorWindowLastScale) || prefs.SimulatorWindowLastScale <= 0) {
        _logger.default.errorAndThrow(`SimulatorWindowLastScale is expected to be a positive float value. ` + `'${prefs.SimulatorWindowLastScale}' is assigned instead.`);
      }
    }

    if (!_lodash.default.isUndefined(prefs.SimulatorWindowCenter)) {
      const verificationPattern = /{-?\d+(\.\d+)?,-?\d+(\.\d+)?}/;

      if (!_lodash.default.isString(prefs.SimulatorWindowCenter) || !verificationPattern.test(prefs.SimulatorWindowCenter)) {
        _logger.default.errorAndThrow(`SimulatorWindowCenter is expected to match "{floatXPosition,floatYPosition}" format (without spaces). ` + `'${prefs.SimulatorWindowCenter}' is assigned instead.`);
      }
    }

    if (!_lodash.default.isUndefined(prefs.SimulatorWindowOrientation)) {
      const acceptableValues = ['Portrait', 'LandscapeLeft', 'PortraitUpsideDown', 'LandscapeRight'];

      if (acceptableValues.indexOf(prefs.SimulatorWindowOrientation) === -1) {
        _logger.default.errorAndThrow(`SimulatorWindowOrientation is expected to be one of ${acceptableValues}. ` + `'${prefs.SimulatorWindowOrientation}' is assigned instead.`);
      }
    }

    if (!_lodash.default.isUndefined(prefs.SimulatorWindowRotationAngle)) {
      if (!_lodash.default.isNumber(prefs.SimulatorWindowRotationAngle)) {
        _logger.default.errorAndThrow(`SimulatorWindowRotationAngle is expected to be a valid number. ` + `'${prefs.SimulatorWindowRotationAngle}' is assigned instead.`);
      }
    }
  }

  async updatePreferences(devicePrefs = {}, commonPrefs = {}) {
    if (!_lodash.default.isEmpty(devicePrefs)) {
      _logger.default.debug(`Setting preferences of ${this.udid} Simulator to ${JSON.stringify(devicePrefs)}`);
    }

    if (!_lodash.default.isEmpty(commonPrefs)) {
      _logger.default.debug(`Setting common Simulator preferences to ${JSON.stringify(commonPrefs)}`);
    }

    const homeFolderPath = process.env.HOME;

    if (!homeFolderPath) {
      _logger.default.warn(`Cannot get the path to HOME folder from the process environment. ` + `Ignoring Simulator preferences update.`);

      return false;
    }

    this.verifyDevicePreferences(devicePrefs);

    const plistPath = _path.default.resolve(homeFolderPath, 'Library', 'Preferences', 'com.apple.iphonesimulator.plist');

    return await preferencesPlistGuard.acquire(SimulatorXcode9.name, async () => {
      const defaults = new _defaultsUtils.NSUserDefaults(plistPath);

      const prefsToUpdate = _lodash.default.clone(commonPrefs);

      try {
        if (!_lodash.default.isEmpty(devicePrefs)) {
          let existingDevicePrefs;
          const udidKey = this.udid.toUpperCase();

          if (await _appiumSupport.fs.exists(plistPath)) {
            const currentPlistContent = await defaults.asJson();

            if (_lodash.default.isPlainObject(currentPlistContent.DevicePreferences) && _lodash.default.isPlainObject(currentPlistContent.DevicePreferences[udidKey])) {
              existingDevicePrefs = currentPlistContent.DevicePreferences[udidKey];
            }
          }

          Object.assign(prefsToUpdate, {
            DevicePreferences: {
              [udidKey]: Object.assign({}, existingDevicePrefs || {}, devicePrefs)
            }
          });
        }

        await defaults.update(prefsToUpdate);

        _logger.default.debug(`Updated ${this.udid} Simulator preferences at '${plistPath}' with ` + JSON.stringify(prefsToUpdate));

        return true;
      } catch (e) {
        _logger.default.warn(`Cannot update ${this.udid} Simulator preferences at '${plistPath}'. ` + `Try to delete the file manually in order to reset it. Original error: ${e.message}`);

        return false;
      }
    });
  }

  async clean() {
    _logger.default.info(`Cleaning simulator ${this.udid}`);

    await this.simctl.eraseDevice(10000);
  }

  async _activateWindow() {
    let selfName;
    let selfSdk;
    let bootedDevicesCount = 0;

    for (const [sdk, deviceArr] of _lodash.default.toPairs(await this.simctl.getDevices())) {
      for (const {
        state,
        udid,
        name
      } of deviceArr) {
        if (state === 'Booted') {
          bootedDevicesCount++;
        }

        if (!selfName && udid === this.udid) {
          selfSdk = sdk;
          selfName = name;
        }
      }
    }

    if (bootedDevicesCount < 2) {
      return await super._activateWindow();
    }

    return `
      tell application "System Events"
        tell process "Simulator"
          set frontmost to false
          set frontmost to true
          click (menu item 1 where (its name contains "${selfName} " and its name contains "${selfSdk}")) of menu 1 of menu bar item "Window" of menu bar 1
        end tell
      end tell
    `;
  }

  async isBiometricEnrolled() {
    const {
      stdout
    } = await this.simctl.spawnProcess(['notifyutil', '-g', ENROLLMENT_NOTIFICATION_RECEIVER]);
    const match = new RegExp(`${_lodash.default.escapeRegExp(ENROLLMENT_NOTIFICATION_RECEIVER)}\\s+([01])`).exec(stdout);

    if (!match) {
      throw new Error(`Cannot parse biometric enrollment state from '${stdout}'`);
    }

    _logger.default.info(`Current biometric enrolled state for ${this.udid} Simulator: ${match[1]}`);

    return match[1] === '1';
  }

  async enrollBiometric(isEnabled = true) {
    _logger.default.debug(`Setting biometric enrolled state for ${this.udid} Simulator to '${isEnabled ? 'enabled' : 'disabled'}'`);

    await this.simctl.spawnProcess(['notifyutil', '-s', ENROLLMENT_NOTIFICATION_RECEIVER, isEnabled ? '1' : '0']);
    await this.simctl.spawnProcess(['notifyutil', '-p', ENROLLMENT_NOTIFICATION_RECEIVER]);

    if ((await this.isBiometricEnrolled()) !== isEnabled) {
      throw new Error(`Cannot set biometric enrolled state for ${this.udid} Simulator to '${isEnabled ? 'enabled' : 'disabled'}'`);
    }
  }

  async sendBiometricMatch(shouldMatch = true, biometricName = 'touchId') {
    const domainComponent = (0, _utils.toBiometricDomainComponent)(biometricName);
    const domain = `com.apple.BiometricKit_Sim.${domainComponent}.${shouldMatch ? '' : 'no'}match`;
    await this.simctl.spawnProcess(['notifyutil', '-p', domain]);

    _logger.default.info(`Sent notification ${domain} to ${shouldMatch ? 'match' : 'not match'} ${biometricName} biometric ` + `for ${this.udid} Simulator`);
  }

  async getLaunchDaemonsRoot() {
    const devRoot = await (0, _utils.getDeveloperRoot)();
    return _path.default.resolve(devRoot, 'Platforms/iPhoneOS.platform/Developer/Library/CoreSimulator/Profiles/Runtimes/iOS.simruntime/Contents/Resources/RuntimeRoot/System/Library/LaunchDaemons');
  }

}

var _default = SimulatorXcode9;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9zaW11bGF0b3IteGNvZGUtOS5qcyJdLCJuYW1lcyI6WyJTSU1VTEFUT1JfU0hVVERPV05fVElNRU9VVCIsInN0YXJ0dXBMb2NrIiwiQXN5bmNMb2NrIiwicHJlZmVyZW5jZXNQbGlzdEd1YXJkIiwiRU5ST0xMTUVOVF9OT1RJRklDQVRJT05fUkVDRUlWRVIiLCJTaW11bGF0b3JYY29kZTkiLCJTaW11bGF0b3JYY29kZTgiLCJjb25zdHJ1Y3RvciIsInVkaWQiLCJ4Y29kZVZlcnNpb24iLCJydW4iLCJvcHRzIiwiXyIsImNsb25lRGVlcCIsImRlZmF1bHRzRGVlcCIsImRldmljZVByZWZlcmVuY2VzIiwiaXNIZWFkbGVzcyIsInN0YXJ0dXBUaW1lb3V0Iiwic2NhbGVGYWN0b3IiLCJTaW11bGF0b3JXaW5kb3dMYXN0U2NhbGUiLCJwYXJzZUZsb2F0IiwiY29tbW9uUHJlZmVyZW5jZXMiLCJSb3RhdGVXaW5kb3dXaGVuU2lnbmFsZWRCeUd1ZXN0IiwiaXNCb29sZWFuIiwiY29ubmVjdEhhcmR3YXJlS2V5Ym9hcmQiLCJpc05pbCIsIkNvbm5lY3RIYXJkd2FyZUtleWJvYXJkIiwidHJhY2VQb2ludGVyIiwiU2hvd1NpbmdsZVRvdWNoZXMiLCJTaG93UGluY2hlcyIsIlNob3dQaW5jaFBpdm90UG9pbnQiLCJIaWdobGlnaHRFZGdlR2VzdHVyZXMiLCJsb3dlckNhc2UiLCJwYXN0ZWJvYXJkQXV0b21hdGljU3luYyIsIlBhc3RlYm9hcmRBdXRvbWF0aWNTeW5jIiwibG9nIiwiaW5mbyIsInVwZGF0ZVByZWZlcmVuY2VzIiwidGltZXIiLCJ0aW1pbmciLCJUaW1lciIsInN0YXJ0Iiwic2hvdWxkV2FpdEZvckJvb3QiLCJhY3F1aXJlIiwidWlDbGllbnRCdW5kbGVJZCIsImlzU2VydmVyUnVubmluZyIsImlzUnVubmluZyIsInVpQ2xpZW50UGlkIiwiZ2V0VUlDbGllbnRQaWQiLCJraWxsVUlDbGllbnQiLCJwaWQiLCJpc1NodXRkb3duIiwid2FpdE1zIiwiaW50ZXJ2YWxNcyIsImUiLCJFcnJvciIsImJvb3QiLCJzaHV0ZG93biIsInRpbWVvdXQiLCJsYXVuY2hXaW5kb3ciLCJ3YWl0Rm9yQm9vdCIsImdldER1cmF0aW9uIiwiYXNTZWNvbmRzIiwidG9GaXhlZCIsImlzVWlDbGllbnRSdW5uaW5nIiwic3RhcnRVSUNsaWVudCIsInNpbWN0bCIsImJvb3REZXZpY2UiLCJ3YXJuIiwic3RkZXJyIiwibWVzc2FnZSIsInZlcmlmeURldmljZVByZWZlcmVuY2VzIiwicHJlZnMiLCJpc0VtcHR5IiwiaXNVbmRlZmluZWQiLCJpc051bWJlciIsImVycm9yQW5kVGhyb3ciLCJTaW11bGF0b3JXaW5kb3dDZW50ZXIiLCJ2ZXJpZmljYXRpb25QYXR0ZXJuIiwiaXNTdHJpbmciLCJ0ZXN0IiwiU2ltdWxhdG9yV2luZG93T3JpZW50YXRpb24iLCJhY2NlcHRhYmxlVmFsdWVzIiwiaW5kZXhPZiIsIlNpbXVsYXRvcldpbmRvd1JvdGF0aW9uQW5nbGUiLCJkZXZpY2VQcmVmcyIsImNvbW1vblByZWZzIiwiZGVidWciLCJKU09OIiwic3RyaW5naWZ5IiwiaG9tZUZvbGRlclBhdGgiLCJwcm9jZXNzIiwiZW52IiwiSE9NRSIsInBsaXN0UGF0aCIsInBhdGgiLCJyZXNvbHZlIiwibmFtZSIsImRlZmF1bHRzIiwiTlNVc2VyRGVmYXVsdHMiLCJwcmVmc1RvVXBkYXRlIiwiY2xvbmUiLCJleGlzdGluZ0RldmljZVByZWZzIiwidWRpZEtleSIsInRvVXBwZXJDYXNlIiwiZnMiLCJleGlzdHMiLCJjdXJyZW50UGxpc3RDb250ZW50IiwiYXNKc29uIiwiaXNQbGFpbk9iamVjdCIsIkRldmljZVByZWZlcmVuY2VzIiwiT2JqZWN0IiwiYXNzaWduIiwidXBkYXRlIiwiY2xlYW4iLCJlcmFzZURldmljZSIsIl9hY3RpdmF0ZVdpbmRvdyIsInNlbGZOYW1lIiwic2VsZlNkayIsImJvb3RlZERldmljZXNDb3VudCIsInNkayIsImRldmljZUFyciIsInRvUGFpcnMiLCJnZXREZXZpY2VzIiwic3RhdGUiLCJpc0Jpb21ldHJpY0Vucm9sbGVkIiwic3Rkb3V0Iiwic3Bhd25Qcm9jZXNzIiwibWF0Y2giLCJSZWdFeHAiLCJlc2NhcGVSZWdFeHAiLCJleGVjIiwiZW5yb2xsQmlvbWV0cmljIiwiaXNFbmFibGVkIiwic2VuZEJpb21ldHJpY01hdGNoIiwic2hvdWxkTWF0Y2giLCJiaW9tZXRyaWNOYW1lIiwiZG9tYWluQ29tcG9uZW50IiwiZG9tYWluIiwiZ2V0TGF1bmNoRGFlbW9uc1Jvb3QiLCJkZXZSb290Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUVBLE1BQU1BLDBCQUEwQixHQUFHLEtBQUssSUFBeEM7QUFDQSxNQUFNQyxXQUFXLEdBQUcsSUFBSUMsa0JBQUosRUFBcEI7QUFDQSxNQUFNQyxxQkFBcUIsR0FBRyxJQUFJRCxrQkFBSixFQUE5QjtBQUNBLE1BQU1FLGdDQUFnQyxHQUFHLDBDQUF6Qzs7QUFFQSxNQUFNQyxlQUFOLFNBQThCQyx1QkFBOUIsQ0FBOEM7QUFDNUNDLEVBQUFBLFdBQVcsQ0FBRUMsSUFBRixFQUFRQyxZQUFSLEVBQXNCO0FBQy9CLFVBQU1ELElBQU4sRUFBWUMsWUFBWjtBQUNEOztBQXNERCxRQUFNQyxHQUFOLENBQVdDLElBQUksR0FBRyxFQUFsQixFQUFzQjtBQUNwQkEsSUFBQUEsSUFBSSxHQUFHQyxnQkFBRUMsU0FBRixDQUFZRixJQUFaLENBQVA7O0FBQ0FDLG9CQUFFRSxZQUFGLENBQWVILElBQWYsRUFBcUI7QUFDbkJJLE1BQUFBLGlCQUFpQixFQUFFLEVBREE7QUFFbkJDLE1BQUFBLFVBQVUsRUFBRSxLQUZPO0FBR25CQyxNQUFBQSxjQUFjLEVBQUUsS0FBS0E7QUFIRixLQUFyQjs7QUFNQSxRQUFJTixJQUFJLENBQUNPLFdBQVQsRUFBc0I7QUFDcEJQLE1BQUFBLElBQUksQ0FBQ0ksaUJBQUwsQ0FBdUJJLHdCQUF2QixHQUFrREMsVUFBVSxDQUFDVCxJ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c0csTUFBTyxPQUFNSCxXQUFXLEdBQUcsT0FBSCxHQUFhLFdBQVksSUFBR0MsYUFBYyxhQUF2RixHQUNOLE9BQU0sS0FBS2hJLElBQUssWUFEbkI7QUFFRDs7QUFLRCxRQUFNbUksb0JBQU4sR0FBOEI7QUFDNUIsVUFBTUMsT0FBTyxHQUFHLE1BQU0sOEJBQXRCO0FBQ0EsV0FBTzdDLGNBQUtDLE9BQUwsQ0FBYTRDLE9BQWIsRUFDTCwwSkFESyxDQUFQO0FBRUQ7O0FBL1kyQzs7ZUFtWi9CdkksZSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBTaW11bGF0b3JYY29kZTggZnJvbSAnLi9zaW11bGF0b3IteGNvZGUtOCc7XG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgeyBmcywgdGltaW5nIH0gZnJvbSAnYXBwaXVtLXN1cHBvcnQnO1xuaW1wb3J0IEFzeW5jTG9jayBmcm9tICdhc3luYy1sb2NrJztcbmltcG9ydCBsb2cgZnJvbSAnLi9sb2dnZXInO1xuaW1wb3J0IHsgd2FpdEZvckNvbmRpdGlvbiwgcmV0cnlJbnRlcnZhbCB9IGZyb20gJ2FzeW5jYm94JztcbmltcG9ydCB7IHRvQmlvbWV0cmljRG9tYWluQ29tcG9uZW50LCBnZXREZXZlbG9wZXJSb290IH0gZnJvbSAnLi91dGlscy5qcyc7XG5pbXBvcnQgeyBOU1VzZXJEZWZhdWx0cyB9IGZyb20gJy4vZGVmYXVsdHMtdXRpbHMnO1xuXG5jb25zdCBTSU1VTEFUT1JfU0hVVERPV05fVElNRU9VVCA9IDE1ICogMTAwMDtcbmNvbnN0IHN0YXJ0dXBMb2NrID0gbmV3IEFzeW5jTG9jaygpO1xuY29uc3QgcHJlZmVyZW5jZXNQbGlzdEd1YXJkID0gbmV3IEFzeW5jTG9jaygpO1xuY29uc3QgRU5ST0xMTUVOVF9OT1RJRklDQVRJT05fUkVDRUlWRVIgPSAnY29tLmFwcGxlLkJpb21ldHJpY0tpdC5lbnJvbGxtZW50Q2hhbmdlZCc7XG5cbmNsYXNzIFNpbXVsYXRvclhjb2RlOSBleHRlbmRzIFNpbXVsYXRvclhjb2RlOCB7XG4gIGNvbnN0cnVjdG9yICh1ZGlkLCB4Y29kZVZlcnNpb24pIHtcbiAgICBzdXBlcih1ZGlkLCB4Y29kZVZlcnNpb24pO1xuICB9XG5cbiAgLyoqXG4gICAqIEB0eXBlZGVmIHtPYmplY3R9IERldmljZVByZWZlcmVuY2VzXG4gICAqIEBwcm9wZXJ0eSB7P251bWJlcn0gU2ltdWxhdG9yRXh0ZXJuYWxEaXNwbGF5IC0gVEJELiBFeGFtcGxlIHZhbHVlOiAyLjExNFxuICAgKiBAcHJvcGVydHkgez9zdHJpbmd9IENocm9tZVRpbnQgLSBUQkQuIEV4YW1wbGUgdmFsdWU6ICcnXG4gICAqIEBwcm9wZXJ0eSB7P251bWJlcn0gU2ltdWxhdG9yV2luZG93TGFzdFNjYWxlIC0gU2NhbGUgdmFsdWUgZm9yIHRoZSBwYXJ0aWN1bGFyIFNpbXVsYXRvciB3aW5kb3cuXG4gICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMS4wIG1lYW5zIDEwMCUgc2NhbGUuXG4gICAqIEBwcm9wZXJ0eSB7P3N0cmluZ30gU2ltdWxhdG9yV2luZG93T3JpZW50YXRpb24gLSBTaW11bGF0b3Igd2luZG93IG9yaWVudGF0aW9uLiBQb3NzaWJsZSB2YWx1ZXMgYXJlOlxuICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1BvcnRyYWl0JywgJ0xhbmRzY2FwZUxlZnQnLCAnUG9ydHJhaXRVcHNpZGVEb3duJyBhbmQgJ0xhbmRzY2FwZVJpZ2h0Jy5cbiAgICogQHByb3BlcnR5IHs/bnVtYmVyfSBTaW11bGF0b3JXaW5kb3dSb3RhdGlvbkFuZ2xlIC0gV2luZG93IHJvdGF0aW9uIGFuZ2xlLiBUaGlzIHZhbHVlIGlzIGV4cGVjdGVkIHRvIGJlIGluIHN5bmNcbiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2l0aCBfU2ltdWxhdG9yV2luZG93T3JpZW50YXRpb25fLiBUaGUgY29ycmVzcG9uZGluZyB2YWx1ZXMgYXJlOlxuICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAwLCA5MCwgMTgwIGFuZCAyNzAuXG4gICAqIEBwcm9wZXJ0eSB7P3N0cmluZ30gU2ltdWxhdG9yV2luZG93Q2VudGVyIC0gVGhlIGNvb3JkaW5hdGVzIG9mIFNpbXVsYXRvcidzIHdpbmRvdyBjZW50ZXIgaW4gcGl4ZWxzLFxuICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBleGFtcGxlICd7LTEyOTQuNSwgNzc1LjV9Jy5cbiAgICogQHByb3BlcnR5IHs/Ym9vbGVhbn0gQ29ubmVjdEhhcmR3YXJlS2V5Ym9hcmQgLSBFcXVhbHMgdG8gMSBpZiBoYXJkd2FyZSBrZXlib2FyZCBzaG91bGQgYmUgY29ubmVjdGVkLlxuICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE90aGVyd2lzZSAwLlxuICAgKi9cblxuICAvKipcbiAgICogQHR5cGVkZWYge09iamVjdH0gQ29tbW9uUHJlZmVyZW5jZXNcbiAgICogQHByb3BlcnR5IHtib29sZWFufSBDb25uZWN0SGFyZHdhcmVLZXlib2FyZCAtIFdoZXRoZXIgdG8gY29ubmVjdCBoYXJkd2FyZSBrZXlib2FyZFxuICAgKi9cblxuICAvKipcbiAgICogQHR5cGVkZWYge09iamVjdH0gUnVuT3B0aW9uc1xuICAgKiBAcHJvcGVydHkge3N0cmluZ30gc2NhbGVGYWN0b3I6IEFueSBwb3NpdGl2ZSBmbG9hdCB2YWx1ZS4gMS4wIG1lYW5zIDE6MSBzY2FsZS5cbiAgICogRGVmaW5lcyB0aGUgd2luZG93IHNjYWxlIHZhbHVlIGZvciB0aGUgVUkgY2xpZW50IHdpbmRvdyBmb3IgdGhlIGN1cnJlbnQgU2ltdWxhdG9yLlxuICAgKiBFcXVhbHMgdG8gYG51bGxgIGJ5IGRlZmF1bHQsIHdoaWNoIGtlZXBzIHRoZSBjdXJyZW50IHNjYWxlIHVuY2hhbmdlZC5cbiAgICogQHByb3BlcnR5IHtib29sZWFufSBjb25uZWN0SGFyZHdhcmVLZXlib2FyZDogd2hldGhlciB0byBjb25uZWN0IHRoZSBoYXJkd2FyZSBrZXlib2FyZCB0byB0aGVcbiAgICogU2ltdWxhdG9yIFVJIGNsaWVudC4gRXF1YWxzIHRvIGBmYWxzZWAgYnkgZGVmYXVsdC5cbiAgICogQHByb3BlcnR5IHtudW1iZXJ9IHN0YXJ0dXBUaW1lb3V0OiBudW1iZXIgb2YgbWlsbGlzZWNvbmRzIHRvIHdhaXQgdW50aWwgU2ltdWxhdG9yIGJvb3RpbmdcbiAgICogcHJvY2VzcyBpcyBjb21wbGV0ZWQuIFRoZSBkZWZhdWx0IHRpbWVvdXQgd2lsbCBiZSB1c2VkIGlmIG5vdCBzZXQgZXhwbGljaXRseS5cbiAgICogQHByb3BlcnR5IHtib29sZWFufSBpc0hlYWRsZXNzOiB3aGV0aGVyIHRvIHN0YXJ0IHRoZSBTaW11bGF0b3IgaW4gaGVhZGxlc3MgbW9kZSAod2l0aCBVSVxuICAgKiBjbGllbnQgaW52aXNpYmxlKS4gYGZhbHNlYCBieSBkZWZhdWx0LlxuICAgKiBAcHJvcGVydHkgez9ib29sZWFufSB0cmFjZVBvaW50ZXIgW2ZhbHNlXSAtIFdoZXRoZXIgdG8gaGlnaGxpZ2h0IHRvdWNoZXMgb24gU2ltdWxhdG9yXG4gICAqIHNjcmVlbi4gVGhpcyBpcyBoZWxwZnVsIHdoaWxlIGRlYnVnZ2luZyBhdXRvbWF0ZWQgdGVzdHMgb3Igd2hpbGUgb2JzZXJ2aW5nIHRoZSBhdXRvbWF0aW9uXG4gICAqIHJlY29yZGluZ3MuXG4gICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBwYXN0ZWJvYXJkQXV0b21hdGljU3luYyBbJ29mZiddIC0gV2hldGhlciB0byBkaXNhYmxlIHBhc3RlYm9hcmQgc3luYyB3aXRoIHRoZVxuICAgKiBTaW11bGF0b3IgVUkgY2xpZW50IG9yIHJlc3BlY3QgdGhlIHN5c3RlbSB3aWRlIHByZWZlcmVuY2UuICdvbicsICdvZmYnLCBvciAnc3lzdGVtJyBpcyBhdmFpbGFibGUuXG4gICAqIFRoZSBzeW5jIGluY3JlYXNlcyBsYXVuY2hpbmcgc2ltdWxhdG9yIHByb2Nlc3MgdGltZSwgYnV0IGl0IGFsbG93cyBzeXN0ZW0gdG8gc3luYyBwYXN0ZWJvYXJkXG4gICAqIHdpdGggc2ltdWxhdG9ycy4gRm9sbG93cyBzeXN0ZW0td2lkZSBwcmVmZXJlbmNlIGlmIHRoZSB2YWx1ZSBpcyAnc3lzdGVtJy5cbiAgICogRGVmYXVsdHMgdG8gJ29mZicuXG4gICAqIEBwcm9wZXJ0eSB7RGV2aWNlUHJlZmVyZW5jZXN9IGRldmljZVByZWZlcmVuY2VzOiBwcmVmZXJlbmNlcyBvZiB0aGUgbmV3bHkgY3JlYXRlZCBTaW11bGF0b3JcbiAgICogZGV2aWNlXG4gICAqL1xuXG4gIC8qKlxuICAgKiBFeGVjdXRlcyBnaXZlbiBTaW11bGF0b3Igd2l0aCBvcHRpb25zLiBUaGUgU2ltdWxhdG9yIHdpbGwgbm90IGJlIHJlc3RhcnRlZCBpZlxuICAgKiBpdCBpcyBhbHJlYWR5IHJ1bm5pbmcgYW5kIHRoZSBjdXJyZW50IFVJIHN0YXRlIG1hdGNoZXMgdG8gYGlzSGVhZGxlc3NgIG9wdGlvbi5cbiAgICogQG92ZXJyaWRlXG4gICAqXG4gICAqIEBwYXJhbSB7UnVuT3B0aW9uc30gb3B0cyAtIE9uZSBvciBtb3JlIG9mIGF2YWlsYWJsZSBTaW11bGF0b3Igb3B0aW9uc1xuICAgKi9cbiAgYXN5bmMgcnVuIChvcHRzID0ge30pIHtcbiAgICBvcHRzID0gXy5jbG9uZURlZXAob3B0cyk7XG4gICAgXy5kZWZhdWx0c0RlZXAob3B0cywge1xuICAgICAgZGV2aWNlUHJlZmVyZW5jZXM6IHt9LFxuICAgICAgaXNIZWFkbGVzczogZmFsc2UsXG4gICAgICBzdGFydHVwVGltZW91dDogdGhpcy5zdGFydHVwVGltZW91dCxcbiAgICB9KTtcblxuICAgIGlmIChvcHRzLnNjYWxlRmFjdG9yKSB7XG4gICAgICBvcHRzLmRldmljZVByZWZlcmVuY2VzLlNpbXVsYXRvcldpbmRvd0xhc3RTY2FsZSA9IHBhcnNlRmxvYXQob3B0cy5zY2FsZUZhY3Rvcik7XG4gICAgfVxuICAgIC8vIFRoaXMgb3B0aW9uIGlzIG5lY2Vzc2FyeSB0byBtYWtlIHRoZSBTaW11bGF0b3Igd2luZG93IGZvbGxvd1xuICAgIC8vIHRoZSBhY3R1YWwgWENVSURldmljZSBvcmllbnRhdGlvblxuICAgIGNvbnN0IGNvbW1vblByZWZlcmVuY2VzID0ge1xuICAgICAgUm90YXRlV2luZG93V2hlblNpZ25hbGVkQnlHdWVzdDogdHJ1ZVxuICAgIH07XG4gICAgaWYgKF8uaXNCb29sZWFuKG9wdHMuY29ubmVjdEhhcmR3YXJlS2V5Ym9hcmQpIHx8IF8uaXNOaWwob3B0cy5jb25uZWN0SGFyZHdhcmVLZXlib2FyZCkpIHtcbiAgICAgIG9wdHMuZGV2aWNlUHJlZmVyZW5jZXMuQ29ubmVjdEhhcmR3YXJlS2V5Ym9hcmQgPSBvcHRzLmNvbm5lY3RIYXJkd2FyZUtleWJvYXJkID8/IGZhbHNlO1xuICAgICAgY29tbW9uUHJlZmVyZW5jZXMuQ29ubmVjdEhhcmR3YXJlS2V5Ym9hcmQgPSBvcHRzLmNvbm5lY3RIYXJkd2FyZUtleWJvYXJkID8/IGZhbHNlO1xuICAgIH1cbiAgICBpZiAoXy5pc0Jvb2xlYW4ob3B0cy50cmFjZVBvaW50ZXIpKSB7XG4gICAgICBjb21tb25QcmVmZXJlbmNlcy5TaG93U2luZ2xlVG91Y2hlcyA9IG9wdHMudHJhY2VQb2ludGVyO1xuICAgICAgY29tbW9uUHJlZmVyZW5jZXMuU2hvd1BpbmNoZXMgPSBvcHRzLnRyYWNlUG9pbnRlcjtcbiAgICAgIGNvbW1vblByZWZlcmVuY2VzLlNob3dQaW5jaFBpdm90UG9pbnQgPSBvcHRzLnRyYWNlUG9pbnRlcjtcbiAgICAgIGNvbW1vblByZWZlcmVuY2VzLkhpZ2hsaWdodEVkZ2VHZXN0dXJlcyA9IG9wdHMudHJhY2VQb2ludGVyO1xuICAgIH1cbiAgICBzd2l0Y2ggKF8ubG93ZXJDYXNlKG9wdHMucGFzdGVib2FyZEF1dG9tYXRpY1N5bmMpKSB7XG4gICAgICBjYXNlICdvbic6XG4gICAgICAgIGNvbW1vblByZWZlcmVuY2VzLlBhc3RlYm9hcmRBdXRvbWF0aWNTeW5jID0gdHJ1ZTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdvZmYnOlxuICAgICAgICAvLyBJbXByb3ZlIGxhdW5jaGluZyBzaW11bGF0b3IgcGVyZm9ybWFuY2VcbiAgICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL1dlYktpdC93ZWJraXQvYmxvYi9tYXN0ZXIvVG9vbHMvU2NyaXB0cy93ZWJraXRweS94Y29kZS9zaW11bGF0ZWRfZGV2aWNlLnB5I0w0MTNcbiAgICAgICAgY29tbW9uUHJlZmVyZW5jZXMuUGFzdGVib2FyZEF1dG9tYXRpY1N5bmMgPSBmYWxzZTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdzeXN0ZW0nOlxuICAgICAgICAvLyBEbyBub3QgYWRkIC1QYXN0ZWJvYXJkQXV0b21hdGljU3luY1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIGxvZy5pbmZvKGBbJ29uJywgJ29mZicgb3IgJ3N5c3RlbSddIGFyZSBhdmFpbGFibGUgYXMgdGhlIHBhc3RlYm9hcmQgYXV0b21hdGljIHN5bmMgb3B0aW9uLiBEZWZhdWx0aW5nIHRvICdvZmYnYCk7XG4gICAgICAgIGNvbW1vblByZWZlcmVuY2VzLlBhc3RlYm9hcmRBdXRvbWF0aWNTeW5jID0gZmFsc2U7XG4gICAgfVxuICAgIGF3YWl0IHRoaXMudXBkYXRlUHJlZmVyZW5jZXMob3B0cy5kZXZpY2VQcmVmZXJlbmNlcywgY29tbW9uUHJlZmVyZW5jZXMpO1xuXG4gICAgY29uc3QgdGltZXIgPSBuZXcgdGltaW5nLlRpbWVyKCkuc3RhcnQoKTtcbiAgICBjb25zdCBzaG91bGRXYWl0Rm9yQm9vdCA9IGF3YWl0IHN0YXJ0dXBMb2NrLmFjcXVpcmUodGhpcy51aUNsaWVudEJ1bmRsZUlkLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBpc1NlcnZlclJ1bm5pbmcgPSBhd2FpdCB0aGlzLmlzUnVubmluZygpO1xuICAgICAgY29uc3QgdWlDbGllbnRQaWQgPSBhd2FpdCB0aGlzLmdldFVJQ2xpZW50UGlkKCk7XG4gICAgICBpZiAob3B0cy5pc0hlYWRsZXNzKSB7XG4gICAgICAgIGlmIChpc1NlcnZlclJ1bm5pbmcgJiYgIXVpQ2xpZW50UGlkKSB7XG4gICAgICAgICAgbG9nLmluZm8oYFNpbXVsYXRvciB3aXRoIFVESUQgJyR7dGhpcy51ZGlkfScgaXMgYWxyZWFkeSBib290ZWQgaW4gaGVhZGxlc3MgbW9kZS5gKTtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGF3YWl0IHRoaXMua2lsbFVJQ2xpZW50KHtwaWQ6IHVpQ2xpZW50UGlkfSkpIHtcbiAgICAgICAgICBsb2cuaW5mbyhgRGV0ZWN0ZWQgdGhlIFNpbXVsYXRvciBVSSBjbGllbnQgd2FzIHJ1bm5pbmcgYW5kIGtpbGxlZCBpdC4gVmVyaWZ5aW5nIHRoZSBjdXJyZW50IFNpbXVsYXRvciBzdGF0ZWApO1xuICAgICAgICB9XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgLy8gU3RvcHBpbmcgdGhlIFVJIGNsaWVudCBraWxscyBhbGwgcnVubmluZyBzZXJ2ZXJzIGZvciBzb21lIGVhcmx5IFhDb2RlIHZlcnNpb25zLiBUaGlzIGlzIGEga25vd24gYnVnXG4gICAgICAgICAgYXdhaXQgd2FpdEZvckNvbmRpdGlvbihhc3luYyAoKSA9PiBhd2FpdCB0aGlzLmlzU2h1dGRvd24oKSwge1xuICAgICAgICAgICAgd2FpdE1zOiA1MDAwLFxuICAgICAgICAgICAgaW50ZXJ2YWxNczogMTAwLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgaWYgKCFhd2FpdCB0aGlzLmlzUnVubmluZygpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFNpbXVsYXRvciB3aXRoIFVESUQgJyR7dGhpcy51ZGlkfScgY2Fubm90IGJlIHRyYW5zaXRpb25lZCB0byBoZWFkbGVzcyBtb2RlYCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBsb2cuaW5mbyhgQm9vdGluZyBTaW11bGF0b3Igd2l0aCBVRElEICcke3RoaXMudWRpZH0nIGluIGhlYWRsZXNzIG1vZGUuIGAgK1xuICAgICAgICAgIGBBbGwgVUktcmVsYXRlZCBjYXBhYmlsaXRpZXMgYXJlIGdvaW5nIHRvIGJlIGlnbm9yZWRgKTtcbiAgICAgICAgYXdhaXQgdGhpcy5ib290KCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoaXNTZXJ2ZXJSdW5uaW5nICYmIHVpQ2xpZW50UGlkKSB7XG4gICAgICAgICAgbG9nLmluZm8oYEJvdGggU2ltdWxhdG9yIHdpdGggVURJRCAnJHt0aGlzLnVkaWR9JyBhbmQgdGhlIFVJIGNsaWVudCBhcmUgY3VycmVudGx5IHJ1bm5pbmdgKTtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGlzU2VydmVyUnVubmluZykge1xuICAgICAgICAgIGxvZy5pbmZvKGBTaW11bGF0b3IgJyR7dGhpcy51ZGlkfScgaXMgYm9vdGVkIHdoaWxlIGl0cyBVSSBpcyBub3QgdmlzaWJsZS4gYCArXG4gICAgICAgICAgICBgVHJ5aW5nIHRvIHJlc3RhcnQgaXQgd2l0aCB0aGUgU2ltdWxhdG9yIHdpbmRvdyB2aXNpYmxlYCk7XG4gICAgICAgICAgYXdhaXQgdGhpcy5zaHV0ZG93bih7dGltZW91dDogU0lNVUxBVE9SX1NIVVRET1dOX1RJTUVPVVR9KTtcbiAgICAgICAgfVxuICAgICAgICBhd2FpdCB0aGlzLmxhdW5jaFdpbmRvdyh1aUNsaWVudFBpZCwgb3B0cyk7XG4gICAgICB9XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9KTtcblxuICAgIGlmIChzaG91bGRXYWl0Rm9yQm9vdCkge1xuICAgICAgYXdhaXQgdGhpcy53YWl0Rm9yQm9vdChvcHRzLnN0YXJ0dXBUaW1lb3V0KTtcbiAgICAgIGxvZy5pbmZvKGBTaW11bGF0b3Igd2l0aCBVRElEICR7dGhpcy51ZGlkfSBib290ZWQgaW4gJHt0aW1lci5nZXREdXJhdGlvbigpLmFzU2Vjb25kcy50b0ZpeGVkKDMpfXNgKTtcbiAgICB9XG4gIH1cblxuICAvKioqXG4gICAqIEJvb3RzIHNpbXVsYXRvciBhbmQgb3BlbnMgc2ltdWxhdG9ycyBVSSBDbGllbnQgaWYgbm90IGFscmVhZHkgb3BlbmVkLlxuICAgKlxuICAgKiBAcGFyYW0ge2Jvb2xlYW59IGlzVWlDbGllbnRSdW5uaW5nIC0gcHJvY2VzcyBpZCBvZiBzaW11bGF0b3IgVUkgY2xpZW50LlxuICAgKiBAcGFyYW0ge1J1bk9wdGlvbnN9IG9wdHMgLSBhcmd1bWVudHMgdG8gc3RhcnQgc2ltdWxhdG9yIFVJIGNsaWVudCB3aXRoLlxuICAgKi9cbiAgYXN5bmMgbGF1bmNoV2luZG93IChpc1VpQ2xpZW50UnVubmluZywgb3B0cyA9IHt9KSB7XG4gICAgYXdhaXQgdGhpcy5ib290KCk7XG4gICAgaWYgKCFpc1VpQ2xpZW50UnVubmluZykge1xuICAgICAgYXdhaXQgdGhpcy5zdGFydFVJQ2xpZW50KG9wdHMpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBCb290cyBzaW11bGF0b3IgaWYgbm90IGFscmVhZHkgYm9vdGVkLlxuICAgKiBEb2VzIG5vdGhpbmcgaWYgaXQgaXMgYWxyZWFkeSBydW5uaW5nLlxuICAgKlxuICAgKiBAdGhyb3dzIHtFcnJvcn0gSWYgU2ltdWxhdG9yIGlzIHN0aWxsIG5vdCBydW5uaW5nIGFmdGVyIGJlaW5nIGJvb3RlZFxuICAgKi9cbiAgYXN5bmMgYm9vdCAoKSB7XG4gICAgaWYgKGF3YWl0IHRoaXMuaXNSdW5uaW5nKCkpIHtcbiAgICAgIGxvZy5pbmZvKGBTaW11bGF0b3IgJyR7dGhpcy51ZGlkfScgaXMgYWxyZWFkeSBydW5uaW5nYCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgbG9nLmluZm8oYEJvb3RpbmcgU2ltdWxhdG9yICcke3RoaXMudWRpZH0nYCk7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRoaXMuc2ltY3RsLmJvb3REZXZpY2UoKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBsb2cud2FybihlLnN0ZGVyciB8fCBlLm1lc3NhZ2UpO1xuICAgIH1cblxuICAgIGF3YWl0IHJldHJ5SW50ZXJ2YWwoNSwgMTAwMCwgYXN5bmMgKCkgPT4ge1xuICAgICAgaWYgKCFhd2FpdCB0aGlzLmlzUnVubmluZygpKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgU2ltdWxhdG9yICcke3RoaXMudWRpZH0nIGlzIG5vdCBydW5uaW5nIGFmdGVyIGJlaW5nIGJvb3RlZC4gYCArXG4gICAgICAgICAgYENoZWNrIHRoZSBBcHBpdW0gbG9nIGZvciBtb3JlIGRldGFpbHMuYCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogUGVyZm9ybSB2ZXJpZmljYXRpb24gb2YgZGV2aWNlIHByZWZlcmVuY2VzIGNvcnJlY3RuZXNzLlxuICAgKlxuICAgKiBAcGFyYW0ge0RldmljZVByZWZlcmVuY2VzfSBwcmVmcyBbe31dIC0gVGhlIHByZWZlcmVuY2VzIHRvIGJlIHZlcmlmaWVkXG4gICAqIEB0aHJvd3Mge0Vycm9yfSBJZiBhbnkgb2YgdGhlIGdpdmVuIHByZWZlcmVuY2UgdmFsdWVzIGRvZXMgbm90IG1hdGNoIHRoZSBleHBlY3RlZFxuICAgKiBmb3JtYXQuXG4gICAqL1xuICB2ZXJpZnlEZXZpY2VQcmVmZXJlbmNlcyAocHJlZnMgPSB7fSkge1xuICAgIGlmIChfLmlzRW1wdHkocHJlZnMpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKCFfLmlzVW5kZWZpbmVkKHByZWZzLlNpbXVsYXRvcldpbmRvd0xhc3RTY2FsZSkpIHtcbiAgICAgIGlmICghXy5pc051bWJlcihwcmVmcy5TaW11bGF0b3JXaW5kb3dMYXN0U2NhbGUpIHx8IHByZWZzLlNpbXVsYXRvcldpbmRvd0xhc3RTY2FsZSA8PSAwKSB7XG4gICAgICAgIGxvZy5lcnJvckFuZFRocm93KGBTaW11bGF0b3JXaW5kb3dMYXN0U2NhbGUgaXMgZXhwZWN0ZWQgdG8gYmUgYSBwb3NpdGl2ZSBmbG9hdCB2YWx1ZS4gYCArXG4gICAgICAgICAgYCcke3ByZWZzLlNpbXVsYXRvcldpbmRvd0xhc3RTY2FsZX0nIGlzIGFzc2lnbmVkIGluc3RlYWQuYCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKCFfLmlzVW5kZWZpbmVkKHByZWZzLlNpbXVsYXRvcldpbmRvd0NlbnRlcikpIHtcbiAgICAgIC8vIGh0dHBzOi8vcmVnZXgxMDEuY29tL3IvMlpYT2lqLzJcbiAgICAgIGNvbnN0IHZlcmlmaWNhdGlvblBhdHRlcm4gPSAvey0/XFxkKyhcXC5cXGQrKT8sLT9cXGQrKFxcLlxcZCspP30vO1xuICAgICAgaWYgKCFfLmlzU3RyaW5nKHByZWZzLlNpbXVsYXRvcldpbmRvd0NlbnRlcikgfHwgIXZlcmlmaWNhdGlvblBhdHRlcm4udGVzdChwcmVmcy5TaW11bGF0b3JXaW5kb3dDZW50ZXIpKSB7XG4gICAgICAgIGxvZy5lcnJvckFuZFRocm93KGBTaW11bGF0b3JXaW5kb3dDZW50ZXIgaXMgZXhwZWN0ZWQgdG8gbWF0Y2ggXCJ7ZmxvYXRYUG9zaXRpb24sZmxvYXRZUG9zaXRpb259XCIgZm9ybWF0ICh3aXRob3V0IHNwYWNlcykuIGAgK1xuICAgICAgICAgIGAnJHtwcmVmcy5TaW11bGF0b3JXaW5kb3dDZW50ZXJ9JyBpcyBhc3NpZ25lZCBpbnN0ZWFkLmApO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmICghXy5pc1VuZGVmaW5lZChwcmVmcy5TaW11bGF0b3JXaW5kb3dPcmllbnRhdGlvbikpIHtcbiAgICAgIGNvbnN0IGFjY2VwdGFibGVWYWx1ZXMgPSBbJ1BvcnRyYWl0JywgJ0xhbmRzY2FwZUxlZnQnLCAnUG9ydHJhaXRVcHNpZGVEb3duJywgJ0xhbmRzY2FwZVJpZ2h0J107XG4gICAgICBpZiAoYWNjZXB0YWJsZVZhbHVlcy5pbmRleE9mKHByZWZzLlNpbXVsYXRvcldpbmRvd09yaWVudGF0aW9uKSA9PT0gLTEpIHtcbiAgICAgICAgbG9nLmVycm9yQW5kVGhyb3coYFNpbXVsYXRvcldpbmRvd09yaWVudGF0aW9uIGlzIGV4cGVjdGVkIHRvIGJlIG9uZSBvZiAke2FjY2VwdGFibGVWYWx1ZXN9LiBgICtcbiAgICAgICAgICBgJyR7cHJlZnMuU2ltdWxhdG9yV2luZG93T3JpZW50YXRpb259JyBpcyBhc3NpZ25lZCBpbnN0ZWFkLmApO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmICghXy5pc1VuZGVmaW5lZChwcmVmcy5TaW11bGF0b3JXaW5kb3dSb3RhdGlvbkFuZ2xlKSkge1xuICAgICAgaWYgKCFfLmlzTnVtYmVyKHByZWZzLlNpbXVsYXRvcldpbmRvd1JvdGF0aW9uQW5nbGUpKSB7XG4gICAgICAgIGxvZy5lcnJvckFuZFRocm93KGBTaW11bGF0b3JXaW5kb3dSb3RhdGlvbkFuZ2xlIGlzIGV4cGVjdGVkIHRvIGJlIGEgdmFsaWQgbnVtYmVyLiBgICtcbiAgICAgICAgICBgJyR7cHJlZnMuU2ltdWxhdG9yV2luZG93Um90YXRpb25BbmdsZX0nIGlzIGFzc2lnbmVkIGluc3RlYWQuYCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZSB0aGUgY29tbW9uIGlPUyBTaW11bGF0b3IgcHJlZmVyZW5jZXMgZmlsZSB3aXRoIG5ldyB2YWx1ZXMuXG4gICAqIEl0IGlzIG5lY2Vzc2FyeSB0byByZXN0YXJ0IHRoZSBjb3JyZXNwb25kaW5nIFNpbXVsYXRvciBiZWZvcmVcbiAgICogdGhlc2UgY2hhbmdlcyBhcmUgYXBwbGllZC5cbiAgICpcbiAgICogQHBhcmFtIHtEZXZpY2VQcmVmZXJlbmNlc30gZGV2aWNlUHJlZnMgW3t9XSAtIFRoZSBtYXBwaW5nLCB3aGljaCByZXByZXNlbnRzIG5ldyBkZXZpY2UgcHJlZmVyZW5jZSB2YWx1ZXNcbiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciB0aGUgZ2l2ZW4gU2ltdWxhdG9yLlxuICAgKiBAcGFyYW0ge0NvbW1vblByZWZlcmVuY2VzfSBjb21tb25QcmVmcyBbe31dIC0gVGhlIG1hcHBpbmcsIHdoaWNoIHJlcHJlc2VudHMgbmV3IGNvbW1vbiBwcmVmZXJlbmNlIHZhbHVlc1xuICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGFsbCBTaW11bGF0b3JzLlxuICAgKiBAcmV0dXJuIHtib29sZWFufSBUcnVlIGlmIHRoZSBwcmVmZXJlbmNlcyB3ZXJlIHN1Y2Nlc3NmdWxseSB1cGRhdGVkLlxuICAgKi9cbiAgYXN5bmMgdXBkYXRlUHJlZmVyZW5jZXMgKGRldmljZVByZWZzID0ge30sIGNvbW1vblByZWZzID0ge30pIHtcbiAgICBpZiAoIV8uaXNFbXB0eShkZXZpY2VQcmVmcykpIHtcbiAgICAgIGxvZy5kZWJ1ZyhgU2V0dGluZyBwcmVmZXJlbmNlcyBvZiAke3RoaXMudWRpZH0gU2ltdWxhdG9yIHRvICR7SlNPTi5zdHJpbmdpZnkoZGV2aWNlUHJlZnMpfWApO1xuICAgIH1cbiAgICBpZiAoIV8uaXNFbXB0eShjb21tb25QcmVmcykpIHtcbiAgICAgIGxvZy5kZWJ1ZyhgU2V0dGluZyBjb21tb24gU2ltdWxhdG9yIHByZWZlcmVuY2VzIHRvICR7SlNPTi5zdHJpbmdpZnkoY29tbW9uUHJlZnMpfWApO1xuICAgIH1cbiAgICBjb25zdCBob21lRm9sZGVyUGF0aCA9IHByb2Nlc3MuZW52LkhPTUU7XG4gICAgaWYgKCFob21lRm9sZGVyUGF0aCkge1xuICAgICAgbG9nLndhcm4oYENhbm5vdCBnZXQgdGhlIHBhdGggdG8gSE9NRSBmb2xkZXIgZnJvbSB0aGUgcHJvY2VzcyBlbnZpcm9ubWVudC4gYCArXG4gICAgICAgIGBJZ25vcmluZyBTaW11bGF0b3IgcHJlZmVyZW5jZXMgdXBkYXRlLmApO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICB0aGlzLnZlcmlmeURldmljZVByZWZlcmVuY2VzKGRldmljZVByZWZzKTtcbiAgICBjb25zdCBwbGlzdFBhdGggPSBwYXRoLnJlc29sdmUoaG9tZUZvbGRlclBhdGgsICdMaWJyYXJ5JywgJ1ByZWZlcmVuY2VzJywgJ2NvbS5hcHBsZS5pcGhvbmVzaW11bGF0b3IucGxpc3QnKTtcbiAgICByZXR1cm4gYXdhaXQgcHJlZmVyZW5jZXNQbGlzdEd1YXJkLmFjcXVpcmUoU2ltdWxhdG9yWGNvZGU5Lm5hbWUsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGRlZmF1bHRzID0gbmV3IE5TVXNlckRlZmF1bHRzKHBsaXN0UGF0aCk7XG4gICAgICBjb25zdCBwcmVmc1RvVXBkYXRlID0gXy5jbG9uZShjb21tb25QcmVmcyk7XG4gICAgICB0cnkge1xuICAgICAgICBpZiAoIV8uaXNFbXB0eShkZXZpY2VQcmVmcykpIHtcbiAgICAgICAgICBsZXQgZXhpc3RpbmdEZXZpY2VQcmVmcztcbiAgICAgICAgICBjb25zdCB1ZGlkS2V5ID0gdGhpcy51ZGlkLnRvVXBwZXJDYXNlKCk7XG4gICAgICAgICAgaWYgKGF3YWl0IGZzLmV4aXN0cyhwbGlzdFBhdGgpKSB7XG4gICAgICAgICAgICBjb25zdCBjdXJyZW50UGxpc3RDb250ZW50ID0gYXdhaXQgZGVmYXVsdHMuYXNKc29uKCk7XG4gICAgICAgICAgICBpZiAoXy5pc1BsYWluT2JqZWN0KGN1cnJlbnRQbGlzdENvbnRlbnQuRGV2aWNlUHJlZmVyZW5jZXMpXG4gICAgICAgICAgICAgICAgJiYgXy5pc1BsYWluT2JqZWN0KGN1cnJlbnRQbGlzdENvbnRlbnQuRGV2aWNlUHJlZmVyZW5jZXNbdWRpZEtleV0pKSB7XG4gICAgICAgICAgICAgIGV4aXN0aW5nRGV2aWNlUHJlZnMgPSBjdXJyZW50UGxpc3RDb250ZW50LkRldmljZVByZWZlcmVuY2VzW3VkaWRLZXldO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBPYmplY3QuYXNzaWduKHByZWZzVG9VcGRhdGUsIHtcbiAgICAgICAgICAgIERldmljZVByZWZlcmVuY2VzOiB7XG4gICAgICAgICAgICAgIFt1ZGlkS2V5XTogT2JqZWN0LmFzc2lnbih7fSwgZXhpc3RpbmdEZXZpY2VQcmVmcyB8fCB7fSwgZGV2aWNlUHJlZnMpXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgYXdhaXQgZGVmYXVsdHMudXBkYXRlKHByZWZzVG9VcGRhdGUpO1xuICAgICAgICBsb2cuZGVidWcoYFVwZGF0ZWQgJHt0aGlzLnVkaWR9IFNpbXVsYXRvciBwcmVmZXJlbmNlcyBhdCAnJHtwbGlzdFBhdGh9JyB3aXRoIGAgK1xuICAgICAgICAgIEpTT04uc3RyaW5naWZ5KHByZWZzVG9VcGRhdGUpKTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGxvZy53YXJuKGBDYW5ub3QgdXBkYXRlICR7dGhpcy51ZGlkfSBTaW11bGF0b3IgcHJlZmVyZW5jZXMgYXQgJyR7cGxpc3RQYXRofScuIGAgK1xuICAgICAgICAgIGBUcnkgdG8gZGVsZXRlIHRoZSBmaWxlIG1hbnVhbGx5IGluIG9yZGVyIHRvIHJlc2V0IGl0LiBPcmlnaW5hbCBlcnJvcjogJHtlLm1lc3NhZ2V9YCk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXNldCB0aGUgY3VycmVudCBTaW11bGF0b3IgdG8gdGhlIGNsZWFuIHN0YXRlLlxuICAgKiBAb3ZlcnJpZGVcbiAgICovXG4gIGFzeW5jIGNsZWFuICgpIHtcbiAgICBsb2cuaW5mbyhgQ2xlYW5pbmcgc2ltdWxhdG9yICR7dGhpcy51ZGlkfWApO1xuICAgIGF3YWl0IHRoaXMuc2ltY3RsLmVyYXNlRGV2aWNlKDEwMDAwKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAaW5oZXJpdGRvY1xuICAgKiBAb3ZlcnJpZGVcbiAgICogQHByaXZhdGVcbiAgICovXG4gIGFzeW5jIF9hY3RpdmF0ZVdpbmRvdyAoKSB7XG4gICAgbGV0IHNlbGZOYW1lO1xuICAgIGxldCBzZWxmU2RrO1xuICAgIGxldCBib290ZWREZXZpY2VzQ291bnQgPSAwO1xuICAgIGZvciAoY29uc3QgW3NkaywgZGV2aWNlQXJyXSBvZiBfLnRvUGFpcnMoYXdhaXQgdGhpcy5zaW1jdGwuZ2V0RGV2aWNlcygpKSkge1xuICAgICAgZm9yIChjb25zdCB7c3RhdGUsIHVkaWQsIG5hbWV9IG9mIGRldmljZUFycikge1xuICAgICAgICBpZiAoc3RhdGUgPT09ICdCb290ZWQnKSB7XG4gICAgICAgICAgYm9vdGVkRGV2aWNlc0NvdW50Kys7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFzZWxmTmFtZSAmJiB1ZGlkID09PSB0aGlzLnVkaWQpIHtcbiAgICAgICAgICBzZWxmU2RrID0gc2RrO1xuICAgICAgICAgIHNlbGZOYW1lID0gbmFtZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBpZiAoYm9vdGVkRGV2aWNlc0NvdW50IDwgMikge1xuICAgICAgcmV0dXJuIGF3YWl0IHN1cGVyLl9hY3RpdmF0ZVdpbmRvdygpO1xuICAgIH1cblxuICAgIC8vIFRoZXJlIGFyZSBwb3RlbnRpYWxseSBtb3JlIHRoYXQgb25lIFNpbXVsYXRvciB3aW5kb3dcbiAgICByZXR1cm4gYFxuICAgICAgdGVsbCBhcHBsaWNhdGlvbiBcIlN5c3RlbSBFdmVudHNcIlxuICAgICAgICB0ZWxsIHByb2Nlc3MgXCJTaW11bGF0b3JcIlxuICAgICAgICAgIHNldCBmcm9udG1vc3QgdG8gZmFsc2VcbiAgICAgICAgICBzZXQgZnJvbnRtb3N0IHRvIHRydWVcbiAgICAgICAgICBjbGljayAobWVudSBpdGVtIDEgd2hlcmUgKGl0cyBuYW1lIGNvbnRhaW5zIFwiJHtzZWxmTmFtZX0gXCIgYW5kIGl0cyBuYW1lIGNvbnRhaW5zIFwiJHtzZWxmU2RrfVwiKSkgb2YgbWVudSAxIG9mIG1lbnUgYmFyIGl0ZW0gXCJXaW5kb3dcIiBvZiBtZW51IGJhciAxXG4gICAgICAgIGVuZCB0ZWxsXG4gICAgICBlbmQgdGVsbFxuICAgIGA7XG4gIH1cblxuICAvKipcbiAgICogQGluaGVyaXRkb2NcbiAgICogQG92ZXJyaWRlXG4gICAqL1xuICBhc3luYyBpc0Jpb21ldHJpY0Vucm9sbGVkICgpIHtcbiAgICBjb25zdCB7c3Rkb3V0fSA9IGF3YWl0IHRoaXMuc2ltY3RsLnNwYXduUHJvY2VzcyhbXG4gICAgICAnbm90aWZ5dXRpbCcsXG4gICAgICAnLWcnLCBFTlJPTExNRU5UX05PVElGSUNBVElPTl9SRUNFSVZFUlxuICAgIF0pO1xuICAgIGNvbnN0IG1hdGNoID0gKG5ldyBSZWdFeHAoYCR7Xy5lc2NhcGVSZWdFeHAoRU5ST0xMTUVOVF9OT1RJRklDQVRJT05fUkVDRUlWRVIpfVxcXFxzKyhbMDFdKWApKVxuICAgICAgLmV4ZWMoc3Rkb3V0KTtcbiAgICBpZiAoIW1hdGNoKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCBwYXJzZSBiaW9tZXRyaWMgZW5yb2xsbWVudCBzdGF0ZSBmcm9tICcke3N0ZG91dH0nYCk7XG4gICAgfVxuICAgIGxvZy5pbmZvKGBDdXJyZW50IGJpb21ldHJpYyBlbnJvbGxlZCBzdGF0ZSBmb3IgJHt0aGlzLnVkaWR9IFNpbXVsYXRvcjogJHttYXRjaFsxXX1gKTtcbiAgICByZXR1cm4gbWF0Y2hbMV0gPT09ICcxJztcbiAgfVxuXG4gIC8qKlxuICAgKiBAaW5oZXJpdGRvY1xuICAgKiBAb3ZlcnJpZGVcbiAgICovXG4gIGFzeW5jIGVucm9sbEJpb21ldHJpYyAoaXNFbmFibGVkID0gdHJ1ZSkge1xuICAgIGxvZy5kZWJ1ZyhgU2V0dGluZyBiaW9tZXRyaWMgZW5yb2xsZWQgc3RhdGUgZm9yICR7dGhpcy51ZGlkfSBTaW11bGF0b3IgdG8gJyR7aXNFbmFibGVkID8gJ2VuYWJsZWQnIDogJ2Rpc2FibGVkJ30nYCk7XG4gICAgYXdhaXQgdGhpcy5zaW1jdGwuc3Bhd25Qcm9jZXNzKFtcbiAgICAgICdub3RpZnl1dGlsJyxcbiAgICAgICctcycsIEVOUk9MTE1FTlRfTk9USUZJQ0FUSU9OX1JFQ0VJVkVSLCBpc0VuYWJsZWQgPyAnMScgOiAnMCdcbiAgICBdKTtcbiAgICBhd2FpdCB0aGlzLnNpbWN0bC5zcGF3blByb2Nlc3MoW1xuICAgICAgJ25vdGlmeXV0aWwnLFxuICAgICAgJy1wJywgRU5ST0xMTUVOVF9OT1RJRklDQVRJT05fUkVDRUlWRVJcbiAgICBdKTtcbiAgICBpZiAoYXdhaXQgdGhpcy5pc0Jpb21ldHJpY0Vucm9sbGVkKCkgIT09IGlzRW5hYmxlZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBDYW5ub3Qgc2V0IGJpb21ldHJpYyBlbnJvbGxlZCBzdGF0ZSBmb3IgJHt0aGlzLnVkaWR9IFNpbXVsYXRvciB0byAnJHtpc0VuYWJsZWQgPyAnZW5hYmxlZCcgOiAnZGlzYWJsZWQnfSdgKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU2VuZHMgYSBub3RpZmljYXRpb24gdG8gbWF0Y2gvbm90IG1hdGNoIHRoZSBwYXJ0aWN1bGFyIGJpb21ldHJpYy5cbiAgICogQG92ZXJyaWRlXG4gICAqXG4gICAqIEBwYXJhbSB7P2Jvb2xlYW59IHNob3VsZE1hdGNoIFt0cnVlXSAtIFNldCBpdCB0byB0cnVlIG9yIGZhbHNlIGluIG9yZGVyIHRvIGVtdWxhdGVcbiAgICogbWF0Y2hpbmcvbm90IG1hdGNoaW5nIHRoZSBjb3JyZXNwb25kaW5nIGJpb21ldHJpY1xuICAgKiBAcGFyYW0gez9zdHJpbmd9IGJpb21ldHJpY05hbWUgW3RvdWNoSWRdIC0gRWl0aGVyIHRvdWNoSWQgb3IgZmFjZUlkIChmYWNlSWQgaXMgb25seSBhdmFpbGFibGUgc2luY2UgaU9TIDExKVxuICAgKi9cbiAgYXN5bmMgc2VuZEJpb21ldHJpY01hdGNoIChzaG91bGRNYXRjaCA9IHRydWUsIGJpb21ldHJpY05hbWUgPSAndG91Y2hJZCcpIHtcbiAgICBjb25zdCBkb21haW5Db21wb25lbnQgPSB0b0Jpb21ldHJpY0RvbWFpbkNvbXBvbmVudChiaW9tZXRyaWNOYW1lKTtcbiAgICBjb25zdCBkb21haW4gPSBgY29tLmFwcGxlLkJpb21ldHJpY0tpdF9TaW0uJHtkb21haW5Db21wb25lbnR9LiR7c2hvdWxkTWF0Y2ggPyAnJyA6ICdubyd9bWF0Y2hgO1xuICAgIGF3YWl0IHRoaXMuc2ltY3RsLnNwYXduUHJvY2VzcyhbXG4gICAgICAnbm90aWZ5dXRpbCcsXG4gICAgICAnLXAnLCBkb21haW5cbiAgICBdKTtcbiAgICBsb2cuaW5mbyhgU2VudCBub3RpZmljYXRpb24gJHtkb21haW59IHRvICR7c2hvdWxkTWF0Y2ggPyAnbWF0Y2gnIDogJ25vdCBtYXRjaCd9ICR7YmlvbWV0cmljTmFtZX0gYmlvbWV0cmljIGAgK1xuICAgICAgYGZvciAke3RoaXMudWRpZH0gU2ltdWxhdG9yYCk7XG4gIH1cblxuICAvKipcbiAgICogQG92ZXJyaWRlXG4gICAqL1xuICBhc3luYyBnZXRMYXVuY2hEYWVtb25zUm9vdCAoKSB7XG4gICAgY29uc3QgZGV2Um9vdCA9IGF3YWl0IGdldERldmVsb3BlclJvb3QoKTtcbiAgICByZXR1cm4gcGF0aC5yZXNvbHZlKGRldlJvb3QsXG4gICAgICAnUGxhdGZvcm1zL2lQaG9uZU9TLnBsYXRmb3JtL0RldmVsb3Blci9MaWJyYXJ5L0NvcmVTaW11bGF0b3IvUHJvZmlsZXMvUnVudGltZXMvaU9TLnNpbXJ1bnRpbWUvQ29udGVudHMvUmVzb3VyY2VzL1J1bnRpbWVSb290L1N5c3RlbS9MaWJyYXJ5L0xhdW5jaERhZW1vbnMnKTtcbiAgfVxuXG59XG5cbmV4cG9ydCBkZWZhdWx0IFNpbXVsYXRvclhjb2RlOTtcbiJdLCJmaWxlIjoibGliL3NpbXVsYXRvci14Y29kZS05LmpzIiwic291cmNlUm9vdCI6Ii4uLy4uIn0=
